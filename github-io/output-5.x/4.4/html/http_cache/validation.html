

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>HTTP Cache Validation &mdash; Symfony Framework Documentation  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/rtd_custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to Use Varnish to Speed up my Website" href="varnish.html" />
    <link rel="prev" title="Working with Server Side Includes" href="ssi.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #f0f0f0" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/symfony-logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                4.4}
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../quick_tour/index.html">The Quick Tour</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../best_practices.html">The Symfony Framework Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bundles.html">The Bundle System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cache.html">Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console.html">Console Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doctrine.html">Databases and the Doctrine ORM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">How to Deploy a Symfony Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../email.html">Swift Mailer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../event_dispatcher.html">Events and Event Listeners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../forms.html">Forms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../frontend.html">Managing CSS and JavaScript</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../http_cache.html">HTTP Cache</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../http_cache.html#caching-on-the-shoulders-of-giants">Caching on the Shoulders of Giants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../http_cache.html#caching-with-a-gateway-cache">Caching with a Gateway Cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="../http_cache.html#making-your-responses-http-cacheable">Making your Responses HTTP Cacheable</a></li>
<li class="toctree-l2"><a class="reference internal" href="../http_cache.html#cache-invalidation">Cache Invalidation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../http_cache.html#using-edge-side-includes">Using Edge Side Includes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../http_cache.html#http-caching-and-user-sessions">HTTP Caching and User Sessions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../http_cache.html#summary">Summary</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../http_cache.html#learn-more">Learn more</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="cache_invalidation.html">Cache Invalidation</a></li>
<li class="toctree-l3"><a class="reference internal" href="cache_vary.html">Varying the Response for HTTP Cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="esi.html">Working with Edge Side Includes</a></li>
<li class="toctree-l3"><a class="reference internal" href="expiration.html">HTTP Cache Expiration</a></li>
<li class="toctree-l3"><a class="reference internal" href="ssi.html">Working with Server Side Includes</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">HTTP Cache Validation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#validation-with-the-etag-header">Validation with the <code class="docutils literal notranslate"><span class="pre">ETag</span></code> Header</a></li>
<li class="toctree-l4"><a class="reference internal" href="#validation-with-the-last-modified-header">Validation with the <code class="docutils literal notranslate"><span class="pre">Last-Modified</span></code> Header</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optimizing-your-code-with-validation">Optimizing your Code with Validation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="varnish.html">How to Use Varnish to Speed up my Website</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../http_client.html">HTTP Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lock.html">Dealing with Concurrency with Locks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mailer.html">Sending Emails with Mailer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mercure.html">Pushing Data to Clients Using the Mercure Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../messenger.html">Messenger: Sync &amp; Queued Message Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration.html">Migrating an Existing Application to Symfony</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profiler.html">Profiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../routing.html">Routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session.html">Sessions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup.html">Installing &amp; Setting up the Symfony Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../serializer.html">How to Use the Serializer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../service_container.html">Service Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../translation.html">Translations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../validation.html">Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../web_link.html">Asset Preloading and Resource Hints with HTTP/2 and WebLink</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow.html">Workflow</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../components/index.html">The Components</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference Documents</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../create_framework/index.html">Create your own PHP Framework</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Symfony Framework Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../http_cache.html">HTTP Cache</a> &raquo;</li>
        
      <li>HTTP Cache Validation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/http_cache/validation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="http-cache-validation">
<span id="index-0"></span><h1>HTTP Cache Validation<a class="headerlink" href="#http-cache-validation" title="Permalink to this headline">¶</a></h1>
<p>When a resource needs to be updated as soon as a change is made to the underlying
data, the expiration model falls short. With the <a class="reference external" href="https://tools.ietf.org/html/rfc2616#section-13.2">expiration model</a>, the
application won’t be asked to return the updated response until the cache
finally becomes stale.</p>
<p>The validation model addresses this issue. Under this model, the cache continues
to store responses. The difference is that, for each request, the cache asks the
application if the cached response is still valid or if it needs to be regenerated.
If the cache <em>is</em> still valid, your application should return a 304 status code
and no content. This tells the cache that it’s OK to return the cached response.</p>
<p>Under this model, you only save CPU if you’re able to determine that the
cached response is still valid by doing <em>less</em> work than generating the whole
page again (see below for an implementation example).</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">The 304 status code means “Not Modified”. It’s important because with
this status code the response does <em>not</em> contain the actual content being
requested. Instead, the response only consists of the response headers that
tells the cache that it can use its stored version of the content.</p>
</div>
<p>Like with expiration, there are two different HTTP headers that can be used
to implement the validation model: <code class="docutils literal notranslate"><span class="pre">ETag</span></code> and <code class="docutils literal notranslate"><span class="pre">Last-Modified</span></code>.</p>
<div class="sidebar">
<p class="first sidebar-title">Expiration and Validation</p>
<p>You can use both validation and expiration within the same <code class="docutils literal notranslate"><span class="pre">Response</span></code>.
As expiration wins over validation, you can benefit from the best of
both worlds. In other words, by using both expiration and validation, you
can instruct the cache to serve the cached content, while checking back
at some interval (the expiration) to verify that the content is still valid.</p>
<div class="last admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">You can also define HTTP caching headers for expiration and validation by using
annotations. See the <a class="reference external" href="https://symfony.com/doc/current/bundles/SensioFrameworkExtraBundle/annotations/cache.html">FrameworkExtraBundle documentation</a>.</p>
</div>
</div>
<div class="section" id="validation-with-the-etag-header">
<span id="index-1"></span><h2>Validation with the <code class="docutils literal notranslate"><span class="pre">ETag</span></code> Header<a class="headerlink" href="#validation-with-the-etag-header" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://en.wikipedia.org/wiki/HTTP_ETag">HTTP ETag</a> (“entity-tag”) header is an optional HTTP header whose value is
an arbitrary string that uniquely identifies one representation of the target
resource. It’s entirely generated and set by your application so that you can
tell, for example, if the <code class="docutils literal notranslate"><span class="pre">/about</span></code> resource that’s stored by the cache is
up-to-date with what your application would return.</p>
<p>An <code class="docutils literal notranslate"><span class="pre">ETag</span></code> is like a fingerprint and is used to quickly compare if two
different versions of a resource are equivalent. Like fingerprints, each
<code class="docutils literal notranslate"><span class="pre">ETag</span></code> must be unique across all representations of the same resource.</p>
<p>To see a short implementation, generate the <code class="docutils literal notranslate"><span class="pre">ETag</span></code> as the <code class="docutils literal notranslate"><span class="pre">md5</span></code> of the
content:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Controller/DefaultController.php</span>
<span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DefaultController</span> <span class="k">extends</span> <span class="nx">AbstractController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">homepage</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;static/homepage.html.twig&#39;</span><span class="p">);</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setEtag</span><span class="p">(</span><span class="nb">md5</span><span class="p">(</span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">()));</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setPublic</span><span class="p">();</span> <span class="c1">// make sure the response is public/cacheable</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">isNotModified</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/HttpFoundation/Response.php" title="Symfony\Component\HttpFoundation\Response::isNotModified()"><span class="pre">isNotModified()</span></a></code>
method compares the <code class="docutils literal notranslate"><span class="pre">If-None-Match</span></code> header with the <code class="docutils literal notranslate"><span class="pre">ETag</span></code> response header.
If the two match, the method automatically sets the <code class="docutils literal notranslate"><span class="pre">Response</span></code> status code
to 304.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>When using <code class="docutils literal notranslate"><span class="pre">mod_deflate</span></code> or <code class="docutils literal notranslate"><span class="pre">mod_brotli</span></code> in Apache 2.4, the original
<code class="docutils literal notranslate"><span class="pre">ETag</span></code> value is modified (e.g. if <code class="docutils literal notranslate"><span class="pre">ETag</span></code> was <code class="docutils literal notranslate"><span class="pre">foo</span></code>, Apache turns it
into <code class="docutils literal notranslate"><span class="pre">foo-gzip</span></code> or <code class="docutils literal notranslate"><span class="pre">foo-br</span></code>), which breaks the <code class="docutils literal notranslate"><span class="pre">ETag</span></code>-based validation.</p>
<p>You can control this behavior with the <a class="reference external" href="https://httpd.apache.org/docs/trunk/mod/mod_deflate.html#deflatealteretag">DeflateAlterETag</a> and <a class="reference external" href="https://httpd.apache.org/docs/2.4/mod/mod_brotli.html#brotlialteretag">BrotliAlterETag</a>
directives. Alternatively, you can use the following Apache configuration to
keep both the original <code class="docutils literal notranslate"><span class="pre">ETag</span></code> and the modified one when compressing responses:</p>
<div class="last highlight-apache notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">RequestHeader</span> edit <span class="s2">&quot;If-None-Match&quot;</span> &#39;^<span class="s2">&quot;((.*)-(gzip|br))&quot;</span>$&#39; &#39;<span class="s2">&quot;$1&quot;</span>, <span class="s2">&quot;$2&quot;</span>&#39;
</pre></div>
</td></tr></table></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The cache sets the <code class="docutils literal notranslate"><span class="pre">If-None-Match</span></code> header on the request to the <code class="docutils literal notranslate"><span class="pre">ETag</span></code>
of the original cached response before sending the request back to the
app. This is how the cache and server communicate with each other and
decide whether or not the resource has been updated since it was cached.</p>
</div>
<p>This algorithm works and is very generic, but you need to create the whole
<code class="docutils literal notranslate"><span class="pre">Response</span></code> before being able to compute the <code class="docutils literal notranslate"><span class="pre">ETag</span></code>, which is sub-optimal.
In other words, it saves on bandwidth, but not CPU cycles.</p>
<p>In the <a class="reference internal" href="#optimizing-cache-validation"><span class="std std-ref">Optimizing your Code with Validation</span></a> section, you’ll see how validation
can be used more intelligently to determine the validity of a cache without
doing so much work.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Symfony also supports weak <code class="docutils literal notranslate"><span class="pre">ETag``s</span> <span class="pre">by</span> <span class="pre">passing</span> <span class="pre">``true</span></code> as the second
argument to the
<code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/HttpFoundation/Response.php" title="Symfony\Component\HttpFoundation\Response::setEtag()"><span class="pre">setEtag()</span></a></code> method.</p>
</div>
</div>
<div class="section" id="validation-with-the-last-modified-header">
<span id="index-2"></span><h2>Validation with the <code class="docutils literal notranslate"><span class="pre">Last-Modified</span></code> Header<a class="headerlink" href="#validation-with-the-last-modified-header" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">Last-Modified</span></code> header is the second form of validation. According
to the HTTP specification, “The <code class="docutils literal notranslate"><span class="pre">Last-Modified</span></code> header field indicates
the date and time at which the origin server believes the representation
was last modified.” In other words, the application decides whether or not
the cached content has been updated based on whether or not it’s been updated
since the response was cached.</p>
<p>For instance, you can use the latest update date for all the objects needed to
compute the resource representation as the value for the <code class="docutils literal notranslate"><span class="pre">Last-Modified</span></code>
header value:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Controller/ArticleController.php</span>
<span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="c1">// ...</span>
<span class="k">use</span> <span class="nx">App\Entity\Article</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ArticleController</span> <span class="k">extends</span> <span class="nx">AbstractController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">show</span><span class="p">(</span><span class="nx">Article</span> <span class="nv">$article</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$author</span> <span class="o">=</span> <span class="nv">$article</span><span class="o">-&gt;</span><span class="na">getAuthor</span><span class="p">();</span>

        <span class="nv">$articleDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\DateTime</span><span class="p">(</span><span class="nv">$article</span><span class="o">-&gt;</span><span class="na">getUpdatedAt</span><span class="p">());</span>
        <span class="nv">$authorDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\DateTime</span><span class="p">(</span><span class="nv">$author</span><span class="o">-&gt;</span><span class="na">getUpdatedAt</span><span class="p">());</span>

        <span class="nv">$date</span> <span class="o">=</span> <span class="nv">$authorDate</span> <span class="o">&gt;</span> <span class="nv">$articleDate</span> <span class="o">?</span> <span class="nv">$authorDate</span> <span class="o">:</span> <span class="nv">$articleDate</span><span class="p">;</span>

        <span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">();</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setLastModified</span><span class="p">(</span><span class="nv">$date</span><span class="p">);</span>
        <span class="c1">// Set response as public. Otherwise it will be private by default.</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setPublic</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">isNotModified</span><span class="p">(</span><span class="nv">$request</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// ... do more work to populate the response with the full content</span>

        <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/HttpFoundation/Response.php" title="Symfony\Component\HttpFoundation\Response::isNotModified()"><span class="pre">isNotModified()</span></a></code>
method compares the <code class="docutils literal notranslate"><span class="pre">If-Modified-Since</span></code> header with the <code class="docutils literal notranslate"><span class="pre">Last-Modified</span></code>
response header. If they are equivalent, the <code class="docutils literal notranslate"><span class="pre">Response</span></code> will be set to a
304 status code.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The cache sets the <code class="docutils literal notranslate"><span class="pre">If-Modified-Since</span></code> header on the request to the <code class="docutils literal notranslate"><span class="pre">Last-Modified</span></code>
of the original cached response before sending the request back to the
app. This is how the cache and server communicate with each other and
decide whether or not the resource has been updated since it was cached.</p>
</div>
</div>
<div class="section" id="optimizing-your-code-with-validation">
<span id="optimizing-cache-validation"></span><span id="index-3"></span><h2>Optimizing your Code with Validation<a class="headerlink" href="#optimizing-your-code-with-validation" title="Permalink to this headline">¶</a></h2>
<p>The main goal of any caching strategy is to lighten the load on the application.
Put another way, the less you do in your application to return a 304 response,
the better. The <code class="docutils literal notranslate"><span class="pre">Response::isNotModified()</span></code> method does exactly that:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Controller/ArticleController.php</span>
<span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="c1">// ...</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ArticleController</span> <span class="k">extends</span> <span class="nx">AbstractController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">show</span><span class="p">(</span><span class="nv">$articleSlug</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Get the minimum information to compute</span>
        <span class="c1">// the ETag or the Last-Modified value</span>
        <span class="c1">// (based on the Request, data is retrieved from</span>
        <span class="c1">// a database or a key-value store for instance)</span>
        <span class="nv">$article</span> <span class="o">=</span> <span class="o">...</span><span class="p">;</span>

        <span class="c1">// create a Response with an ETag and/or a Last-Modified header</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">();</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setEtag</span><span class="p">(</span><span class="nv">$article</span><span class="o">-&gt;</span><span class="na">computeETag</span><span class="p">());</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setLastModified</span><span class="p">(</span><span class="nv">$article</span><span class="o">-&gt;</span><span class="na">getPublishedAt</span><span class="p">());</span>

        <span class="c1">// Set response as public. Otherwise it will be private by default.</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setPublic</span><span class="p">();</span>

        <span class="c1">// Check that the Response is not modified for the given Request</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">isNotModified</span><span class="p">(</span><span class="nv">$request</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// return the 304 Response immediately</span>
            <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// do more work here - like retrieving more data</span>
        <span class="nv">$comments</span> <span class="o">=</span> <span class="o">...</span><span class="p">;</span>

        <span class="c1">// or render a template with the $response you&#39;ve already started</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;article/show.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;article&#39;</span> <span class="o">=&gt;</span> <span class="nv">$article</span><span class="p">,</span>
            <span class="s1">&#39;comments&#39;</span> <span class="o">=&gt;</span> <span class="nv">$comments</span><span class="p">,</span>
        <span class="p">],</span> <span class="nv">$response</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When the <code class="docutils literal notranslate"><span class="pre">Response</span></code> is not modified, the <code class="docutils literal notranslate"><span class="pre">isNotModified()</span></code> automatically sets
the response status code to <code class="docutils literal notranslate"><span class="pre">304</span></code>, removes the content, and removes some
headers that must not be present for <code class="docutils literal notranslate"><span class="pre">304</span></code> responses (see
<code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/HttpFoundation/Response.php" title="Symfony\Component\HttpFoundation\Response::setNotModified()"><span class="pre">setNotModified()</span></a></code>).</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2004-2020 Fabien Potencier

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>