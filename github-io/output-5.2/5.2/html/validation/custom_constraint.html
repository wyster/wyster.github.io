

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>How to Create a Custom Validation Constraint &mdash; Symfony Framework Documentation  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/rtd_custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to Apply only a Subset of all Your Validation Constraints (Validation Groups)" href="groups.html" />
    <link rel="prev" title="Validation" href="../validation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #f0f0f0" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/symfony-logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                5.2}
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../quick_tour/index.html">The Quick Tour</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../best_practices.html">The Symfony Framework Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bundles.html">The Bundle System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cache.html">Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console.html">Console Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doctrine.html">Databases and the Doctrine ORM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">How to Deploy a Symfony Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../email.html">Swift Mailer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../event_dispatcher.html">Events and Event Listeners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../forms.html">Forms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../frontend.html">Managing CSS and JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../http_cache.html">HTTP Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../http_client.html">HTTP Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lock.html">Dealing with Concurrency with Locks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mailer.html">Sending Emails with Mailer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mercure.html">Pushing Data to Clients Using the Mercure Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../messenger.html">Messenger: Sync &amp; Queued Message Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration.html">Migrating an Existing Application to Symfony</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notifier.html">Creating and Sending Notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profiler.html">Profiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rate_limiter.html">Rate Limiter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../routing.html">Routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session.html">Sessions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup.html">Installing &amp; Setting up the Symfony Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../serializer.html">How to Use the Serializer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../service_container.html">Service Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../translation.html">Translations</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../validation.html">Validation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../validation.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../validation.html#the-basics-of-validation">The Basics of Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../validation.html#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../validation.html#constraints">Constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../validation.html#constraints-in-form-classes">Constraints in Form Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../validation.html#constraint-targets">Constraint Targets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../validation.html#debugging-the-constraints">Debugging the Constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../validation.html#final-thoughts">Final Thoughts</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../validation.html#learn-more">Learn more</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">How to Create a Custom Validation Constraint</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#creating-the-constraint-class">Creating the Constraint Class</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-the-validator-itself">Creating the Validator itself</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-the-new-validator">Using the new Validator</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="groups.html">How to Apply only a Subset of all Your Validation Constraints (Validation Groups)</a></li>
<li class="toctree-l3"><a class="reference internal" href="raw_values.html">How to Validate Raw Values (Scalar Values and Arrays)</a></li>
<li class="toctree-l3"><a class="reference internal" href="sequence_provider.html">How to Sequentially Apply Validation Groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="severity.html">How to Handle Different Error Levels</a></li>
<li class="toctree-l3"><a class="reference internal" href="translations.html">How to Translate Validation Constraint Messages</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../web_link.html">Asset Preloading and Resource Hints with HTTP/2 and WebLink</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow.html">Workflow</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../components/index.html">The Components</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference Documents</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../create_framework/index.html">Create your own PHP Framework</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Symfony Framework Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../validation.html">Validation</a> &raquo;</li>
        
      <li>How to Create a Custom Validation Constraint</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/validation/custom_constraint.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="how-to-create-a-custom-validation-constraint">
<span id="index-0"></span><h1>How to Create a Custom Validation Constraint<a class="headerlink" href="#how-to-create-a-custom-validation-constraint" title="Permalink to this headline">¶</a></h1>
<p>You can create a custom constraint by extending the base constraint class,
<code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Validator/Constraint.php" title="Symfony\Component\Validator\Constraint"><span class="pre">Constraint</span></a></code>. As an example you’re
going to create a basic validator that checks if a string contains only
alphanumeric characters.</p>
<div class="section" id="creating-the-constraint-class">
<h2>Creating the Constraint Class<a class="headerlink" href="#creating-the-constraint-class" title="Permalink to this headline">¶</a></h2>
<p>First you need to create a Constraint class and extend <code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Validator/Constraint.php" title="Symfony\Component\Validator\Constraint"><span class="pre">Constraint</span></a></code>:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Validator/ContainsAlphanumeric.php</span>
<span class="k">namespace</span> <span class="nx">App\Validator</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraint</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @Annotation</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">ContainsAlphanumeric</span> <span class="k">extends</span> <span class="nx">Constraint</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$message</span> <span class="o">=</span> <span class="s1">&#39;The string &quot;{{ string }}&quot; contains an illegal character: it can only contain letters or numbers.&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">&#64;Annotation</span></code> annotation is necessary for this new constraint in
order to make it available for use in classes via annotations.
Options for your constraint are represented as public properties on the
constraint class.</p>
</div>
</div>
<div class="section" id="creating-the-validator-itself">
<h2>Creating the Validator itself<a class="headerlink" href="#creating-the-validator-itself" title="Permalink to this headline">¶</a></h2>
<p>As you can see, a constraint class is fairly minimal. The actual validation is
performed by another “constraint validator” class. The constraint validator
class is specified by the constraint’s <code class="docutils literal notranslate"><span class="pre">validatedBy()</span></code> method, which
has this default logic:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// in the base Symfony\Component\Validator\Constraint class</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">validatedBy</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">static</span><span class="o">::</span><span class="na">class</span><span class="o">.</span><span class="s1">&#39;Validator&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In other words, if you create a custom <code class="docutils literal notranslate"><span class="pre">Constraint</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">MyConstraint</span></code>),
Symfony will automatically look for another class, <code class="docutils literal notranslate"><span class="pre">MyConstraintValidator</span></code>
when actually performing the validation.</p>
<p>The validator class only has one required method <code class="docutils literal notranslate"><span class="pre">validate()</span></code>:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Validator/ContainsAlphanumericValidator.php</span>
<span class="k">namespace</span> <span class="nx">App\Validator</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraint</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\ConstraintValidator</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Exception\UnexpectedTypeException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Exception\UnexpectedValueException</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ContainsAlphanumericValidator</span> <span class="k">extends</span> <span class="nx">ConstraintValidator</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">validate</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nx">Constraint</span> <span class="nv">$constraint</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$constraint</span> <span class="nx">instanceof</span> <span class="nx">ContainsAlphanumeric</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">UnexpectedTypeException</span><span class="p">(</span><span class="nv">$constraint</span><span class="p">,</span> <span class="nx">ContainsAlphanumeric</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// custom constraints should ignore null and empty values to allow</span>
        <span class="c1">// other constraints (NotBlank, NotNull, etc.) to take care of that</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="o">===</span> <span class="nv">$value</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span> <span class="o">===</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$value</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// throw this exception if your validator cannot handle the passed type so that it can be marked as invalid</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">UnexpectedValueException</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">);</span>

            <span class="c1">// separate multiple types using pipes</span>
            <span class="c1">// throw new UnexpectedValueException($value, &#39;string|int&#39;);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/^[a-zA-Z0-9]+$/&#39;</span><span class="p">,</span> <span class="nv">$value</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// the argument must be a string or an object implementing __toString()</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">context</span><span class="o">-&gt;</span><span class="na">buildViolation</span><span class="p">(</span><span class="nv">$constraint</span><span class="o">-&gt;</span><span class="na">message</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="s1">&#39;{{ string }}&#39;</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">addViolation</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Inside <code class="docutils literal notranslate"><span class="pre">validate</span></code>, you don’t need to return a value. Instead, you add violations
to the validator’s <code class="docutils literal notranslate"><span class="pre">context</span></code> property and a value will be considered valid
if it causes no violations. The <code class="docutils literal notranslate"><span class="pre">buildViolation()</span></code> method takes the error
message as its argument and returns an instance of
<code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Validator/Violation/ConstraintViolationBuilderInterface.php" title="Symfony\Component\Validator\Violation\ConstraintViolationBuilderInterface"><span class="pre">ConstraintViolationBuilderInterface</span></a></code>.
The <code class="docutils literal notranslate"><span class="pre">addViolation()</span></code> method call finally adds the violation to the context.</p>
</div>
<div class="section" id="using-the-new-validator">
<h2>Using the new Validator<a class="headerlink" href="#using-the-new-validator" title="Permalink to this headline">¶</a></h2>
<p>You can use custom validators like the ones provided by Symfony itself:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>Annotations</em><div class="highlight-php-annotations notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/Entity/AcmeEntity.php</span>
<span class="k">namespace</span> <span class="nx">App\Entity</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Validator</span> <span class="k">as</span> <span class="nx">AcmeAssert</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraints</span> <span class="k">as</span> <span class="nx">Assert</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AcmeEntity</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="sd">/**</span>
<span class="sd">     * @Assert\NotBlank</span>
<span class="sd">     * @AcmeAssert\ContainsAlphanumeric</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/validator/validation.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">App\Entity\AcmeEntity</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">NotBlank</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">~</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">App\Validator\ContainsAlphanumeric</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">~</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/validator/validation.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;constraint-mapping</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/constraint-mapping&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/constraint-mapping https://symfony.com/schema/dic/constraint-mapping/constraint-mapping-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;class</span> <span class="na">name=</span><span class="s">&quot;App\Entity\AcmeEntity&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;constraint</span> <span class="na">name=</span><span class="s">&quot;NotBlank&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;constraint</span> <span class="na">name=</span><span class="s">&quot;App\Validator\ContainsAlphanumeric&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/class&gt;</span>
<span class="nt">&lt;/constraint-mapping&gt;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/Entity/AcmeEntity.php</span>
<span class="k">namespace</span> <span class="nx">App\Entity</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Validator\ContainsAlphanumeric</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraints\NotBlank</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Mapping\ClassMetadata</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AcmeEntity</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">loadValidatorMetadata</span><span class="p">(</span><span class="nx">ClassMetadata</span> <span class="nv">$metadata</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$metadata</span><span class="o">-&gt;</span><span class="na">addPropertyConstraint</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">NotBlank</span><span class="p">());</span>
        <span class="nv">$metadata</span><span class="o">-&gt;</span><span class="na">addPropertyConstraint</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">ContainsAlphanumeric</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
<p>If your constraint contains options, then they should be public properties
on the custom Constraint class you created earlier. These options can be
configured like options on core Symfony constraints.</p>
<div class="section" id="constraint-validators-with-dependencies">
<h3>Constraint Validators with Dependencies<a class="headerlink" href="#constraint-validators-with-dependencies" title="Permalink to this headline">¶</a></h3>
<p>If you’re using the <a class="reference internal" href="../service_container.html#service-container-services-load-example"><span class="std std-ref">default services.yaml configuration</span></a>,
then your validator is already registered as a service and <a class="reference internal" href="../service_container/tags.html"><span class="doc">tagged</span></a>
with the necessary <code class="docutils literal notranslate"><span class="pre">validator.constraint_validator</span></code>. This means you can
<a class="reference internal" href="../service_container.html#services-constructor-injection"><span class="std std-ref">inject services or configuration</span></a> like any other service.</p>
</div>
<div class="section" id="create-a-reusable-set-of-constraints">
<h3>Create a Reusable Set of Constraints<a class="headerlink" href="#create-a-reusable-set-of-constraints" title="Permalink to this headline">¶</a></h3>
<p>In case you need to apply some common set of constraints in different places
consistently across your application, you can extend the <a class="reference internal" href="../reference/constraints/Compound.html"><span class="doc">Compound constraint</span></a>.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 5.1: </span>The <code class="docutils literal notranslate"><span class="pre">Compound</span></code> constraint was introduced in Symfony 5.1.</p>
</div>
</div>
<div class="section" id="class-constraint-validator">
<h3>Class Constraint Validator<a class="headerlink" href="#class-constraint-validator" title="Permalink to this headline">¶</a></h3>
<p>Besides validating a single property, a constraint can have an entire class
as its scope. You only need to add this to the <code class="docutils literal notranslate"><span class="pre">Constraint</span></code> class:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">getTargets</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">CLASS_CONSTRAINT</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>With this, the validator’s <code class="docutils literal notranslate"><span class="pre">validate()</span></code> method gets an object as its first argument:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ProtocolClassValidator</span> <span class="k">extends</span> <span class="nx">ConstraintValidator</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">validate</span><span class="p">(</span><span class="nv">$protocol</span><span class="p">,</span> <span class="nx">Constraint</span> <span class="nv">$constraint</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$protocol</span><span class="o">-&gt;</span><span class="na">getFoo</span><span class="p">()</span> <span class="o">!=</span> <span class="nv">$protocol</span><span class="o">-&gt;</span><span class="na">getBar</span><span class="p">())</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">context</span><span class="o">-&gt;</span><span class="na">buildViolation</span><span class="p">(</span><span class="nv">$constraint</span><span class="o">-&gt;</span><span class="na">message</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">atPath</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">addViolation</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">atPath()</span></code> method defines the property which the validation error is
associated to. Use any <a class="reference internal" href="../components/property_access.html"><span class="doc">valid PropertyAccess syntax</span></a>
to define that property.</p>
</div>
<p>A class constraint validator is applied to the class itself, and
not to the property:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>Annotations</em><div class="highlight-php-annotations notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd"> * @AcmeAssert\ProtocolClass</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">AcmeEntity</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/validator/validation.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">App\Entity\AcmeEntity</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">constraints</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">App\Validator\ProtocolClass</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">~</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/validator/validation.xml --&gt;</span>
<span class="nt">&lt;class</span> <span class="na">name=</span><span class="s">&quot;App\Entity\AcmeEntity&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constraint</span> <span class="na">name=</span><span class="s">&quot;App\Validator\ProtocolClass&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/class&gt;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/Entity/AcmeEntity.php</span>
<span class="k">namespace</span> <span class="nx">App\Entity</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Validator\ProtocolClass</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Mapping\ClassMetadata</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AcmeEntity</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">loadValidatorMetadata</span><span class="p">(</span><span class="nx">ClassMetadata</span> <span class="nv">$metadata</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$metadata</span><span class="o">-&gt;</span><span class="na">addConstraint</span><span class="p">(</span><span class="k">new</span> <span class="nx">ProtocolClass</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2004-2020 Fabien Potencier

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>