

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>HTTP Cache Expiration &mdash; Symfony Framework Documentation  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/rtd_custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Working with Server Side Includes" href="ssi.html" />
    <link rel="prev" title="Working with Edge Side Includes" href="esi.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #f0f0f0" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/symfony-logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                5.x}
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../quick_tour/index.html">The Quick Tour</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../best_practices.html">The Symfony Framework Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bundles.html">The Bundle System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cache.html">Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console.html">Console Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doctrine.html">Databases and the Doctrine ORM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">How to Deploy a Symfony Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../email.html">Swift Mailer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../event_dispatcher.html">Events and Event Listeners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../forms.html">Forms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../frontend.html">Managing CSS and JavaScript</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../http_cache.html">HTTP Cache</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../http_cache.html#caching-on-the-shoulders-of-giants">Caching on the Shoulders of Giants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../http_cache.html#caching-with-a-gateway-cache">Caching with a Gateway Cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="../http_cache.html#making-your-responses-http-cacheable">Making your Responses HTTP Cacheable</a></li>
<li class="toctree-l2"><a class="reference internal" href="../http_cache.html#cache-invalidation">Cache Invalidation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../http_cache.html#using-edge-side-includes">Using Edge Side Includes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../http_cache.html#http-caching-and-user-sessions">HTTP Caching and User Sessions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../http_cache.html#summary">Summary</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../http_cache.html#learn-more">Learn more</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="cache_invalidation.html">Cache Invalidation</a></li>
<li class="toctree-l3"><a class="reference internal" href="cache_vary.html">Varying the Response for HTTP Cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="esi.html">Working with Edge Side Includes</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">HTTP Cache Expiration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#expiration-with-the-cache-control-header">Expiration with the <code class="docutils literal notranslate"><span class="pre">Cache-Control</span></code> Header</a></li>
<li class="toctree-l4"><a class="reference internal" href="#expiration-with-the-expires-header">Expiration with the <code class="docutils literal notranslate"><span class="pre">Expires</span></code> Header</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ssi.html">Working with Server Side Includes</a></li>
<li class="toctree-l3"><a class="reference internal" href="validation.html">HTTP Cache Validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="varnish.html">How to Use Varnish to Speed up my Website</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../http_client.html">HTTP Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lock.html">Dealing with Concurrency with Locks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mailer.html">Sending Emails with Mailer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mercure.html">Pushing Data to Clients Using the Mercure Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../messenger.html">Messenger: Sync &amp; Queued Message Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration.html">Migrating an Existing Application to Symfony</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notifier.html">Creating and Sending Notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profiler.html">Profiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rate_limiter.html">Rate Limiter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../routing.html">Routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session.html">Sessions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup.html">Installing &amp; Setting up the Symfony Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../serializer.html">How to Use the Serializer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../service_container.html">Service Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../translation.html">Translations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../validation.html">Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../web_link.html">Asset Preloading and Resource Hints with HTTP/2 and WebLink</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow.html">Workflow</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../components/index.html">The Components</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference Documents</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../create_framework/index.html">Create your own PHP Framework</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Symfony Framework Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../http_cache.html">HTTP Cache</a> &raquo;</li>
        
      <li>HTTP Cache Expiration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/http_cache/expiration.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="http-cache-expiration">
<span id="index-0"></span><h1>HTTP Cache Expiration<a class="headerlink" href="#http-cache-expiration" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference external" href="https://tools.ietf.org/html/rfc2616#section-13.2">expiration model</a> is the most efficient and straightforward of the two
caching models and should be used whenever possible. When a response is cached
with an expiration, the cache returns it directly without hitting the application
until the cached response expires.</p>
<p>The expiration model can be accomplished using one of two, nearly identical,
HTTP headers: <code class="docutils literal notranslate"><span class="pre">Expires</span></code> or <code class="docutils literal notranslate"><span class="pre">Cache-Control</span></code>.</p>
<div class="sidebar">
<p class="first sidebar-title">Expiration and Validation</p>
<p>You can use both validation and expiration within the same <code class="docutils literal notranslate"><span class="pre">Response</span></code>.
As expiration wins over validation, you can benefit from the best of
both worlds. In other words, by using both expiration and validation, you
can instruct the cache to serve the cached content, while checking back
at some interval (the expiration) to verify that the content is still valid.</p>
<div class="last admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">You can also define HTTP caching headers for expiration and validation by using
annotations. See the <a class="reference external" href="https://symfony.com/doc/current/bundles/SensioFrameworkExtraBundle/annotations/cache.html">FrameworkExtraBundle documentation</a>.</p>
</div>
</div>
<div class="section" id="expiration-with-the-cache-control-header">
<span id="index-1"></span><h2>Expiration with the <code class="docutils literal notranslate"><span class="pre">Cache-Control</span></code> Header<a class="headerlink" href="#expiration-with-the-cache-control-header" title="Permalink to this headline">¶</a></h2>
<p>Most of the time, you will use the <code class="docutils literal notranslate"><span class="pre">Cache-Control</span></code> header, which
is used to specify many different cache directives:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// sets the number of seconds after which the response</span>
<span class="c1">// should no longer be considered fresh by shared caches</span>
<span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setPublic</span><span class="p">();</span>
<span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setMaxAge</span><span class="p">(</span><span class="mi">600</span><span class="p">);</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Cache-Control</span></code> header would take on the following format (it may have
additional directives):</p>
<div class="highlight-text notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>Cache-Control: public, maxage=600
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Using the <code class="docutils literal notranslate"><span class="pre">setSharedMaxAge()</span></code> method is not equivalent to using both
<code class="docutils literal notranslate"><span class="pre">setPublic()</span></code> and <code class="docutils literal notranslate"><span class="pre">setMaxAge()</span></code> methods. According to the
<a class="reference external" href="https://tools.ietf.org/html/rfc7234#section-4.2.4">Serving Stale Responses</a> section of RFC 7234, the <code class="docutils literal notranslate"><span class="pre">s-maxage</span></code> setting
(added by <code class="docutils literal notranslate"><span class="pre">setSharedMaxAge()</span></code> method) prohibits a cache to use a stale
response in <code class="docutils literal notranslate"><span class="pre">stale-if-error</span></code> scenarios. That’s why it’s recommended to use
both <code class="docutils literal notranslate"><span class="pre">public</span></code> and <code class="docutils literal notranslate"><span class="pre">max-age</span></code> directives.</p>
</div>
</div>
<div class="section" id="expiration-with-the-expires-header">
<span id="index-2"></span><h2>Expiration with the <code class="docutils literal notranslate"><span class="pre">Expires</span></code> Header<a class="headerlink" href="#expiration-with-the-expires-header" title="Permalink to this headline">¶</a></h2>
<p>An alternative to the <code class="docutils literal notranslate"><span class="pre">Cache-Control</span></code> header is <code class="docutils literal notranslate"><span class="pre">Expires</span></code>. There’s no advantage
or disadvantage to either.</p>
<p>According to the HTTP specification, “the <code class="docutils literal notranslate"><span class="pre">Expires</span></code> header field gives
the date/time after which the response is considered stale.” The <code class="docutils literal notranslate"><span class="pre">Expires</span></code>
header can be set with the <code class="docutils literal notranslate"><span class="pre">setExpires()</span></code> <code class="docutils literal notranslate"><span class="pre">Response</span></code> method. It takes a
<code class="docutils literal notranslate"><span class="pre">DateTime</span></code> instance as an argument:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$date</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">();</span>
<span class="nv">$date</span><span class="o">-&gt;</span><span class="na">modify</span><span class="p">(</span><span class="s1">&#39;+600 seconds&#39;</span><span class="p">);</span>

<span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setExpires</span><span class="p">(</span><span class="nv">$date</span><span class="p">);</span>
</pre></div>
</div>
<p>The resulting HTTP header will look like this:</p>
<div class="highlight-text notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>Expires: Thu, 01 Mar 2011 16:00:00 GMT
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">setExpires()</span></code> method automatically converts the date to the GMT
timezone as required by the specification.</p>
</div>
<p>Note that in HTTP versions before 1.1 the origin server wasn’t required to
send the <code class="docutils literal notranslate"><span class="pre">Date</span></code> header. Consequently, the cache (e.g. the browser) might
need to rely on the local clock to evaluate the <code class="docutils literal notranslate"><span class="pre">Expires</span></code> header making
the lifetime calculation vulnerable to clock skew. Another limitation
of the <code class="docutils literal notranslate"><span class="pre">Expires</span></code> header is that the specification states that “HTTP/1.1
servers should not send <code class="docutils literal notranslate"><span class="pre">Expires</span></code> dates more than one year in the future.”</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">According to the <a class="reference external" href="https://tools.ietf.org/html/rfc7234#section-4.2.1">Calculating Freshness Lifetime</a> section of RFC 7234,
the <code class="docutils literal notranslate"><span class="pre">Expires</span></code> header value is ignored when the <code class="docutils literal notranslate"><span class="pre">s-maxage</span></code> or <code class="docutils literal notranslate"><span class="pre">max-age</span></code>
directive of the <code class="docutils literal notranslate"><span class="pre">Cache-Control</span></code> header is defined.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2004-2020 Fabien Potencier

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>