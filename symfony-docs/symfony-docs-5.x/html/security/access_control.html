

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>How Does the Security access_control Work? &mdash; Symfony Framework Documentation  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/rtd_custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to Customize Access Denied Responses" href="access_denied_handler.html" />
    <link rel="prev" title="How to Secure any Service or Method in your Application" href="securing_services.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #f0f0f0" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/symfony-logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                5.x}
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../quick_tour/index.html">The Quick Tour</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../best_practices.html">The Symfony Framework Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bundles.html">The Bundle System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cache.html">Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console.html">Console Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doctrine.html">Databases and the Doctrine ORM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">How to Deploy a Symfony Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../email.html">Swift Mailer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../event_dispatcher.html">Events and Event Listeners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../forms.html">Forms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../frontend.html">Managing CSS and JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../http_cache.html">HTTP Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../http_client.html">HTTP Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lock.html">Dealing with Concurrency with Locks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mailer.html">Sending Emails with Mailer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mercure.html">Pushing Data to Clients Using the Mercure Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../messenger.html">Messenger: Sync &amp; Queued Message Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration.html">Migrating an Existing Application to Symfony</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notifier.html">Creating and Sending Notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profiler.html">Profiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rate_limiter.html">Rate Limiter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../routing.html">Routing</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../security.html">Security</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../security.html#installation">1) Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#a-create-your-user-class">2a) Create your User Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#b-the-user-provider">2b) The “User Provider”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#c-encoding-passwords">2c) Encoding Passwords</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#a-authentication-firewalls">3a) Authentication &amp; Firewalls</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#b-authenticating-your-users">3b) Authenticating your Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#denying-access-roles-and-other-authorization">4) Denying Access, Roles and other Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#a-fetching-the-user-object">5a) Fetching the User Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#b-fetching-the-user-from-a-service">5b) Fetching the User from a Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#logging-out">Logging Out</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#hierarchical-roles">Hierarchical Roles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#frequently-asked-questions">Frequently Asked Questions</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../security.html#learn-more">Learn More</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../security.html#authentication-identifying-logging-in-the-user">Authentication (Identifying/Logging in the User)</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../security.html#authorization-denying-access">Authorization (Denying Access)</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="voters.html">How to Use Voters to Check User Permissions</a></li>
<li class="toctree-l4"><a class="reference internal" href="securing_services.html">How to Secure any Service or Method in your Application</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">How Does the Security access_control Work?</a></li>
<li class="toctree-l4"><a class="reference internal" href="access_denied_handler.html">How to Customize Access Denied Responses</a></li>
<li class="toctree-l4"><a class="reference internal" href="acl.html">How to Use Access Control Lists (ACLs)</a></li>
<li class="toctree-l4"><a class="reference internal" href="force_https.html">How to Force HTTPS or HTTP for different URLs</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../session.html">Sessions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup.html">Installing &amp; Setting up the Symfony Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../serializer.html">How to Use the Serializer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../service_container.html">Service Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../translation.html">Translations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../validation.html">Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../web_link.html">Asset Preloading and Resource Hints with HTTP/2 and WebLink</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow.html">Workflow</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../components/index.html">The Components</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference Documents</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../create_framework/index.html">Create your own PHP Framework</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Symfony Framework Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../security.html">Security</a> &raquo;</li>
        
      <li>How Does the Security access_control Work?</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/security/access_control.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="how-does-the-security-access-control-work">
<span id="security-access-control-explanation"></span><h1>How Does the Security access_control Work?<a class="headerlink" href="#how-does-the-security-access-control-work" title="Permalink to this headline">¶</a></h1>
<p>For each incoming request, Symfony checks each <code class="docutils literal notranslate"><span class="pre">access_control</span></code> entry
to find <em>one</em> that matches the current request. As soon as it finds a matching
<code class="docutils literal notranslate"><span class="pre">access_control</span></code> entry, it stops - only the <strong>first</strong> matching <code class="docutils literal notranslate"><span class="pre">access_control</span></code>
is used to enforce access.</p>
<p>Each <code class="docutils literal notranslate"><span class="pre">access_control</span></code> has several options that configure two different
things:</p>
<ol class="arabic simple">
<li><a class="reference internal" href="#security-access-control-matching-options"><span class="std std-ref">should the incoming request match this access control entry</span></a></li>
<li><a class="reference internal" href="#security-access-control-enforcement-options"><span class="std std-ref">once it matches, should some sort of access restriction be enforced</span></a>:</li>
</ol>
<div class="section" id="matching-options">
<span id="security-access-control-matching-options"></span><h2>1. Matching Options<a class="headerlink" href="#matching-options" title="Permalink to this headline">¶</a></h2>
<p>Symfony creates an instance of <code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/HttpFoundation/RequestMatcher.php" title="Symfony\Component\HttpFoundation\RequestMatcher"><span class="pre">RequestMatcher</span></a></code>
for each <code class="docutils literal notranslate"><span class="pre">access_control</span></code> entry, which determines whether or not a given
access control should be used on this request. The following <code class="docutils literal notranslate"><span class="pre">access_control</span></code>
options are used for matching:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">path</span></code>: a regular expression (without delimiters)</li>
<li><code class="docutils literal notranslate"><span class="pre">ip</span></code> or <code class="docutils literal notranslate"><span class="pre">ips</span></code>: netmasks are also supported (can be a comma-separated string)</li>
<li><code class="docutils literal notranslate"><span class="pre">port</span></code>: an integer</li>
<li><code class="docutils literal notranslate"><span class="pre">host</span></code>: a regular expression</li>
<li><code class="docutils literal notranslate"><span class="pre">methods</span></code>: one or many methods</li>
</ul>
<p>Take the following <code class="docutils literal notranslate"><span class="pre">access_control</span></code> entries as an example:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">parameters</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">env(TRUSTED_IPS)</span><span class="p p-Indicator">:</span> <span class="s">&#39;10.0.0.1,</span><span class="nv"> </span><span class="s">10.0.0.2&#39;</span>

<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l l-Scalar l-Scalar-Plain">access_control</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="s">&#39;^/admin&#39;</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">ROLE_USER_IP</span><span class="p p-Indicator">,</span> <span class="nv">ip</span><span class="p p-Indicator">:</span> <span class="nv">127.0.0.1</span> <span class="p p-Indicator">}</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="s">&#39;^/admin&#39;</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">ROLE_USER_PORT</span><span class="p p-Indicator">,</span> <span class="nv">ip</span><span class="p p-Indicator">:</span> <span class="nv">127.0.0.1</span><span class="p p-Indicator">,</span> <span class="nv">port</span><span class="p p-Indicator">:</span> <span class="nv">8080</span> <span class="p p-Indicator">}</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="s">&#39;^/admin&#39;</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">ROLE_USER_HOST</span><span class="p p-Indicator">,</span> <span class="nv">host</span><span class="p p-Indicator">:</span> <span class="nv">symfony\.com$</span> <span class="p p-Indicator">}</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="s">&#39;^/admin&#39;</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">ROLE_USER_METHOD</span><span class="p p-Indicator">,</span> <span class="nv">methods</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">POST</span><span class="p p-Indicator">,</span> <span class="nv">PUT</span><span class="p p-Indicator">]</span> <span class="p p-Indicator">}</span>

        <span class="c1"># ips can be comma-separated, which is especially useful when using env variables</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="s">&#39;^/admin&#39;</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">ROLE_USER_IP</span><span class="p p-Indicator">,</span> <span class="nv">ips</span><span class="p p-Indicator">:</span> <span class="s">&#39;%env(TRUSTED_IPS)%&#39;</span> <span class="p p-Indicator">}</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="s">&#39;^/admin&#39;</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">ROLE_USER_IP</span><span class="p p-Indicator">,</span> <span class="nv">ips</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">127.0.0.1</span><span class="p p-Indicator">,</span> <span class="p p-Indicator">::</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;%env(TRUSTED_IPS)%&#39;</span><span class="p p-Indicator">]</span> <span class="p p-Indicator">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd</span>
<span class="s">        http://symfony.com/schema/dic/security</span>
<span class="s">        https://symfony.com/schema/dic/security/security-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;srv:parameters&gt;</span>
        <span class="nt">&lt;srv:parameter</span> <span class="na">key=</span><span class="s">&quot;env(TRUSTED_IPS)&quot;</span><span class="nt">&gt;</span>10.0.0.1, 10.0.0.2<span class="nt">&lt;/parameter&gt;</span>
    <span class="nt">&lt;/srv:parameters&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/admin&quot;</span> <span class="na">role=</span><span class="s">&quot;ROLE_USER_IP&quot;</span> <span class="na">ip=</span><span class="s">&quot;127.0.0.1&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/admin&quot;</span> <span class="na">role=</span><span class="s">&quot;ROLE_USER_PORT&quot;</span> <span class="na">ip=</span><span class="s">&quot;127.0.0.1&quot;</span> <span class="na">port=</span><span class="s">&quot;8080&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/admin&quot;</span> <span class="na">role=</span><span class="s">&quot;ROLE_USER_HOST&quot;</span> <span class="na">host=</span><span class="s">&quot;symfony\.com$&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/admin&quot;</span> <span class="na">role=</span><span class="s">&quot;ROLE_USER_METHOD&quot;</span> <span class="na">methods=</span><span class="s">&quot;POST, PUT&quot;</span><span class="nt">/&gt;</span>

        <span class="c">&lt;!-- ips can be comma-separated, which is especially useful when using env variables --&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/admin&quot;</span> <span class="na">role=</span><span class="s">&quot;ROLE_USER_IP&quot;</span> <span class="na">ip=</span><span class="s">&quot;%env(TRUSTED_IPS)%&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/admin&quot;</span> <span class="na">role=</span><span class="s">&quot;ROLE_USER_IP&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;ip&gt;</span>127.0.0.1<span class="nt">&lt;/ip&gt;</span>
            <span class="nt">&lt;ip&gt;</span>::1<span class="nt">&lt;/ip&gt;</span>
            <span class="nt">&lt;ip&gt;</span>%env(TRUSTED_IPS)%<span class="nt">&lt;/ip&gt;</span>
        <span class="nt">&lt;/rule&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="s1">&#39;env(TRUSTED_IPS)&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.0.1, 10.0.0.2&#39;</span><span class="p">);</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="c1">// ...</span>
    <span class="s1">&#39;access_control&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="p">[</span>
            <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/admin&#39;</span><span class="p">,</span>
            <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_USER_IP&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ips&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/admin&#39;</span><span class="p">,</span>
            <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_USER_PORT&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ip&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
            <span class="s1">&#39;port&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;8080&#39;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/admin&#39;</span><span class="p">,</span>
            <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_USER_HOST&#39;</span><span class="p">,</span>
            <span class="s1">&#39;host&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;symfony\.com$&#39;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/admin&#39;</span><span class="p">,</span>
            <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_USER_METHOD&#39;</span><span class="p">,</span>
            <span class="s1">&#39;methods&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;POST, PUT&#39;</span><span class="p">,</span>
        <span class="p">],</span>

        <span class="c1">// ips can be comma-separated, which is especially useful when using env variables</span>
        <span class="p">[</span>
            <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/admin&#39;</span><span class="p">,</span>
            <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_USER_IP&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ips&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;%env(TRUSTED_IPS)%&#39;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/admin&#39;</span><span class="p">,</span>
            <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_USER_IP&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ips&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
                <span class="s1">&#39;::1&#39;</span><span class="p">,</span>
                <span class="s1">&#39;%env(TRUSTED_IPS)%&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 5.2: </span>Support for comma-separated IP addresses was introduced in Symfony 5.2.</p>
</div>
<p>For each incoming request, Symfony will decide which <code class="docutils literal notranslate"><span class="pre">access_control</span></code>
to use based on the URI, the client’s IP address, the incoming host name,
and the request method. Remember, the first rule that matches is used, and
if <code class="docutils literal notranslate"><span class="pre">ip</span></code>, <code class="docutils literal notranslate"><span class="pre">port</span></code>, <code class="docutils literal notranslate"><span class="pre">host</span></code> or <code class="docutils literal notranslate"><span class="pre">method</span></code> are not specified for an entry, that
<code class="docutils literal notranslate"><span class="pre">access_control</span></code> will match any <code class="docutils literal notranslate"><span class="pre">ip</span></code>, <code class="docutils literal notranslate"><span class="pre">port</span></code>, <code class="docutils literal notranslate"><span class="pre">host</span></code> or <code class="docutils literal notranslate"><span class="pre">method</span></code>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="7%" />
<col width="20%" />
<col width="38%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">URI</th>
<th class="head">IP</th>
<th class="head">PORT</th>
<th class="head">HOST</th>
<th class="head">METHOD</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">access_control</span></code></th>
<th class="head">Why?</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">/admin/user</span></code></td>
<td>127.0.0.1</td>
<td>80</td>
<td>example.com</td>
<td>GET</td>
<td>rule #1 (<code class="docutils literal notranslate"><span class="pre">ROLE_USER_IP</span></code>)</td>
<td>The URI matches <code class="docutils literal notranslate"><span class="pre">path</span></code> and the IP matches <code class="docutils literal notranslate"><span class="pre">ip</span></code>.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">/admin/user</span></code></td>
<td>127.0.0.1</td>
<td>80</td>
<td>symfony.com</td>
<td>GET</td>
<td>rule #1 (<code class="docutils literal notranslate"><span class="pre">ROLE_USER_IP</span></code>)</td>
<td>The <code class="docutils literal notranslate"><span class="pre">path</span></code> and <code class="docutils literal notranslate"><span class="pre">ip</span></code> still match. This would also match
the <code class="docutils literal notranslate"><span class="pre">ROLE_USER_HOST</span></code> entry, but <em>only</em> the <strong>first</strong>
<code class="docutils literal notranslate"><span class="pre">access_control</span></code> match is used.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">/admin/user</span></code></td>
<td>127.0.0.1</td>
<td>8080</td>
<td>symfony.com</td>
<td>GET</td>
<td>rule #2 (<code class="docutils literal notranslate"><span class="pre">ROLE_USER_PORT</span></code>)</td>
<td>The <code class="docutils literal notranslate"><span class="pre">path</span></code>, <code class="docutils literal notranslate"><span class="pre">ip</span></code> and <code class="docutils literal notranslate"><span class="pre">port</span></code> match.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">/admin/user</span></code></td>
<td>168.0.0.1</td>
<td>80</td>
<td>symfony.com</td>
<td>GET</td>
<td>rule #3 (<code class="docutils literal notranslate"><span class="pre">ROLE_USER_HOST</span></code>)</td>
<td>The <code class="docutils literal notranslate"><span class="pre">ip</span></code> doesn’t match the first rule, so the second
rule (which matches) is used.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">/admin/user</span></code></td>
<td>168.0.0.1</td>
<td>80</td>
<td>symfony.com</td>
<td>POST</td>
<td>rule #3 (<code class="docutils literal notranslate"><span class="pre">ROLE_USER_HOST</span></code>)</td>
<td>The second rule still matches. This would also match the
third rule (<code class="docutils literal notranslate"><span class="pre">ROLE_USER_METHOD</span></code>), but only the <strong>first</strong>
matched <code class="docutils literal notranslate"><span class="pre">access_control</span></code> is used.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">/admin/user</span></code></td>
<td>168.0.0.1</td>
<td>80</td>
<td>example.com</td>
<td>POST</td>
<td>rule #4 (<code class="docutils literal notranslate"><span class="pre">ROLE_USER_METHOD</span></code>)</td>
<td>The <code class="docutils literal notranslate"><span class="pre">ip</span></code> and <code class="docutils literal notranslate"><span class="pre">host</span></code> don’t match the first two entries,
but the third - <code class="docutils literal notranslate"><span class="pre">ROLE_USER_METHOD</span></code> - matches and is used.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">/foo</span></code></td>
<td>127.0.0.1</td>
<td>80</td>
<td>symfony.com</td>
<td>POST</td>
<td>matches no entries</td>
<td>This doesn’t match any <code class="docutils literal notranslate"><span class="pre">access_control</span></code> rules, since its
URI doesn’t match any of the <code class="docutils literal notranslate"><span class="pre">path</span></code> values.</td>
</tr>
</tbody>
</table>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">Matching the URI is done without <code class="docutils literal notranslate"><span class="pre">$_GET</span></code> parameters.
<a class="reference internal" href="../security.html#security-securing-controller"><span class="std std-ref">Deny access in PHP code</span></a> if you want
to disallow access based on <code class="docutils literal notranslate"><span class="pre">$_GET</span></code> parameter values.</p>
</div>
</div>
<div class="section" id="access-enforcement">
<span id="security-access-control-enforcement-options"></span><h2>2. Access Enforcement<a class="headerlink" href="#access-enforcement" title="Permalink to this headline">¶</a></h2>
<p>Once Symfony has decided which <code class="docutils literal notranslate"><span class="pre">access_control</span></code> entry matches (if any),
it then <em>enforces</em> access restrictions based on the <code class="docutils literal notranslate"><span class="pre">roles</span></code>, <code class="docutils literal notranslate"><span class="pre">allow_if</span></code> and <code class="docutils literal notranslate"><span class="pre">requires_channel</span></code>
options:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">roles</span></code> If the user does not have the given role, then access is denied
(internally, an <code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Security/Core/Exception/AccessDeniedException.php" title="Symfony\Component\Security\Core\Exception\AccessDeniedException"><span class="pre">AccessDeniedException</span></a></code>
is thrown). If this value is an array of multiple roles, the user must have
at least one of them.</li>
<li><code class="docutils literal notranslate"><span class="pre">allow_if</span></code> If the expression returns false, then access is denied;</li>
<li><code class="docutils literal notranslate"><span class="pre">requires_channel</span></code> If the incoming request’s channel (e.g. <code class="docutils literal notranslate"><span class="pre">http</span></code>)
does not match this value (e.g. <code class="docutils literal notranslate"><span class="pre">https</span></code>), the user will be redirected
(e.g. redirected from <code class="docutils literal notranslate"><span class="pre">http</span></code> to <code class="docutils literal notranslate"><span class="pre">https</span></code>, or vice versa).</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Behind the scenes, the array value of <code class="docutils literal notranslate"><span class="pre">roles</span></code> is passed as the
<code class="docutils literal notranslate"><span class="pre">$attributes</span></code> argument to each voter in the application with the
<code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/HttpFoundation/Request.php" title="Symfony\Component\HttpFoundation\Request"><span class="pre">Request</span></a></code> as <code class="docutils literal notranslate"><span class="pre">$subject</span></code>. You
can learn how to use your custom attributes by reading
<a class="reference internal" href="voters.html#security-custom-voter"><span class="std std-ref">How to Use Voters to Check User Permissions</span></a>.</p>
</div>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">If you define both <code class="docutils literal notranslate"><span class="pre">roles</span></code> and <code class="docutils literal notranslate"><span class="pre">allow_if</span></code>, and your Access Decision
Strategy is the default one (<code class="docutils literal notranslate"><span class="pre">affirmative</span></code>), then the user will be granted
access if there’s at least one valid condition. If this behavior doesn’t fit
your needs, <a class="reference internal" href="voters.html#security-voters-change-strategy"><span class="std std-ref">change the Access Decision Strategy</span></a>.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">If access is denied, the system will try to authenticate the user if not
already (e.g. redirect the user to the login page). If the user is already
logged in, the 403 “access denied” error page will be shown. See
<a class="reference internal" href="../controller/error_pages.html"><span class="doc">How to Customize Error Pages</span></a> for more information.</p>
</div>
</div>
<div class="section" id="matching-access-control-by-ip">
<h2>Matching access_control By IP<a class="headerlink" href="#matching-access-control-by-ip" title="Permalink to this headline">¶</a></h2>
<p>Certain situations may arise when you need to have an <code class="docutils literal notranslate"><span class="pre">access_control</span></code>
entry that <em>only</em> matches requests coming from some IP address or range.
For example, this <em>could</em> be used to deny access to a URL pattern to all
requests <em>except</em> those from a trusted, internal server.</p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">As you’ll read in the explanation below the example, the <code class="docutils literal notranslate"><span class="pre">ips</span></code> option
does not restrict to a specific IP address. Instead, using the <code class="docutils literal notranslate"><span class="pre">ips</span></code>
key means that the <code class="docutils literal notranslate"><span class="pre">access_control</span></code> entry will only match this IP address,
and users accessing it from a different IP address will continue down
the <code class="docutils literal notranslate"><span class="pre">access_control</span></code> list.</p>
</div>
<p>Here is an example of how you configure some example <code class="docutils literal notranslate"><span class="pre">/internal*</span></code> URL
pattern so that it is only accessible by requests from the local server itself:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l l-Scalar l-Scalar-Plain">access_control</span><span class="p p-Indicator">:</span>
        <span class="c1">#</span>
        <span class="c1"># the &#39;ips&#39; option supports IP addresses and subnet masks</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="s">&#39;^/internal&#39;</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">IS_AUTHENTICATED_ANONYMOUSLY</span><span class="p p-Indicator">,</span> <span class="nv">ips</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">127.0.0.1</span><span class="p p-Indicator">,</span> <span class="p p-Indicator">::</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="nv">192.168.0.1/24</span><span class="p p-Indicator">]</span> <span class="p p-Indicator">}</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="s">&#39;^/internal&#39;</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">ROLE_NO_ACCESS</span> <span class="p p-Indicator">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd</span>
<span class="s">        http://symfony.com/schema/dic/security</span>
<span class="s">        https://symfony.com/schema/dic/security/security-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>

        <span class="c">&lt;!-- the &#39;ips&#39; option supports IP addresses and subnet masks --&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/internal&quot;</span> <span class="na">role=</span><span class="s">&quot;IS_AUTHENTICATED_ANONYMOUSLY&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;ip&gt;</span>127.0.0.1<span class="nt">&lt;/ip&gt;</span>
            <span class="nt">&lt;ip&gt;</span>::1<span class="nt">&lt;/ip&gt;</span>
        <span class="nt">&lt;/rule&gt;</span>

        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/internal&quot;</span> <span class="na">role=</span><span class="s">&quot;ROLE_NO_ACCESS&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="c1">// ...</span>
    <span class="s1">&#39;access_control&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="p">[</span>
            <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/internal&#39;</span><span class="p">,</span>
            <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;IS_AUTHENTICATED_ANONYMOUSLY&#39;</span><span class="p">,</span>
            <span class="c1">// the &#39;ips&#39; option supports IP addresses and subnet masks</span>
            <span class="s1">&#39;ips&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="s1">&#39;::1&#39;</span><span class="p">],</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/internal&#39;</span><span class="p">,</span>
            <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_NO_ACCESS&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
<p>Here is how it works when the path is <code class="docutils literal notranslate"><span class="pre">/internal/something</span></code> coming from
the external IP address <code class="docutils literal notranslate"><span class="pre">10.0.0.1</span></code>:</p>
<ul class="simple">
<li>The first access control rule is ignored as the <code class="docutils literal notranslate"><span class="pre">path</span></code> matches but the
IP address does not match either of the IPs listed;</li>
<li>The second access control rule is enabled (the only restriction being the
<code class="docutils literal notranslate"><span class="pre">path</span></code>) and so it matches. If you make sure that no users ever have
<code class="docutils literal notranslate"><span class="pre">ROLE_NO_ACCESS</span></code>, then access is denied (<code class="docutils literal notranslate"><span class="pre">ROLE_NO_ACCESS</span></code> can be anything
that does not match an existing role, it only serves as a trick to always
deny access).</li>
</ul>
<p>But if the same request comes from <code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code> or <code class="docutils literal notranslate"><span class="pre">::1</span></code> (the IPv6 loopback
address):</p>
<ul class="simple">
<li>Now, the first access control rule is enabled as both the <code class="docutils literal notranslate"><span class="pre">path</span></code> and the
<code class="docutils literal notranslate"><span class="pre">ip</span></code> match: access is allowed as the user always has the
<code class="docutils literal notranslate"><span class="pre">IS_AUTHENTICATED_ANONYMOUSLY</span></code> role.</li>
<li>The second access rule is not examined as the first rule matched.</li>
</ul>
<div class="section" id="securing-by-an-expression">
<span id="security-allow-if"></span><h3>Securing by an Expression<a class="headerlink" href="#securing-by-an-expression" title="Permalink to this headline">¶</a></h3>
<p>Once an <code class="docutils literal notranslate"><span class="pre">access_control</span></code> entry is matched, you can deny access via the
<code class="docutils literal notranslate"><span class="pre">roles</span></code> key or use more complex logic with an expression in the <code class="docutils literal notranslate"><span class="pre">allow_if</span></code>
key:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l l-Scalar l-Scalar-Plain">access_control</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span>
            <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">^/_internal/secure</span>
            <span class="c1"># the &#39;role&#39; and &#39;allow-if&#39; options work like an OR expression, so</span>
            <span class="c1"># access is granted if the expression is TRUE or the user has ROLE_ADMIN</span>
            <span class="l l-Scalar l-Scalar-Plain">roles</span><span class="p p-Indicator">:</span> <span class="s">&#39;ROLE_ADMIN&#39;</span>
            <span class="l l-Scalar l-Scalar-Plain">allow_if</span><span class="p p-Indicator">:</span> <span class="s">&quot;&#39;127.0.0.1&#39;</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">request.getClientIp()</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">request.headers.has(&#39;X-Secure-Access&#39;)&quot;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd</span>
<span class="s">        http://symfony.com/schema/dic/security</span>
<span class="s">        https://symfony.com/schema/dic/security/security-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>
        <span class="c">&lt;!-- the &#39;role&#39; and &#39;allow-if&#39; options work like an OR expression, so</span>
<span class="c">             access is granted if the expression is TRUE or the user has ROLE_ADMIN --&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/_internal/secure&quot;</span>
            <span class="na">role=</span><span class="s">&quot;ROLE_ADMIN&quot;</span>
            <span class="na">allow-if=</span><span class="s">&quot;&#39;127.0.0.1&#39; == request.getClientIp() or request.headers.has(&#39;X-Secure-Access&#39;)&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="c1">// ...</span>
    <span class="s1">&#39;access_control&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="p">[</span>
            <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/_internal/secure&#39;</span><span class="p">,</span>
            <span class="c1">// the &#39;role&#39; and &#39;allow-if&#39; options work like an OR expression, so</span>
            <span class="c1">// access is granted if the expression is TRUE or the user has ROLE_ADMIN</span>
            <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">,</span>
            <span class="s1">&#39;allow_if&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&quot;127.0.0.1&quot; == request.getClientIp() or request.headers.has(&quot;X-Secure-Access&quot;)&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
<p>In this case, when the user tries to access any URL starting with
<code class="docutils literal notranslate"><span class="pre">/_internal/secure</span></code>, they will only be granted access if the IP address is
<code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code> or a secure header, or if the user has the <code class="docutils literal notranslate"><span class="pre">ROLE_ADMIN</span></code> role.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Internally <code class="docutils literal notranslate"><span class="pre">allow_if</span></code> triggers the built-in
<code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Security/Core/Authorization/Voter/ExpressionVoter.php" title="Symfony\Component\Security\Core\Authorization\Voter\ExpressionVoter"><span class="pre">ExpressionVoter</span></a></code>
as like it was part of the attributes defined in the <code class="docutils literal notranslate"><span class="pre">roles</span></code> option.</p>
</div>
<p>Inside the expression, you have access to a number of different variables
and functions including <code class="docutils literal notranslate"><span class="pre">request</span></code>, which is the Symfony
<code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/HttpFoundation/Request.php" title="Symfony\Component\HttpFoundation\Request"><span class="pre">Request</span></a></code> object (see
<a class="reference internal" href="../components/http_foundation.html#component-http-foundation-request"><span class="std std-ref">Request</span></a>).</p>
<p>For a list of the other functions and variables, see
<a class="reference internal" href="expressions.html#security-expression-variables"><span class="std std-ref">functions and variables</span></a>.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">allow_if</span></code> expressions can also contain custom functions registered
with <a class="reference internal" href="../components/expression_language/extending.html#components-expression-language-provider"><span class="std std-ref">expression providers</span></a>.</p>
</div>
</div>
</div>
<div class="section" id="restrict-to-a-port">
<h2>Restrict to a port<a class="headerlink" href="#restrict-to-a-port" title="Permalink to this headline">¶</a></h2>
<p>Add the <code class="docutils literal notranslate"><span class="pre">port</span></code> option to any <code class="docutils literal notranslate"><span class="pre">access_control</span></code> entries to require users to
access those URLs via a specific port. This could be useful for example for
<code class="docutils literal notranslate"><span class="pre">localhost:8080</span></code>.</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l l-Scalar l-Scalar-Plain">access_control</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="nv">^/cart/checkout</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">IS_AUTHENTICATED_ANONYMOUSLY</span><span class="p p-Indicator">,</span> <span class="nv">port</span><span class="p p-Indicator">:</span> <span class="nv">8080</span> <span class="p p-Indicator">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd</span>
<span class="s">        http://symfony.com/schema/dic/security</span>
<span class="s">        https://symfony.com/schema/dic/security/security-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/cart/checkout&quot;</span>
            <span class="na">role=</span><span class="s">&quot;IS_AUTHENTICATED_ANONYMOUSLY&quot;</span>
            <span class="na">port=</span><span class="s">&quot;8080&quot;</span>
        <span class="nt">/&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="c1">// ...</span>
    <span class="s1">&#39;access_control&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="p">[</span>
            <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/cart/checkout&#39;</span><span class="p">,</span>
            <span class="s1">&#39;role&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;IS_AUTHENTICATED_ANONYMOUSLY&#39;</span><span class="p">,</span>
            <span class="s1">&#39;port&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;8080&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
</div>
<div class="section" id="forcing-a-channel-http-https">
<h2>Forcing a Channel (http, https)<a class="headerlink" href="#forcing-a-channel-http-https" title="Permalink to this headline">¶</a></h2>
<p>You can also require a user to access a URL via SSL; use the
<code class="docutils literal notranslate"><span class="pre">requires_channel</span></code> argument in any <code class="docutils literal notranslate"><span class="pre">access_control</span></code> entries. If this
<code class="docutils literal notranslate"><span class="pre">access_control</span></code> is matched and the request is using the <code class="docutils literal notranslate"><span class="pre">http</span></code> channel,
the user will be redirected to <code class="docutils literal notranslate"><span class="pre">https</span></code>:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l l-Scalar l-Scalar-Plain">access_control</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="nv">^/cart/checkout</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">IS_AUTHENTICATED_ANONYMOUSLY</span><span class="p p-Indicator">,</span> <span class="nv">requires_channel</span><span class="p p-Indicator">:</span> <span class="nv">https</span> <span class="p p-Indicator">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd</span>
<span class="s">        http://symfony.com/schema/dic/security</span>
<span class="s">        https://symfony.com/schema/dic/security/security-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/cart/checkout&quot;</span>
            <span class="na">role=</span><span class="s">&quot;IS_AUTHENTICATED_ANONYMOUSLY&quot;</span>
            <span class="na">requires-channel=</span><span class="s">&quot;https&quot;</span>
        <span class="nt">/&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="c1">// ...</span>
    <span class="s1">&#39;access_control&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="p">[</span>
            <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/cart/checkout&#39;</span><span class="p">,</span>
            <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;IS_AUTHENTICATED_ANONYMOUSLY&#39;</span><span class="p">,</span>
            <span class="s1">&#39;requires_channel&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;https&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2004-2020 Fabien Potencier

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>