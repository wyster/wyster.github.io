

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>How to Migrate a Password Hash &mdash; Symfony Framework Documentation  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/rtd_custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Built-in Authentication Providers" href="auth_providers.html" />
    <link rel="prev" title="Custom Authentication System with Guard (API Token Example)" href="guard_authentication.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #f0f0f0" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/symfony-logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                5.2}
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../quick_tour/index.html">The Quick Tour</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../best_practices.html">The Symfony Framework Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bundles.html">The Bundle System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cache.html">Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console.html">Console Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doctrine.html">Databases and the Doctrine ORM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">How to Deploy a Symfony Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../email.html">Swift Mailer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../event_dispatcher.html">Events and Event Listeners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../forms.html">Forms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../frontend.html">Managing CSS and JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../http_cache.html">HTTP Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../http_client.html">HTTP Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lock.html">Dealing with Concurrency with Locks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mailer.html">Sending Emails with Mailer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mercure.html">Pushing Data to Clients Using the Mercure Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../messenger.html">Messenger: Sync &amp; Queued Message Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration.html">Migrating an Existing Application to Symfony</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notifier.html">Creating and Sending Notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profiler.html">Profiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rate_limiter.html">Rate Limiter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../routing.html">Routing</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../security.html">Security</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../security.html#installation">1) Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#a-create-your-user-class">2a) Create your User Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#b-the-user-provider">2b) The “User Provider”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#c-encoding-passwords">2c) Encoding Passwords</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#a-authentication-firewalls">3a) Authentication &amp; Firewalls</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#b-authenticating-your-users">3b) Authenticating your Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#denying-access-roles-and-other-authorization">4) Denying Access, Roles and other Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#a-fetching-the-user-object">5a) Fetching the User Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#b-fetching-the-user-from-a-service">5b) Fetching the User from a Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#logging-out">Logging Out</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#hierarchical-roles">Hierarchical Roles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#frequently-asked-questions">Frequently Asked Questions</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../security.html#learn-more">Learn More</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../security.html#authentication-identifying-logging-in-the-user">Authentication (Identifying/Logging in the User)</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="experimental_authenticators.html">Using the new Authenticator-based Security</a></li>
<li class="toctree-l4"><a class="reference internal" href="form_login_setup.html">How to Build a Login Form</a></li>
<li class="toctree-l4"><a class="reference internal" href="reset_password.html">How to Add a Reset Password Feature</a></li>
<li class="toctree-l4"><a class="reference internal" href="json_login_setup.html">How to Build a JSON Authentication Endpoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="guard_authentication.html">Custom Authentication System with Guard (API Token Example)</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">How to Migrate a Password Hash</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_providers.html">Built-in Authentication Providers</a></li>
<li class="toctree-l4"><a class="reference internal" href="user_provider.html">Security User Providers</a></li>
<li class="toctree-l4"><a class="reference internal" href="ldap.html">Authenticating against an LDAP server</a></li>
<li class="toctree-l4"><a class="reference internal" href="remember_me.html">How to Add “Remember Me” Login Functionality</a></li>
<li class="toctree-l4"><a class="reference internal" href="impersonating_user.html">How to Impersonate a User</a></li>
<li class="toctree-l4"><a class="reference internal" href="user_checkers.html">How to Create and Enable Custom User Checkers</a></li>
<li class="toctree-l4"><a class="reference internal" href="named_encoders.html">How to Use A Different Password Encoder Algorithm Per User</a></li>
<li class="toctree-l4"><a class="reference internal" href="multiple_guard_authenticators.html">How to Use Multiple Guard Authenticators</a></li>
<li class="toctree-l4"><a class="reference internal" href="firewall_restriction.html">How to Restrict Firewalls to a Request</a></li>
<li class="toctree-l4"><a class="reference internal" href="csrf.html">How to Implement CSRF Protection</a></li>
<li class="toctree-l4"><a class="reference internal" href="custom_authentication_provider.html">How to Create a custom Authentication Provider</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../security.html#authorization-denying-access">Authorization (Denying Access)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../session.html">Sessions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup.html">Installing &amp; Setting up the Symfony Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../serializer.html">How to Use the Serializer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../service_container.html">Service Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../translation.html">Translations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../validation.html">Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../web_link.html">Asset Preloading and Resource Hints with HTTP/2 and WebLink</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow.html">Workflow</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../components/index.html">The Components</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference Documents</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../create_framework/index.html">Create your own PHP Framework</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Symfony Framework Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../security.html">Security</a> &raquo;</li>
        
      <li>How to Migrate a Password Hash</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/security/password_migration.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="how-to-migrate-a-password-hash">
<span id="index-0"></span><h1>How to Migrate a Password Hash<a class="headerlink" href="#how-to-migrate-a-password-hash" title="Permalink to this headline">¶</a></h1>
<p>In order to protect passwords, it is recommended to store them using the latest
hash algorithms. This means that if a better hash algorithm is supported on your
system, the user’s password should be <em>rehashed</em> using the newer algorithm and
stored. That’s possible with the <code class="docutils literal notranslate"><span class="pre">migrate_from</span></code> option:</p>
<ol class="arabic simple">
<li><a class="reference internal" href="#configure-a-new-encoder-using-migrate-from">Configure a new Encoder Using “migrate_from”</a></li>
<li><a class="reference internal" href="#upgrade-the-password">Upgrade the Password</a></li>
<li>Optionally, <a class="reference internal" href="#trigger-password-migration-from-a-custom-encoder">Trigger Password Migration From a Custom Encoder</a></li>
</ol>
<div class="section" id="configure-a-new-encoder-using-migrate-from">
<h2>Configure a new Encoder Using “migrate_from”<a class="headerlink" href="#configure-a-new-encoder-using-migrate-from" title="Permalink to this headline">¶</a></h2>
<p>When a better hashing algorithm becomes available, you should keep the existing
encoder(s), rename it, and then define the new one. Set the <code class="docutils literal notranslate"><span class="pre">migrate_from</span></code> option
on the new encoder to point to the old, legacy encoder(s):</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">encoders</span><span class="p p-Indicator">:</span>
        <span class="c1"># an encoder used in the past for some users</span>
        <span class="l l-Scalar l-Scalar-Plain">legacy</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">algorithm</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">sha256</span>
            <span class="l l-Scalar l-Scalar-Plain">encode_as_base64</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
            <span class="l l-Scalar l-Scalar-Plain">iterations</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>

        <span class="l l-Scalar l-Scalar-Plain">App\Entity\User</span><span class="p p-Indicator">:</span>
            <span class="c1"># the new encoder, along with its options</span>
            <span class="l l-Scalar l-Scalar-Plain">algorithm</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">sodium</span>
            <span class="l l-Scalar l-Scalar-Plain">migrate_from</span><span class="p p-Indicator">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bcrypt</span> <span class="c1"># uses the &quot;bcrypt&quot; encoder with the default options</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">legacy</span> <span class="c1"># uses the &quot;legacy&quot; encoder configured above</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:security=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/security</span>
<span class="s">        https://symfony.com/schema/dic/security/security-1.0.xsd</span>
<span class="s">        http://symfony.com/schema/dic/security</span>
<span class="s">        https://symfony.com/schema/dic/security/security-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;security:config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>

        <span class="nt">&lt;security:encoder</span> <span class="na">class=</span><span class="s">&quot;legacy&quot;</span>
            <span class="na">algorithm=</span><span class="s">&quot;sha256&quot;</span>
            <span class="na">encode-as-base64=</span><span class="s">&quot;false&quot;</span>
            <span class="na">iterations=</span><span class="s">&quot;1&quot;</span>
        <span class="nt">/&gt;</span>

        <span class="c">&lt;!-- algorithm: the new encoder, along with its options --&gt;</span>
        <span class="nt">&lt;security:encoder</span> <span class="na">class=</span><span class="s">&quot;App\Entity\User&quot;</span>
            <span class="na">algorithm=</span><span class="s">&quot;sodium&quot;</span>
        <span class="nt">&gt;</span>
            <span class="c">&lt;!-- uses the bcrypt encoder with the default options --&gt;</span>
            <span class="nt">&lt;security:migrate-from&gt;</span>bcrypt<span class="nt">&lt;/security:migrate-from&gt;</span>

            <span class="c">&lt;!-- uses the legacy encoder configured above --&gt;</span>
            <span class="nt">&lt;security:migrate-from&gt;</span>legacy<span class="nt">&lt;/security:migrate-from&gt;</span>
        <span class="nt">&lt;/security:encoder&gt;</span>
    <span class="nt">&lt;/security:config&gt;</span>
<span class="nt">&lt;/container&gt;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="c1">// ...</span>

    <span class="s1">&#39;encoders&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;legacy&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;algorithm&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;sha256&#39;</span><span class="p">,</span>
            <span class="s1">&#39;encode_as_base64&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
            <span class="s1">&#39;iterations&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">],</span>

        <span class="s1">&#39;App\Entity\User&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="c1">// the new encoder, along with its options</span>
            <span class="s1">&#39;algorithm&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;sodium&#39;</span><span class="p">,</span>
            <span class="s1">&#39;migrate_from&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;bcrypt&#39;</span><span class="p">,</span> <span class="c1">// uses the &quot;bcrypt&quot; encoder with the default options</span>
                <span class="s1">&#39;legacy&#39;</span><span class="p">,</span> <span class="c1">// uses the &quot;legacy&quot; encoder configured above</span>
            <span class="p">],</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
<p>With this setup:</p>
<ul class="simple">
<li>New users will be encoded with the new algorithm;</li>
<li>Whenever a user logs in whose password is still stored using the old algorithm,
Symfony will verify the password with the old algorithm and then rehash
and update the password using the new algorithm.</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>The <em>auto</em>, <em>native</em>, <em>bcrypt</em> and <em>argon</em> encoders automatically enable
password migration using the following list of <code class="docutils literal notranslate"><span class="pre">migrate_from</span></code> algorithms:</p>
<ol class="arabic simple">
<li><a class="reference internal" href="../reference/configuration/security.html#reference-security-pbkdf2"><span class="std std-ref">PBKDF2</span></a> (which uses <code class="docutils literal notranslate"><a class="reference external" href="https://www.php.net/manual/en/function.hash-pbkdf2.php" title="hash_pbkdf2"><span class="pre">hash_pbkdf2</span></a></code>);</li>
<li>Message digest (which uses <code class="docutils literal notranslate"><a class="reference external" href="https://www.php.net/manual/en/function.hash.php" title="hash"><span class="pre">hash</span></a></code>)</li>
</ol>
<p class="last">Both use the <code class="docutils literal notranslate"><span class="pre">hash_algorithm</span></code> setting as the algorithm. It is recommended to
use <code class="docutils literal notranslate"><span class="pre">migrate_from</span></code> instead of <code class="docutils literal notranslate"><span class="pre">hash_algorithm</span></code>, unless the <em>auto</em>
encoder is used.</p>
</div>
</div>
<div class="section" id="upgrade-the-password">
<h2>Upgrade the Password<a class="headerlink" href="#upgrade-the-password" title="Permalink to this headline">¶</a></h2>
<p>Upon successful login, the Security system checks whether a better algorithm
is available to hash the user’s password. If it is, it’ll hash the correct
password using the new hash. If you use a Guard authenticator, you first need to
<a class="reference internal" href="#provide-the-password-guard"><span class="std std-ref">provide the original password to the Security system</span></a>.</p>
<p>You can enable the upgrade behavior by implementing how this newly hashed
password should be stored:</p>
<ul class="simple">
<li><a class="reference internal" href="#upgrade-the-password-doctrine"><span class="std std-ref">When using Doctrine’s entity user provider</span></a></li>
<li><a class="reference internal" href="#upgrade-the-password-custom-provider"><span class="std std-ref">When using a custom user provider</span></a></li>
</ul>
<p>After this, you’re done and passwords are always hashed as secure as possible!</p>
<div class="section" id="provide-the-password-when-using-guard">
<span id="provide-the-password-guard"></span><h3>Provide the Password when using Guard<a class="headerlink" href="#provide-the-password-when-using-guard" title="Permalink to this headline">¶</a></h3>
<p>When you’re using a custom <a class="reference internal" href="guard_authentication.html"><span class="doc">guard authenticator</span></a>,
you need to implement <code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Security/Guard/PasswordAuthenticatedInterface.php" title="Symfony\Component\Security\Guard\PasswordAuthenticatedInterface"><span class="pre">PasswordAuthenticatedInterface</span></a></code>.
This interface defines a <code class="docutils literal notranslate"><span class="pre">getPassword()</span></code> method that returns the password
for this login request. This password is used in the migration process:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Security/CustomAuthenticator.php</span>
<span class="k">namespace</span> <span class="nx">App\Security</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Security\Guard\PasswordAuthenticatedInterface</span><span class="p">;</span>
<span class="c1">// ...</span>

<span class="k">class</span> <span class="nc">CustomAuthenticator</span> <span class="k">extends</span> <span class="nx">AbstractGuardAuthenticator</span> <span class="k">implements</span> <span class="nx">PasswordAuthenticatedInterface</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getPassword</span><span class="p">(</span><span class="nv">$credentials</span><span class="p">)</span><span class="o">:</span> <span class="o">?</span><span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$credentials</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="upgrade-the-password-when-using-doctrine">
<span id="upgrade-the-password-doctrine"></span><h3>Upgrade the Password when using Doctrine<a class="headerlink" href="#upgrade-the-password-when-using-doctrine" title="Permalink to this headline">¶</a></h3>
<p>When using the <a class="reference internal" href="user_provider.html#security-entity-user-provider"><span class="std std-ref">entity user provider</span></a>, implement
<code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Security/Core/User/PasswordUpgraderInterface.php" title="Symfony\Component\Security\Core\User\PasswordUpgraderInterface"><span class="pre">PasswordUpgraderInterface</span></a></code> in
the <code class="docutils literal notranslate"><span class="pre">UserRepository</span></code> (see <a class="reference external" href="https://www.doctrine-project.org/projects/doctrine-orm/en/current/reference/working-with-objects.html#custom-repositories">the Doctrine docs for information</a> on how to
create this class if it’s not already created). This interface implements
storing the newly created password hash:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Repository/UserRepository.php</span>
<span class="k">namespace</span> <span class="nx">App\Repository</span><span class="p">;</span>

<span class="c1">// ...</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Security\Core\User\PasswordUpgraderInterface</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserRepository</span> <span class="k">extends</span> <span class="nx">EntityRepository</span> <span class="k">implements</span> <span class="nx">PasswordUpgraderInterface</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">upgradePassword</span><span class="p">(</span><span class="nx">UserInterface</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$newEncodedPassword</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// set the new encoded password on the User object</span>
        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$newEncodedPassword</span><span class="p">);</span>

        <span class="c1">// execute the queries on the database</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getEntityManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="upgrade-the-password-when-using-a-custom-user-provider">
<span id="upgrade-the-password-custom-provider"></span><h3>Upgrade the Password when using a Custom User Provider<a class="headerlink" href="#upgrade-the-password-when-using-a-custom-user-provider" title="Permalink to this headline">¶</a></h3>
<p>If you’re using a <a class="reference internal" href="user_provider.html#custom-user-provider"><span class="std std-ref">custom user provider</span></a>, implement the
<code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Security/Core/User/PasswordUpgraderInterface.php" title="Symfony\Component\Security\Core\User\PasswordUpgraderInterface"><span class="pre">PasswordUpgraderInterface</span></a></code> in
the user provider:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Security/UserProvider.php</span>
<span class="k">namespace</span> <span class="nx">App\Security</span><span class="p">;</span>

<span class="c1">// ...</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Security\Core\User\PasswordUpgraderInterface</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserProvider</span> <span class="k">implements</span> <span class="nx">UserProviderInterface</span><span class="p">,</span> <span class="nx">PasswordUpgraderInterface</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">upgradePassword</span><span class="p">(</span><span class="nx">UserInterface</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$newEncodedPassword</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// set the new encoded password on the User object</span>
        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$newEncodedPassword</span><span class="p">);</span>

        <span class="c1">// ... store the new password</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="trigger-password-migration-from-a-custom-encoder">
<h2>Trigger Password Migration From a Custom Encoder<a class="headerlink" href="#trigger-password-migration-from-a-custom-encoder" title="Permalink to this headline">¶</a></h2>
<p>If you’re using a custom password encoder, you can trigger the password
migration by returning <code class="docutils literal notranslate"><span class="pre">true</span></code> in the <code class="docutils literal notranslate"><span class="pre">needsRehash()</span></code> method:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Security/CustomPasswordEncoder.php</span>
<span class="k">namespace</span> <span class="nx">App\Security</span><span class="p">;</span>

<span class="c1">// ...</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Security\Core\Encoder\PasswordEncoderInterface</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CustomPasswordEncoder</span> <span class="k">implements</span> <span class="nx">PasswordEncoderInterface</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">needsRehash</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$encoded</span><span class="p">)</span><span class="o">:</span> <span class="nx">bool</span>
    <span class="p">{</span>
        <span class="c1">// check whether the current password is hash using an outdated encoder</span>
        <span class="nv">$hashIsOutdated</span> <span class="o">=</span> <span class="o">...</span><span class="p">;</span>

        <span class="k">return</span> <span class="nv">$hashIsOutdated</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2004-2020 Fabien Potencier

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>