

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>How to Configure a Service with a Configurator &mdash; Symfony Framework Documentation  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/rtd_custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to Debug the Service Container &amp; List Services" href="debug.html" />
    <link rel="prev" title="How to Work with Compiler Passes" href="compiler_passes.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #f0f0f0" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/symfony-logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                5.2}
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../quick_tour/index.html">The Quick Tour</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../best_practices.html">The Symfony Framework Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bundles.html">The Bundle System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cache.html">Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console.html">Console Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doctrine.html">Databases and the Doctrine ORM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">How to Deploy a Symfony Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../email.html">Swift Mailer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../event_dispatcher.html">Events and Event Listeners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../forms.html">Forms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../frontend.html">Managing CSS and JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../http_cache.html">HTTP Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../http_client.html">HTTP Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lock.html">Dealing with Concurrency with Locks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mailer.html">Sending Emails with Mailer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mercure.html">Pushing Data to Clients Using the Mercure Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../messenger.html">Messenger: Sync &amp; Queued Message Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration.html">Migrating an Existing Application to Symfony</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notifier.html">Creating and Sending Notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profiler.html">Profiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rate_limiter.html">Rate Limiter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../routing.html">Routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session.html">Sessions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup.html">Installing &amp; Setting up the Symfony Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../serializer.html">How to Use the Serializer</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../service_container.html">Service Container</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../service_container.html#fetching-and-using-services">Fetching and using Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../service_container.html#creating-configuring-services-in-the-container">Creating/Configuring Services in the Container</a></li>
<li class="toctree-l2"><a class="reference internal" href="../service_container.html#injecting-services-config-into-a-service">Injecting Services/Config into a Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../service_container.html#service-parameters">Service Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../service_container.html#choose-a-specific-service">Choose a Specific Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../service_container.html#binding-arguments-by-name-or-type">Binding Arguments by Name or Type</a></li>
<li class="toctree-l2"><a class="reference internal" href="../service_container.html#the-autowire-option">The autowire Option</a></li>
<li class="toctree-l2"><a class="reference internal" href="../service_container.html#the-autoconfigure-option">The autoconfigure Option</a></li>
<li class="toctree-l2"><a class="reference internal" href="../service_container.html#linting-service-definitions">Linting Service Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../service_container.html#public-versus-private-services">Public Versus Private Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../service_container.html#importing-many-services-at-once-with-resource">Importing Many Services at once with resource</a></li>
<li class="toctree-l2"><a class="reference internal" href="../service_container.html#explicitly-configuring-services-and-arguments">Explicitly Configuring Services and Arguments</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../service_container.html#learn-more">Learn more</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="alias_private.html">How to Create Service Aliases and Mark Services as Private</a></li>
<li class="toctree-l3"><a class="reference internal" href="autowiring.html">Defining Services Dependencies Automatically (Autowiring)</a></li>
<li class="toctree-l3"><a class="reference internal" href="calls.html">Service Method Calls and Setter Injection</a></li>
<li class="toctree-l3"><a class="reference internal" href="compiler_passes.html">How to Work with Compiler Passes</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">How to Configure a Service with a Configurator</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#using-the-configurator">Using the Configurator</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="debug.html">How to Debug the Service Container &amp; List Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="definitions.html">How to work with Service Definition Objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="expression_language.html">How to Inject Values Based on Complex Expressions</a></li>
<li class="toctree-l3"><a class="reference internal" href="factories.html">Using a Factory to Create Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="import.html">How to Import Configuration Files/Resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="injection_types.html">Types of Injection</a></li>
<li class="toctree-l3"><a class="reference internal" href="lazy_services.html">Lazy Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="optional_dependencies.html">How to Make Service Arguments/References Optional</a></li>
<li class="toctree-l3"><a class="reference internal" href="parent_services.html">How to Manage Common Dependencies with Parent Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="request.html">How to Retrieve the Request from the Service Container</a></li>
<li class="toctree-l3"><a class="reference internal" href="service_decoration.html">How to Decorate Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="service_subscribers_locators.html">Service Subscribers &amp; Locators</a></li>
<li class="toctree-l3"><a class="reference internal" href="shared.html">How to Define Non Shared Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="synthetic_services.html">How to Inject Instances into the Container</a></li>
<li class="toctree-l3"><a class="reference internal" href="tags.html">How to Work with Service Tags</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../translation.html">Translations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../validation.html">Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../web_link.html">Asset Preloading and Resource Hints with HTTP/2 and WebLink</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow.html">Workflow</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../components/index.html">The Components</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference Documents</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../create_framework/index.html">Create your own PHP Framework</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Symfony Framework Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../service_container.html">Service Container</a> &raquo;</li>
        
      <li>How to Configure a Service with a Configurator</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/service_container/configurators.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="how-to-configure-a-service-with-a-configurator">
<span id="index-0"></span><h1>How to Configure a Service with a Configurator<a class="headerlink" href="#how-to-configure-a-service-with-a-configurator" title="Permalink to this headline">¶</a></h1>
<p>The <em>service configurator</em> is a feature of the service container that allows
you to use a callable to configure a service after its instantiation.</p>
<p>A service configurator can be used, for example, when you have a service
that requires complex setup based on configuration settings coming from
different sources/services. Using an external configurator, you can maintain
the service implementation cleanly and keep it decoupled from the other
objects that provide the configuration needed.</p>
<p>Another use case is when you have multiple objects that share a common
configuration or that should be configured in a similar way at runtime.</p>
<p>For example, suppose you have an application where you send different types
of emails to users. Emails are passed through different formatters that
could be enabled or not depending on some dynamic application settings.
You start defining a <code class="docutils literal notranslate"><span class="pre">NewsletterManager</span></code> class like this:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Mail/NewsletterManager.php</span>
<span class="k">namespace</span> <span class="nx">App\Mail</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">NewsletterManager</span> <span class="k">implements</span> <span class="nx">EmailFormatterAwareInterface</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$enabledFormatters</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setEnabledFormatters</span><span class="p">(</span><span class="k">array</span> <span class="nv">$enabledFormatters</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">enabledFormatters</span> <span class="o">=</span> <span class="nv">$enabledFormatters</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>and also a <code class="docutils literal notranslate"><span class="pre">GreetingCardManager</span></code> class:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Mail/GreetingCardManager.php</span>
<span class="k">namespace</span> <span class="nx">App\Mail</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">GreetingCardManager</span> <span class="k">implements</span> <span class="nx">EmailFormatterAwareInterface</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$enabledFormatters</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setEnabledFormatters</span><span class="p">(</span><span class="k">array</span> <span class="nv">$enabledFormatters</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">enabledFormatters</span> <span class="o">=</span> <span class="nv">$enabledFormatters</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As mentioned before, the goal is to set the formatters at runtime depending
on application settings. To do this, you also have an <code class="docutils literal notranslate"><span class="pre">EmailFormatterManager</span></code>
class which is responsible for loading and validating formatters enabled
in the application:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Mail/EmailFormatterManager.php</span>
<span class="k">namespace</span> <span class="nx">App\Mail</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">EmailFormatterManager</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getEnabledFormatters</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="c1">// code to configure which formatters to use</span>
        <span class="nv">$enabledFormatters</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">];</span>

        <span class="c1">// ...</span>

        <span class="k">return</span> <span class="nv">$enabledFormatters</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If your goal is to avoid having to couple <code class="docutils literal notranslate"><span class="pre">NewsletterManager</span></code> and
<code class="docutils literal notranslate"><span class="pre">GreetingCardManager</span></code> with <code class="docutils literal notranslate"><span class="pre">EmailFormatterManager</span></code>, then you might want
to create a configurator class to configure these instances:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Mail/EmailConfigurator.php</span>
<span class="k">namespace</span> <span class="nx">App\Mail</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">EmailConfigurator</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$formatterManager</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">EmailFormatterManager</span> <span class="nv">$formatterManager</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">formatterManager</span> <span class="o">=</span> <span class="nv">$formatterManager</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">configure</span><span class="p">(</span><span class="nx">EmailFormatterAwareInterface</span> <span class="nv">$emailManager</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$emailManager</span><span class="o">-&gt;</span><span class="na">setEnabledFormatters</span><span class="p">(</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">formatterManager</span><span class="o">-&gt;</span><span class="na">getEnabledFormatters</span><span class="p">()</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">EmailConfigurator</span></code>’s job is to inject the enabled formatters into
<code class="docutils literal notranslate"><span class="pre">NewsletterManager</span></code> and <code class="docutils literal notranslate"><span class="pre">GreetingCardManager</span></code> because they are not aware of
where the enabled formatters come from. On the other hand, the
<code class="docutils literal notranslate"><span class="pre">EmailFormatterManager</span></code> holds the knowledge about the enabled formatters and
how to load them, keeping the single responsibility principle.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">While this example uses a PHP class method, configurators can be any valid
PHP callable, including functions, static methods and methods of services.</p>
</div>
<div class="section" id="using-the-configurator">
<h2>Using the Configurator<a class="headerlink" href="#using-the-configurator" title="Permalink to this headline">¶</a></h2>
<p>You can configure the service configurator using the <code class="docutils literal notranslate"><span class="pre">configurator</span></code> option. If
you’re using the <a class="reference internal" href="../service_container.html#service-container-services-load-example"><span class="std std-ref">default services.yaml configuration</span></a>,
all the classes are already loaded as services. All you need to do is specify the
<code class="docutils literal notranslate"><span class="pre">configurator</span></code>:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/services.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">services</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="c1"># Registers all 4 classes as services, including App\Mail\EmailConfigurator</span>
    <span class="l l-Scalar l-Scalar-Plain">App\</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">resource</span><span class="p p-Indicator">:</span> <span class="s">&#39;../src/*&#39;</span>
        <span class="c1"># ...</span>

    <span class="c1"># override the services to set the configurator</span>
    <span class="l l-Scalar l-Scalar-Plain">App\Mail\NewsletterManager</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">configurator</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;@App\Mail\EmailConfigurator&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;configure&#39;</span><span class="p p-Indicator">]</span>

    <span class="l l-Scalar l-Scalar-Plain">App\Mail\GreetingCardManager</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">configurator</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;@App\Mail\EmailConfigurator&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;configure&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/services.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;services&gt;</span>
        <span class="nt">&lt;prototype</span> <span class="na">namespace=</span><span class="s">&quot;App\&quot;</span> <span class="na">resource=</span><span class="s">&quot;../src/*&quot;</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;service</span> <span class="na">id=</span><span class="s">&quot;App\Mail\NewsletterManager&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;configurator</span> <span class="na">service=</span><span class="s">&quot;App\Mail\EmailConfigurator&quot;</span> <span class="na">method=</span><span class="s">&quot;configure&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/service&gt;</span>

        <span class="nt">&lt;service</span> <span class="na">id=</span><span class="s">&quot;App\Mail\GreetingCardManager&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;configurator</span> <span class="na">service=</span><span class="s">&quot;App\Mail\EmailConfigurator&quot;</span> <span class="na">method=</span><span class="s">&quot;configure&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/service&gt;</span>
    <span class="nt">&lt;/services&gt;</span>
<span class="nt">&lt;/container&gt;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/services.php</span>
<span class="k">namespace</span> <span class="nx">Symfony\Component\DependencyInjection\Loader\Configurator</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Mail\EmailConfigurator</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Mail\GreetingCardManager</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Mail\NewsletterManager</span><span class="p">;</span>

<span class="k">return</span> <span class="k">function</span><span class="p">(</span><span class="nx">ContainerConfigurator</span> <span class="nv">$configurator</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$services</span> <span class="o">=</span> <span class="nv">$configurator</span><span class="o">-&gt;</span><span class="na">services</span><span class="p">();</span>

    <span class="c1">// Registers all 4 classes as services, including App\Mail\EmailConfigurator</span>
    <span class="nv">$services</span><span class="o">-&gt;</span><span class="na">load</span><span class="p">(</span><span class="s1">&#39;App\\&#39;</span><span class="p">,</span> <span class="s1">&#39;../src/*&#39;</span><span class="p">);</span>

    <span class="c1">// override the services to set the configurator</span>
    <span class="c1">// In versions earlier to Symfony 5.1 the service() function was called ref()</span>
    <span class="nv">$services</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="nx">NewsletterManager</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">configurator</span><span class="p">(</span><span class="nx">service</span><span class="p">(</span><span class="nx">EmailConfigurator</span><span class="o">::</span><span class="na">class</span><span class="p">),</span> <span class="s1">&#39;configure&#39;</span><span class="p">);</span>

    <span class="nv">$services</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="nx">GreetingCardManager</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">configurator</span><span class="p">(</span><span class="nx">service</span><span class="p">(</span><span class="nx">EmailConfigurator</span><span class="o">::</span><span class="na">class</span><span class="p">),</span> <span class="s1">&#39;configure&#39;</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
<p id="configurators-invokable">Services can be configured via invokable configurators (replacing the
<code class="docutils literal notranslate"><span class="pre">configure()</span></code> method with <code class="docutils literal notranslate"><span class="pre">__invoke()</span></code>) by omitting the method name:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/services.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">services</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="c1"># registers all classes as services, including App\Mail\EmailConfigurator</span>
    <span class="l l-Scalar l-Scalar-Plain">App\</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">resource</span><span class="p p-Indicator">:</span> <span class="s">&#39;../src/*&#39;</span>
        <span class="c1"># ...</span>

    <span class="c1"># override the services to set the configurator</span>
    <span class="l l-Scalar l-Scalar-Plain">App\Mail\NewsletterManager</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">configurator</span><span class="p p-Indicator">:</span> <span class="s">&#39;@App\Mail\EmailConfigurator&#39;</span>

    <span class="l l-Scalar l-Scalar-Plain">App\Mail\GreetingCardManager</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">configurator</span><span class="p p-Indicator">:</span> <span class="s">&#39;@App\Mail\EmailConfigurator&#39;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/services.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;services&gt;</span>
        <span class="nt">&lt;prototype</span> <span class="na">namespace=</span><span class="s">&quot;App\&quot;</span> <span class="na">resource=</span><span class="s">&quot;../src/*&quot;</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;service</span> <span class="na">id=</span><span class="s">&quot;App\Mail\NewsletterManager&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;configurator</span> <span class="na">service=</span><span class="s">&quot;App\Mail\EmailConfigurator&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/service&gt;</span>

        <span class="nt">&lt;service</span> <span class="na">id=</span><span class="s">&quot;App\Mail\GreetingCardManager&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;configurator</span> <span class="na">service=</span><span class="s">&quot;App\Mail\EmailConfigurator&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/service&gt;</span>
    <span class="nt">&lt;/services&gt;</span>
<span class="nt">&lt;/container&gt;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/services.php</span>
<span class="k">namespace</span> <span class="nx">Symfony\Component\DependencyInjection\Loader\Configurator</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Mail\GreetingCardManager</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Mail\NewsletterManager</span><span class="p">;</span>

<span class="k">return</span> <span class="k">function</span><span class="p">(</span><span class="nx">ContainerConfigurator</span> <span class="nv">$configurator</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$services</span> <span class="o">=</span> <span class="nv">$configurator</span><span class="o">-&gt;</span><span class="na">services</span><span class="p">();</span>

    <span class="c1">// Registers all 4 classes as services, including App\Mail\EmailConfigurator</span>
    <span class="nv">$services</span><span class="o">-&gt;</span><span class="na">load</span><span class="p">(</span><span class="s1">&#39;App\\&#39;</span><span class="p">,</span> <span class="s1">&#39;../src/*&#39;</span><span class="p">);</span>

    <span class="c1">// override the services to set the configurator</span>
    <span class="nv">$services</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="nx">NewsletterManager</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">configurator</span><span class="p">(</span><span class="nx">service</span><span class="p">(</span><span class="nx">EmailConfigurator</span><span class="o">::</span><span class="na">class</span><span class="p">));</span>

    <span class="nv">$services</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="nx">GreetingCardManager</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">configurator</span><span class="p">(</span><span class="nx">service</span><span class="p">(</span><span class="nx">EmailConfigurator</span><span class="o">::</span><span class="na">class</span><span class="p">));</span>
<span class="p">};</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
<p>That’s it! When requesting the <code class="docutils literal notranslate"><span class="pre">App\Mail\NewsletterManager</span></code> or
<code class="docutils literal notranslate"><span class="pre">App\Mail\GreetingCardManager</span></code> service, the created instance will first be
passed to the <code class="docutils literal notranslate"><span class="pre">EmailConfigurator::configure()</span></code> method.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2004-2020 Fabien Potencier

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>