<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <title>Authenticating against an LDAP server</title>
    <link rel="stylesheet" href="../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/rtd_custom.css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <div class="section" id="authenticating-against-an-ldap-server">
<span id="index-0"></span><h1>Authenticating against an LDAP server</h1>
<p>Symfony provides different means to work with an LDAP server.</p>
<p>The Security component offers:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">ldap</span></code> <a class="reference internal" href="user_provider.xhtml"><span class="doc">user provider</span></a>, using the
<code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Ldap/Security/LdapUserProvider.php" title="Symfony\Component\Ldap\Security\LdapUserProvider"><span class="pre">LdapUserProvider</span></a><span class="link-target"> <span class="pre">[https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Ldap/Security/LdapUserProvider.php]</span></span></code>
class. Like all other user providers, it can be used with any
authentication provider.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">form_login_ldap</span></code> authentication provider, for authenticating
against an LDAP server using a login form. Like all other
authentication providers, it can be used with any user provider.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">http_basic_ldap</span></code> authentication provider, for authenticating
against an LDAP server using HTTP Basic. Like all other
authentication providers, it can be used with any user provider.</p></li>
</ul>
<p>This means that the following scenarios will work:</p>
<ul class="simple">
<li><p>Checking a user’s password and fetching user information against an
LDAP server. This can be done using both the LDAP user provider and
either the LDAP form login or LDAP HTTP Basic authentication providers.</p></li>
<li><p>Checking a user’s password against an LDAP server while fetching user
information from another source (database using FOSUserBundle, for
example).</p></li>
<li><p>Loading user information from an LDAP server, while using another
authentication strategy (token-based pre-authentication, for example).</p></li>
</ul>
<div class="deprecated">
<p><span class="versionmodified">Deprecated since version 4.4: </span>The class <code class="docutils literal notranslate"><span class="pre">Symfony\Component\Security\Core\User\LdapUserProvider</span></code>
has been deprecated in Symfony 4.4. Use the class
<code class="docutils literal notranslate"><span class="pre">Symfony\Component\Ldap\Security\LdapUserProvider</span></code> instead.</p>
</div>
<div class="section" id="installation">
<h2>Installation</h2>
<p>In applications using <a class="reference internal" href="../setup.xhtml#symfony-flex"><span class="std std-ref">Symfony Flex</span></a>, run this command to
install the Ldap component before using it:</p>
<div class="highlight-terminal notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> composer require symfony/ldap
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="ldap-configuration-reference">
<h2>Ldap Configuration Reference</h2>
<p>See <a class="reference internal" href="../reference/configuration/security.xhtml"><span class="doc">Security Configuration Reference (SecurityBundle)</span></a> for the full LDAP
configuration reference (<code class="docutils literal notranslate"><span class="pre">form_login_ldap</span></code>, <code class="docutils literal notranslate"><span class="pre">http_basic_ldap</span></code>, <code class="docutils literal notranslate"><span class="pre">ldap</span></code>).
Some of the more interesting options are explained below.</p>
</div>
<div class="section" id="configuring-the-ldap-client">
<h2>Configuring the LDAP client</h2>
<p>All mechanisms actually need an LDAP client previously configured.
The providers are configured to use a default service named <code class="docutils literal notranslate"><span class="pre">ldap</span></code>,
but you can override this setting in the security component’s
configuration.</p>
<p>An LDAP client can be configured using the built-in
<a class="reference external" href="https://www.php.net/manual/en/intro.ldap.php">LDAP PHP extension</a><span class="link-target"> [https://www.php.net/manual/en/intro.ldap.php]</span> with the following service definition:</p>
<div class="configuration-block">
<ul class="simple">
<li><p><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/services.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">services</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">Symfony\Component\Ldap\Ldap</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">arguments</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;@Symfony\Component\Ldap\Adapter\ExtLdap\Adapter&#39;</span><span class="p p-Indicator">]</span>
    <span class="l l-Scalar l-Scalar-Plain">Symfony\Component\Ldap\Adapter\ExtLdap\Adapter</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">arguments</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span>   <span class="l l-Scalar l-Scalar-Plain">host</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my-server</span>
                <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">389</span>
                <span class="l l-Scalar l-Scalar-Plain">encryption</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">tls</span>
                <span class="l l-Scalar l-Scalar-Plain">options</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">protocol_version</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
                    <span class="l l-Scalar l-Scalar-Plain">referrals</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</td></tr></table></div>
</p></li>
<li><p><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/services.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services https://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;services&gt;</span>
        <span class="nt">&lt;service</span> <span class="na">id=</span><span class="s">&quot;Symfony\Component\Ldap\Ldap&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;argument</span> <span class="na">type=</span><span class="s">&quot;service&quot;</span> <span class="na">id=</span><span class="s">&quot;Symfony\Component\Ldap\Adapter\ExtLdap\Adapter&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/service&gt;</span>
        <span class="nt">&lt;service</span> <span class="na">id=</span><span class="s">&quot;Symfony\Component\Ldap\Adapter\ExtLdap\Adapter&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;argument</span> <span class="na">type=</span><span class="s">&quot;collection&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;argument</span> <span class="na">key=</span><span class="s">&quot;host&quot;</span><span class="nt">&gt;</span>my-server<span class="nt">&lt;/argument&gt;</span>
                <span class="nt">&lt;argument</span> <span class="na">key=</span><span class="s">&quot;port&quot;</span><span class="nt">&gt;</span>389<span class="nt">&lt;/argument&gt;</span>
                <span class="nt">&lt;argument</span> <span class="na">key=</span><span class="s">&quot;encryption&quot;</span><span class="nt">&gt;</span>tls<span class="nt">&lt;/argument&gt;</span>
                <span class="nt">&lt;argument</span> <span class="na">key=</span><span class="s">&quot;options&quot;</span> <span class="na">type=</span><span class="s">&quot;collection&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;argument</span> <span class="na">key=</span><span class="s">&quot;protocol_version&quot;</span><span class="nt">&gt;</span>3<span class="nt">&lt;/argument&gt;</span>
                    <span class="nt">&lt;argument</span> <span class="na">key=</span><span class="s">&quot;referrals&quot;</span><span class="nt">&gt;</span>false<span class="nt">&lt;/argument&gt;</span>
                <span class="nt">&lt;/argument&gt;</span>
            <span class="nt">&lt;/argument&gt;</span>
        <span class="nt">&lt;/service&gt;</span>
    <span class="nt">&lt;/services&gt;</span>
<span class="nt">&lt;/container&gt;</span>
</pre></div>
</td></tr></table></div>
</p></li>
<li><p><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/services.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Ldap\Adapter\ExtLdap\Adapter</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Ldap\Ldap</span><span class="p">;</span>

<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">(</span><span class="nx">Ldap</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">addArgument</span><span class="p">(</span><span class="k">new</span> <span class="nx">Reference</span><span class="p">(</span><span class="nx">Adapter</span><span class="o">::</span><span class="na">class</span><span class="p">));</span>

<span class="nv">$container</span>
    <span class="o">-&gt;</span><span class="na">register</span><span class="p">(</span><span class="nx">Adapter</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">setArguments</span><span class="p">([</span>
        <span class="s1">&#39;host&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;my-server&#39;</span><span class="p">,</span>
        <span class="s1">&#39;port&#39;</span> <span class="o">=&gt;</span> <span class="mi">389</span><span class="p">,</span>
        <span class="s1">&#39;encryption&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;tls&#39;</span><span class="p">,</span>
        <span class="s1">&#39;options&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;protocol_version&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s1">&#39;referrals&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span>
        <span class="p">],</span>
    <span class="p">]);</span>
</pre></div>
</td></tr></table></div>
</p></li>
</ul>
</div>
</div>
<div class="section" id="fetching-users-using-the-ldap-user-provider">
<h2>Fetching Users Using the LDAP User Provider</h2>
<p>If you want to fetch user information from an LDAP server, you may want to
use the <code class="docutils literal notranslate"><span class="pre">ldap</span></code> user provider.</p>
<div class="configuration-block">
<ul class="simple">
<li><p><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">providers</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">my_ldap</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">ldap</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">service</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Symfony\Component\Ldap\Ldap</span>
                <span class="l l-Scalar l-Scalar-Plain">base_dn</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dc=example,dc=com</span>
                <span class="l l-Scalar l-Scalar-Plain">search_dn</span><span class="p p-Indicator">:</span> <span class="s">&quot;cn=read-only-admin,dc=example,dc=com&quot;</span>
                <span class="l l-Scalar l-Scalar-Plain">search_password</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">password</span>
                <span class="l l-Scalar l-Scalar-Plain">default_roles</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ROLE_USER</span>
                <span class="l l-Scalar l-Scalar-Plain">uid_key</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">uid</span>
                <span class="l l-Scalar l-Scalar-Plain">extra_fields</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;email&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</td></tr></table></div>
</p></li>
<li><p><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="nt">&lt;provider</span> <span class="na">name=</span><span class="s">&quot;my_ldap&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;ldap</span> <span class="na">service=</span><span class="s">&quot;Symfony\Component\Ldap\Ldap&quot;</span>
                <span class="na">base-dn=</span><span class="s">&quot;dc=example,dc=com&quot;</span>
                <span class="na">search-dn=</span><span class="s">&quot;cn=read-only-admin,dc=example,dc=com&quot;</span>
                <span class="na">search-password=</span><span class="s">&quot;password&quot;</span>
                <span class="na">default-roles=</span><span class="s">&quot;ROLE_USER&quot;</span>
                <span class="na">uid-key=</span><span class="s">&quot;uid&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/provider&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div>
</p></li>
<li><p><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Ldap\Ldap</span><span class="p">;</span>

<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;providers&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;ldap_users&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;ldap&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;service&#39;</span> <span class="o">=&gt;</span> <span class="nx">Ldap</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
                <span class="s1">&#39;base_dn&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;dc=example,dc=com&#39;</span><span class="p">,</span>
                <span class="s1">&#39;search_dn&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;cn=read-only-admin,dc=example,dc=com&#39;</span><span class="p">,</span>
                <span class="s1">&#39;search_password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>
                <span class="s1">&#39;default_roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_USER&#39;</span><span class="p">,</span>
                <span class="s1">&#39;uid_key&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;uid&#39;</span><span class="p">,</span>
                <span class="s1">&#39;extra_fields&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">],</span>
            <span class="p">],</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">];</span>
</pre></div>
</td></tr></table></div>
</p></li>
</ul>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The Security component escapes provided input data when the LDAP user
provider is used. However, the LDAP component itself does not provide
any escaping yet. Thus, it’s your responsibility to prevent LDAP injection
attacks when using the component directly.</p>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The user configured above in the user provider is only used to retrieve
data. It’s a static user defined by its username and password (for improved
security, define the password as an environment variable).</p>
<p>If your LDAP server allows retrieval of information anonymously, you can
set the <code class="docutils literal notranslate"><span class="pre">search_dn</span></code> and <code class="docutils literal notranslate"><span class="pre">search_password</span></code> options to <code class="docutils literal notranslate"><span class="pre">null</span></code>.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ldap</span></code> user provider supports many different configuration options:</p>
<div class="section" id="service">
<h3>service</h3>
<p><strong>type</strong>: <code class="docutils literal notranslate"><span class="pre">string</span></code> <strong>default</strong>: <code class="docutils literal notranslate"><span class="pre">ldap</span></code></p>
<p>This is the name of your configured LDAP client. You can freely choose the
name, but it must be unique in your application and it cannot start with a
number or contain white spaces.</p>
</div>
<div class="section" id="base-dn">
<h3>base_dn</h3>
<p><strong>type</strong>: <code class="docutils literal notranslate"><span class="pre">string</span></code> <strong>default</strong>: <code class="docutils literal notranslate"><span class="pre">null</span></code></p>
<p>This is the base DN for the directory</p>
</div>
<div class="section" id="search-dn">
<h3>search_dn</h3>
<p><strong>type</strong>: <code class="docutils literal notranslate"><span class="pre">string</span></code> <strong>default</strong>: <code class="docutils literal notranslate"><span class="pre">null</span></code></p>
<p>This is your read-only user’s DN, which will be used to authenticate
against the LDAP server to fetch the user’s information.</p>
</div>
<div class="section" id="search-password">
<h3>search_password</h3>
<p><strong>type</strong>: <code class="docutils literal notranslate"><span class="pre">string</span></code> <strong>default</strong>: <code class="docutils literal notranslate"><span class="pre">null</span></code></p>
<p>This is your read-only user’s password, which will be used to authenticate
against the LDAP server to fetch the user’s information.</p>
</div>
<div class="section" id="default-roles">
<h3>default_roles</h3>
<p><strong>type</strong>: <code class="docutils literal notranslate"><span class="pre">array</span></code> <strong>default</strong>: <code class="docutils literal notranslate"><span class="pre">[]</span></code></p>
<p>This is the default role you wish to give to a user fetched from the LDAP
server. If you do not configure this key, your users won’t have any roles,
and will not be considered as authenticated fully.</p>
</div>
<div class="section" id="uid-key">
<h3>uid_key</h3>
<p><strong>type</strong>: <code class="docutils literal notranslate"><span class="pre">string</span></code> <strong>default</strong>: <code class="docutils literal notranslate"><span class="pre">null</span></code></p>
<p>This is the entry’s key to use as its UID. Depends on your LDAP server
implementation. Commonly used values are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sAMAccountName</span></code> (default)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">userPrincipalName</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uid</span></code></p></li>
</ul>
<p>If you pass <code class="docutils literal notranslate"><span class="pre">null</span></code> as the value of this option, the default UID key is used
<code class="docutils literal notranslate"><span class="pre">sAMAccountName</span></code>.</p>
</div>
<div class="section" id="extra-fields">
<h3>extra_fields</h3>
<p><strong>type</strong>: <code class="docutils literal notranslate"><span class="pre">array</span></code> <strong>default</strong>: <code class="docutils literal notranslate"><span class="pre">null</span></code></p>
<div class="versionadded">
<p><span class="versionmodified">New in version 4.4: </span>The <code class="docutils literal notranslate"><span class="pre">extra_fields</span></code> option was introduced in Symfony 4.4.</p>
</div>
<p>Defines the custom fields to pull from the LDAP server. If any field does not
exist, an <code class="docutils literal notranslate"><span class="pre">\InvalidArgumentException</span></code> will be thrown.</p>
</div>
<div class="section" id="filter">
<h3>filter</h3>
<p><strong>type</strong>: <code class="docutils literal notranslate"><span class="pre">string</span></code> <strong>default</strong>: <code class="docutils literal notranslate"><span class="pre">null</span></code></p>
<p>This key lets you configure which LDAP query will be used. The <code class="docutils literal notranslate"><span class="pre">{uid_key}</span></code>
string will be replaced by the value of the <code class="docutils literal notranslate"><span class="pre">uid_key</span></code> configuration value
(by default, <code class="docutils literal notranslate"><span class="pre">sAMAccountName</span></code>), and the <code class="docutils literal notranslate"><span class="pre">{username}</span></code> string will be
replaced by the username you are trying to load.</p>
<p>For example, with a <code class="docutils literal notranslate"><span class="pre">uid_key</span></code> of <code class="docutils literal notranslate"><span class="pre">uid</span></code>, and if you are trying to
load the user <code class="docutils literal notranslate"><span class="pre">fabpot</span></code>, the final string will be: <code class="docutils literal notranslate"><span class="pre">(uid=fabpot)</span></code>.</p>
<p>If you pass <code class="docutils literal notranslate"><span class="pre">null</span></code> as the value of this option, the default filter is used
<code class="docutils literal notranslate"><span class="pre">({uid_key}={username})</span></code>.</p>
<p>To prevent <a class="reference external" href="http://projects.webappsec.org/w/page/13246947/LDAP%20Injection">LDAP injection</a><span class="link-target"> [http://projects.webappsec.org/w/page/13246947/LDAP%20Injection]</span>, the username will be escaped.</p>
<p>The syntax for the <code class="docutils literal notranslate"><span class="pre">filter</span></code> key is defined by <a class="reference external" href="http://www.faqs.org/rfcs/rfc4515.html">RFC4515</a><span class="link-target"> [http://www.faqs.org/rfcs/rfc4515.html]</span>.</p>
</div>
</div>
<div class="section" id="id1">
<h2>Authenticating against an LDAP server</h2>
<p>Authenticating against an LDAP server can be done using either the form
login or the HTTP Basic authentication providers.</p>
<p>They are configured exactly as their non-LDAP counterparts, with the
addition of two configuration keys and one optional key:</p>
<div class="section" id="id2">
<h3>service</h3>
<p><strong>type</strong>: <code class="docutils literal notranslate"><span class="pre">string</span></code> <strong>default</strong>: <code class="docutils literal notranslate"><span class="pre">ldap</span></code></p>
<p>This is the name of your configured LDAP client. You can freely choose the
name, but it must be unique in your application and it cannot start with a
number or contain white spaces.</p>
</div>
<div class="section" id="dn-string">
<h3>dn_string</h3>
<p><strong>type</strong>: <code class="docutils literal notranslate"><span class="pre">string</span></code> <strong>default</strong>: <code class="docutils literal notranslate"><span class="pre">{username}</span></code></p>
<p>This key defines the form of the string used to compose the
DN of the user, from the username. The <code class="docutils literal notranslate"><span class="pre">{username}</span></code> string is
replaced by the actual username of the person trying to authenticate.</p>
<p>For example, if your users have DN strings in the form
<code class="docutils literal notranslate"><span class="pre">uid=einstein,dc=example,dc=com</span></code>, then the <code class="docutils literal notranslate"><span class="pre">dn_string</span></code> will be
<code class="docutils literal notranslate"><span class="pre">uid={username},dc=example,dc=com</span></code>.</p>
</div>
<div class="section" id="query-string">
<h3>query_string</h3>
<p><strong>type</strong>: <code class="docutils literal notranslate"><span class="pre">string</span></code> <strong>default</strong>: <code class="docutils literal notranslate"><span class="pre">null</span></code></p>
<p>This (optional) key makes the user provider search for a user and then use the
found DN for the bind process. This is useful when using multiple LDAP user
providers with different <code class="docutils literal notranslate"><span class="pre">base_dn</span></code>. The value of this option must be a valid
search string (e.g. <code class="docutils literal notranslate"><span class="pre">uid=&quot;{username}&quot;</span></code>). The placeholder value will be
replaced by the actual username.</p>
<p>When this option is used, <code class="docutils literal notranslate"><span class="pre">query_string</span></code> will search in the DN specified by
<code class="docutils literal notranslate"><span class="pre">dn_string</span></code> and the DN resulted of the <code class="docutils literal notranslate"><span class="pre">query_string</span></code> will be used to
authenticate the user with their password. Following the previous example, if
your users have the following two DN: <code class="docutils literal notranslate"><span class="pre">dc=companyA,dc=example,dc=com</span></code> and
<code class="docutils literal notranslate"><span class="pre">dc=companyB,dc=example,dc=com</span></code>, then <code class="docutils literal notranslate"><span class="pre">dn_string</span></code> should be
<code class="docutils literal notranslate"><span class="pre">dc=example,dc=com</span></code>.</p>
<p>Bear in mind that usernames must be unique across both DN, as the authentication
provider won’t be able to select the correct user for the bind process if more
than one is found.</p>
<p>Examples are provided below, for both <code class="docutils literal notranslate"><span class="pre">form_login_ldap</span></code> and
<code class="docutils literal notranslate"><span class="pre">http_basic_ldap</span></code>.</p>
</div>
<div class="section" id="configuration-example-for-form-login">
<h3>Configuration example for form login</h3>
<div class="configuration-block">
<ul class="simple">
<li><p><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">firewalls</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">main</span><span class="p p-Indicator">:</span>
            <span class="c1"># ...</span>
            <span class="l l-Scalar l-Scalar-Plain">form_login_ldap</span><span class="p p-Indicator">:</span>
                <span class="c1"># ...</span>
                <span class="l l-Scalar l-Scalar-Plain">service</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Symfony\Component\Ldap\Ldap</span>
                <span class="l l-Scalar l-Scalar-Plain">dn_string</span><span class="p p-Indicator">:</span> <span class="s">&#39;uid={username},dc=example,dc=com&#39;</span>
</pre></div>
</td></tr></table></div>
</p></li>
<li><p><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="nt">&lt;firewall</span> <span class="na">name=</span><span class="s">&quot;main&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;form-login-ldap</span> <span class="na">service=</span><span class="s">&quot;Symfony\Component\Ldap\Ldap&quot;</span>
                <span class="na">dn-string=</span><span class="s">&quot;uid={username},dc=example,dc=com&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/firewall&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div>
</p></li>
<li><p><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Ldap\Ldap</span><span class="p">;</span>

<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;firewalls&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;main&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;form_login_ldap&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;service&#39;</span> <span class="o">=&gt;</span> <span class="nx">Ldap</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
                <span class="s1">&#39;dn_string&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;uid={username},dc=example,dc=com&#39;</span><span class="p">,</span>
                <span class="c1">// ...</span>
            <span class="p">],</span>
        <span class="p">],</span>
    <span class="p">]</span>
<span class="p">];</span>
</pre></div>
</td></tr></table></div>
</p></li>
</ul>
</div>
</div>
<div class="section" id="configuration-example-for-http-basic">
<h3>Configuration example for HTTP Basic</h3>
<div class="configuration-block">
<ul class="simple">
<li><p><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">firewalls</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">main</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">stateless</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
            <span class="l l-Scalar l-Scalar-Plain">http_basic_ldap</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">service</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Symfony\Component\Ldap\Ldap</span>
                <span class="l l-Scalar l-Scalar-Plain">dn_string</span><span class="p p-Indicator">:</span> <span class="s">&#39;uid={username},dc=example,dc=com&#39;</span>
</pre></div>
</td></tr></table></div>
</p></li>
<li><p><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>

        <span class="nt">&lt;firewall</span> <span class="na">name=</span><span class="s">&quot;main&quot;</span> <span class="na">stateless=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;http-basic-ldap</span> <span class="na">service=</span><span class="s">&quot;Symfony\Component\Ldap\Ldap&quot;</span>
                <span class="na">dn-string=</span><span class="s">&quot;uid={username},dc=example,dc=com&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/firewall&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div>
</p></li>
<li><p><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Ldap\Ldap</span><span class="p">;</span>

<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="c1">// ...</span>

    <span class="s1">&#39;firewalls&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;main&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;http_basic_ldap&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;service&#39;</span> <span class="o">=&gt;</span> <span class="nx">Ldap</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
                <span class="s1">&#39;dn_string&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;uid={username},dc=example,dc=com&#39;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="s1">&#39;stateless&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">];</span>
</pre></div>
</td></tr></table></div>
</p></li>
</ul>
</div>
</div>
<div class="section" id="configuration-example-for-form-login-and-query-string">
<h3>Configuration example for form login and query_string</h3>
<div class="configuration-block">
<ul class="simple">
<li><p><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">firewalls</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">main</span><span class="p p-Indicator">:</span>
            <span class="c1"># ...</span>
            <span class="l l-Scalar l-Scalar-Plain">form_login_ldap</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">service</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Symfony\Component\Ldap\Ldap</span>
                <span class="l l-Scalar l-Scalar-Plain">dn_string</span><span class="p p-Indicator">:</span> <span class="s">&#39;dc=example,dc=com&#39;</span>
                <span class="l l-Scalar l-Scalar-Plain">query_string</span><span class="p p-Indicator">:</span> <span class="s">&#39;(&amp;(uid={username})(memberOf=cn=users,ou=Services,dc=example,dc=com))&#39;</span>
                <span class="l l-Scalar l-Scalar-Plain">search_dn</span><span class="p p-Indicator">:</span> <span class="s">&#39;...&#39;</span>
                <span class="l l-Scalar l-Scalar-Plain">search_password</span><span class="p p-Indicator">:</span> <span class="s">&#39;the-raw-password&#39;</span>
</pre></div>
</td></tr></table></div>
</p></li>
<li><p><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="nt">&lt;firewall</span> <span class="na">name=</span><span class="s">&quot;main&quot;</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- ... --&gt;</span>
            <span class="nt">&lt;form-login-ldap</span> <span class="na">service=</span><span class="s">&quot;Symfony\Component\Ldap\Ldap&quot;</span>
                <span class="na">dn-string=</span><span class="s">&quot;dc=example,dc=com&quot;</span>
                <span class="na">query-string=</span><span class="s">&quot;(&amp;amp;(uid={username})(memberOf=cn=users,ou=Services,dc=example,dc=com))&quot;</span>
                <span class="na">search-dn=</span><span class="s">&quot;...&quot;</span>
                <span class="na">search-password=</span><span class="s">&quot;the-raw-password&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/firewall&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div>
</p></li>
<li><p><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Ldap\Ldap</span><span class="p">;</span>

<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;firewalls&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;main&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="c1">// ...</span>
            <span class="s1">&#39;form_login_ldap&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;service&#39;</span> <span class="o">=&gt;</span> <span class="nx">Ldap</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
                <span class="s1">&#39;dn_string&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;dc=example,dc=com&#39;</span><span class="p">,</span>
                <span class="s1">&#39;query_string&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;(&amp;(uid={username})(memberOf=cn=users,ou=Services,dc=example,dc=com))&#39;</span><span class="p">,</span>
                <span class="s1">&#39;search_dn&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;...&#39;</span><span class="p">,</span>
                <span class="s1">&#39;search_password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;the-raw-password&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">],</span>
    <span class="p">]</span>
<span class="p">]);</span>
</pre></div>
</td></tr></table></div>
</p></li>
</ul>
</div>
<div class="deprecated">
<p><span class="versionmodified">Deprecated since version 4.4: </span>Using the <code class="docutils literal notranslate"><span class="pre">query_string</span></code> config option without defining <code class="docutils literal notranslate"><span class="pre">search_dn</span></code> and
<code class="docutils literal notranslate"><span class="pre">search_password</span></code> is deprecated since Symfony 4.4.</p>
</div>
</div>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>