<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <title>How Does the Security access_control Work?</title>
    <link rel="stylesheet" href="../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/rtd_custom.css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <div class="section" id="how-does-the-security-access-control-work">
<span id="security-access-control-explanation"></span><h1>How Does the Security access_control Work?</h1>
<p>For each incoming request, Symfony checks each <code class="docutils literal notranslate"><span class="pre">access_control</span></code> entry
to find <em>one</em> that matches the current request. As soon as it finds a matching
<code class="docutils literal notranslate"><span class="pre">access_control</span></code> entry, it stops - only the <strong>first</strong> matching <code class="docutils literal notranslate"><span class="pre">access_control</span></code>
is used to enforce access.</p>
<p>Each <code class="docutils literal notranslate"><span class="pre">access_control</span></code> has several options that configure two different
things:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#security-access-control-matching-options"><span class="std std-ref">should the incoming request match this access control entry</span></a></p></li>
<li><p><a class="reference internal" href="#security-access-control-enforcement-options"><span class="std std-ref">once it matches, should some sort of access restriction be enforced</span></a>:</p></li>
</ol>
<div class="section" id="matching-options">
<span id="security-access-control-matching-options"></span><h2>1. Matching Options</h2>
<p>Symfony creates an instance of <code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/HttpFoundation/RequestMatcher.php" title="Symfony\Component\HttpFoundation\RequestMatcher"><span class="pre">RequestMatcher</span></a><span class="link-target"> <span class="pre">[https://github.com/symfony/symfony/blob/master/src/Symfony/Component/HttpFoundation/RequestMatcher.php]</span></span></code>
for each <code class="docutils literal notranslate"><span class="pre">access_control</span></code> entry, which determines whether or not a given
access control should be used on this request. The following <code class="docutils literal notranslate"><span class="pre">access_control</span></code>
options are used for matching:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">path</span></code>: a regular expression (without delimiters)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ip</span></code> or <code class="docutils literal notranslate"><span class="pre">ips</span></code>: netmasks are also supported</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">port</span></code>: an integer</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">host</span></code>: a regular expression</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">methods</span></code>: one or many methods</p></li>
</ul>
<p>Take the following <code class="docutils literal notranslate"><span class="pre">access_control</span></code> entries as an example:</p>
<div class="configuration-block">
<ul class="simple">
<li><p><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l l-Scalar l-Scalar-Plain">access_control</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="s">&#39;^/admin&#39;</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">ROLE_USER_IP</span><span class="p p-Indicator">,</span> <span class="nv">ip</span><span class="p p-Indicator">:</span> <span class="nv">127.0.0.1</span> <span class="p p-Indicator">}</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="s">&#39;^/admin&#39;</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">ROLE_USER_PORT</span><span class="p p-Indicator">,</span> <span class="nv">ip</span><span class="p p-Indicator">:</span> <span class="nv">127.0.0.1</span><span class="p p-Indicator">,</span> <span class="nv">port</span><span class="p p-Indicator">:</span> <span class="nv">8080</span> <span class="p p-Indicator">}</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="s">&#39;^/admin&#39;</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">ROLE_USER_HOST</span><span class="p p-Indicator">,</span> <span class="nv">host</span><span class="p p-Indicator">:</span> <span class="nv">symfony\.com$</span> <span class="p p-Indicator">}</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="s">&#39;^/admin&#39;</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">ROLE_USER_METHOD</span><span class="p p-Indicator">,</span> <span class="nv">methods</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">POST</span><span class="p p-Indicator">,</span> <span class="nv">PUT</span><span class="p p-Indicator">]</span> <span class="p p-Indicator">}</span>
        <span class="c1"># when defining multiple roles, users must have at least one of them (it&#39;s like an OR condition)</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="s">&#39;^/admin&#39;</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">ROLE_MANAGER</span><span class="p p-Indicator">,</span> <span class="nv">ROLE_ADMIN</span><span class="p p-Indicator">]</span> <span class="p p-Indicator">}</span>
</pre></div>
</td></tr></table></div>
</p></li>
<li><p><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/admin&quot;</span> <span class="na">role=</span><span class="s">&quot;ROLE_USER_IP&quot;</span> <span class="na">ip=</span><span class="s">&quot;127.0.0.1&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/admin&quot;</span> <span class="na">role=</span><span class="s">&quot;ROLE_USER_PORT&quot;</span> <span class="na">ip=</span><span class="s">&quot;127.0.0.1&quot;</span> <span class="na">port=</span><span class="s">&quot;8080&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/admin&quot;</span> <span class="na">role=</span><span class="s">&quot;ROLE_USER_HOST&quot;</span> <span class="na">host=</span><span class="s">&quot;symfony\.com$&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/admin&quot;</span> <span class="na">role=</span><span class="s">&quot;ROLE_USER_METHOD&quot;</span> <span class="na">methods=</span><span class="s">&quot;POST, PUT&quot;</span><span class="nt">/&gt;</span>
        <span class="c">&lt;!-- when defining multiple roles, users must have at least one of them (it&#39;s like an OR condition) --&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/admin&quot;</span> <span class="na">roles=</span><span class="s">&quot;ROLE_ADMIN, ROLE_MANAGER&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div>
</p></li>
<li><p><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="c1">// ...</span>
    <span class="s1">&#39;access_control&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="p">[</span>
            <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/admin&#39;</span><span class="p">,</span>
            <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_USER_IP&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ips&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/admin&#39;</span><span class="p">,</span>
            <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_USER_PORT&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ip&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
            <span class="s1">&#39;port&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;8080&#39;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/admin&#39;</span><span class="p">,</span>
            <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_USER_HOST&#39;</span><span class="p">,</span>
            <span class="s1">&#39;host&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;symfony\.com$&#39;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/admin&#39;</span><span class="p">,</span>
            <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_USER_METHOD&#39;</span><span class="p">,</span>
            <span class="s1">&#39;methods&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;POST, PUT&#39;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/admin&#39;</span><span class="p">,</span>
            <span class="c1">// when defining multiple roles, users must have at least one of them (it&#39;s like an OR condition)</span>
            <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;ROLE_MANAGER&#39;</span><span class="p">,</span> <span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">],</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>
</td></tr></table></div>
</p></li>
</ul>
</div>
<p>For each incoming request, Symfony will decide which <code class="docutils literal notranslate"><span class="pre">access_control</span></code>
to use based on the URI, the client’s IP address, the incoming host name,
and the request method. Remember, the first rule that matches is used, and
if <code class="docutils literal notranslate"><span class="pre">ip</span></code>, <code class="docutils literal notranslate"><span class="pre">port</span></code>, <code class="docutils literal notranslate"><span class="pre">host</span></code> or <code class="docutils literal notranslate"><span class="pre">method</span></code> are not specified for an entry, that
<code class="docutils literal notranslate"><span class="pre">access_control</span></code> will match any <code class="docutils literal notranslate"><span class="pre">ip</span></code>, <code class="docutils literal notranslate"><span class="pre">port</span></code>, <code class="docutils literal notranslate"><span class="pre">host</span></code> or <code class="docutils literal notranslate"><span class="pre">method</span></code>:</p>
<table class="docutils">
<colgroup>
<col style="width: 11%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 7%" />
<col style="width: 20%" />
<col style="width: 38%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>URI</p></th>
<th class="head"><p>IP</p></th>
<th class="head"><p>PORT</p></th>
<th class="head"><p>HOST</p></th>
<th class="head"><p>METHOD</p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">access_control</span></code></p></th>
<th class="head"><p>Why?</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">/admin/user</span></code></p></td>
<td><p>127.0.0.1</p></td>
<td><p>80</p></td>
<td><p>example.com</p></td>
<td><p>GET</p></td>
<td><p>rule #1 (<code class="docutils literal notranslate"><span class="pre">ROLE_USER_IP</span></code>)</p></td>
<td><p>The URI matches <code class="docutils literal notranslate"><span class="pre">path</span></code> and the IP matches <code class="docutils literal notranslate"><span class="pre">ip</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">/admin/user</span></code></p></td>
<td><p>127.0.0.1</p></td>
<td><p>80</p></td>
<td><p>symfony.com</p></td>
<td><p>GET</p></td>
<td><p>rule #1 (<code class="docutils literal notranslate"><span class="pre">ROLE_USER_IP</span></code>)</p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">path</span></code> and <code class="docutils literal notranslate"><span class="pre">ip</span></code> still match. This would also match
the <code class="docutils literal notranslate"><span class="pre">ROLE_USER_HOST</span></code> entry, but <em>only</em> the <strong>first</strong>
<code class="docutils literal notranslate"><span class="pre">access_control</span></code> match is used.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">/admin/user</span></code></p></td>
<td><p>127.0.0.1</p></td>
<td><p>8080</p></td>
<td><p>symfony.com</p></td>
<td><p>GET</p></td>
<td><p>rule #2 (<code class="docutils literal notranslate"><span class="pre">ROLE_USER_PORT</span></code>)</p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">path</span></code>, <code class="docutils literal notranslate"><span class="pre">ip</span></code> and <code class="docutils literal notranslate"><span class="pre">port</span></code> match.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">/admin/user</span></code></p></td>
<td><p>168.0.0.1</p></td>
<td><p>80</p></td>
<td><p>symfony.com</p></td>
<td><p>GET</p></td>
<td><p>rule #3 (<code class="docutils literal notranslate"><span class="pre">ROLE_USER_HOST</span></code>)</p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">ip</span></code> doesn’t match the first rule, so the second
rule (which matches) is used.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">/admin/user</span></code></p></td>
<td><p>168.0.0.1</p></td>
<td><p>80</p></td>
<td><p>symfony.com</p></td>
<td><p>POST</p></td>
<td><p>rule #3 (<code class="docutils literal notranslate"><span class="pre">ROLE_USER_HOST</span></code>)</p></td>
<td><p>The second rule still matches. This would also match the
third rule (<code class="docutils literal notranslate"><span class="pre">ROLE_USER_METHOD</span></code>), but only the <strong>first</strong>
matched <code class="docutils literal notranslate"><span class="pre">access_control</span></code> is used.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">/admin/user</span></code></p></td>
<td><p>168.0.0.1</p></td>
<td><p>80</p></td>
<td><p>example.com</p></td>
<td><p>POST</p></td>
<td><p>rule #4 (<code class="docutils literal notranslate"><span class="pre">ROLE_USER_METHOD</span></code>)</p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">ip</span></code> and <code class="docutils literal notranslate"><span class="pre">host</span></code> don’t match the first two entries,
but the third - <code class="docutils literal notranslate"><span class="pre">ROLE_USER_METHOD</span></code> - matches and is used.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">/admin/user</span></code></p></td>
<td><p>168.0.0.1</p></td>
<td><p>80</p></td>
<td><p>example.com</p></td>
<td><p>GET</p></td>
<td><p>rule #4 (<code class="docutils literal notranslate"><span class="pre">ROLE_MANAGER</span></code>)</p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">ip</span></code>, <code class="docutils literal notranslate"><span class="pre">host</span></code> and <code class="docutils literal notranslate"><span class="pre">method</span></code> prevent the first
three entries from matching. But since the URI matches the
<code class="docutils literal notranslate"><span class="pre">path</span></code> pattern, then the <code class="docutils literal notranslate"><span class="pre">ROLE_MANAGER</span></code> (or the
<code class="docutils literal notranslate"><span class="pre">ROLE_ADMIN</span></code>) is used.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">/foo</span></code></p></td>
<td><p>127.0.0.1</p></td>
<td><p>80</p></td>
<td><p>symfony.com</p></td>
<td><p>POST</p></td>
<td><p>matches no entries</p></td>
<td><p>This doesn’t match any <code class="docutils literal notranslate"><span class="pre">access_control</span></code> rules, since its
URI doesn’t match any of the <code class="docutils literal notranslate"><span class="pre">path</span></code> values.</p></td>
</tr>
</tbody>
</table>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Matching the URI is done without <code class="docutils literal notranslate"><span class="pre">$_GET</span></code> parameters.
<a class="reference internal" href="../security.xhtml#security-securing-controller"><span class="std std-ref">Deny access in PHP code</span></a> if you want
to disallow access based on <code class="docutils literal notranslate"><span class="pre">$_GET</span></code> parameter values.</p>
</div>
</div>
<div class="section" id="access-enforcement">
<span id="security-access-control-enforcement-options"></span><h2>2. Access Enforcement</h2>
<p>Once Symfony has decided which <code class="docutils literal notranslate"><span class="pre">access_control</span></code> entry matches (if any),
it then <em>enforces</em> access restrictions based on the <code class="docutils literal notranslate"><span class="pre">roles</span></code>, <code class="docutils literal notranslate"><span class="pre">allow_if</span></code> and <code class="docutils literal notranslate"><span class="pre">requires_channel</span></code>
options:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">roles</span></code> If the user does not have the given role, then access is denied
(internally, an <code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Security/Core/Exception/AccessDeniedException.php" title="Symfony\Component\Security\Core\Exception\AccessDeniedException"><span class="pre">AccessDeniedException</span></a><span class="link-target"> <span class="pre">[https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Security/Core/Exception/AccessDeniedException.php]</span></span></code>
is thrown). If this value is an array of multiple roles, the user must have
at least one of them.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">allow_if</span></code> If the expression returns false, then access is denied;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">requires_channel</span></code> If the incoming request’s channel (e.g. <code class="docutils literal notranslate"><span class="pre">http</span></code>)
does not match this value (e.g. <code class="docutils literal notranslate"><span class="pre">https</span></code>), the user will be redirected
(e.g. redirected from <code class="docutils literal notranslate"><span class="pre">http</span></code> to <code class="docutils literal notranslate"><span class="pre">https</span></code>, or vice versa).</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Behind the scenes, the array value of <code class="docutils literal notranslate"><span class="pre">roles</span></code> is passed as the
<code class="docutils literal notranslate"><span class="pre">$attributes</span></code> argument to each voter in the application with the
<code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/HttpFoundation/Request.php" title="Symfony\Component\HttpFoundation\Request"><span class="pre">Request</span></a><span class="link-target"> <span class="pre">[https://github.com/symfony/symfony/blob/master/src/Symfony/Component/HttpFoundation/Request.php]</span></span></code> as <code class="docutils literal notranslate"><span class="pre">$subject</span></code>. You
can learn how to use your custom attributes by reading
<a class="reference internal" href="voters.xhtml#security-custom-voter"><span class="std std-ref">How to Use Voters to Check User Permissions</span></a>.</p>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>If you define both <code class="docutils literal notranslate"><span class="pre">roles</span></code> and <code class="docutils literal notranslate"><span class="pre">allow_if</span></code>, and your Access Decision
Strategy is the default one (<code class="docutils literal notranslate"><span class="pre">affirmative</span></code>), then the user will be granted
access if there’s at least one valid condition. If this behavior doesn’t fit
your needs, <a class="reference internal" href="voters.xhtml#security-voters-change-strategy"><span class="std std-ref">change the Access Decision Strategy</span></a>.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If access is denied, the system will try to authenticate the user if not
already (e.g. redirect the user to the login page). If the user is already
logged in, the 403 “access denied” error page will be shown. See
<a class="reference internal" href="../controller/error_pages.xhtml"><span class="doc">How to Customize Error Pages</span></a> for more information.</p>
</div>
</div>
<div class="section" id="matching-access-control-by-ip">
<h2>Matching access_control By IP</h2>
<p>Certain situations may arise when you need to have an <code class="docutils literal notranslate"><span class="pre">access_control</span></code>
entry that <em>only</em> matches requests coming from some IP address or range.
For example, this <em>could</em> be used to deny access to a URL pattern to all
requests <em>except</em> those from a trusted, internal server.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>As you’ll read in the explanation below the example, the <code class="docutils literal notranslate"><span class="pre">ips</span></code> option
does not restrict to a specific IP address. Instead, using the <code class="docutils literal notranslate"><span class="pre">ips</span></code>
key means that the <code class="docutils literal notranslate"><span class="pre">access_control</span></code> entry will only match this IP address,
and users accessing it from a different IP address will continue down
the <code class="docutils literal notranslate"><span class="pre">access_control</span></code> list.</p>
</div>
<p>Here is an example of how you configure some example <code class="docutils literal notranslate"><span class="pre">/internal*</span></code> URL
pattern so that it is only accessible by requests from the local server itself:</p>
<div class="configuration-block">
<ul class="simple">
<li><p><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l l-Scalar l-Scalar-Plain">access_control</span><span class="p p-Indicator">:</span>
        <span class="c1">#</span>
        <span class="c1"># the &#39;ips&#39; option supports IP addresses and subnet masks</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="s">&#39;^/internal&#39;</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">IS_AUTHENTICATED_ANONYMOUSLY</span><span class="p p-Indicator">,</span> <span class="nv">ips</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">127.0.0.1</span><span class="p p-Indicator">,</span> <span class="p p-Indicator">::</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="nv">192.168.0.1/24</span><span class="p p-Indicator">]</span> <span class="p p-Indicator">}</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="s">&#39;^/internal&#39;</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">ROLE_NO_ACCESS</span> <span class="p p-Indicator">}</span>
</pre></div>
</td></tr></table></div>
</p></li>
<li><p><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>

        <span class="c">&lt;!-- the &#39;ips&#39; option supports IP addresses and subnet masks --&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/internal&quot;</span> <span class="na">role=</span><span class="s">&quot;IS_AUTHENTICATED_ANONYMOUSLY&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;ip&gt;</span>127.0.0.1<span class="nt">&lt;/ip&gt;</span>
            <span class="nt">&lt;ip&gt;</span>::1<span class="nt">&lt;/ip&gt;</span>
        <span class="nt">&lt;/rule&gt;</span>

        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/internal&quot;</span> <span class="na">role=</span><span class="s">&quot;ROLE_NO_ACCESS&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div>
</p></li>
<li><p><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="c1">// ...</span>
    <span class="s1">&#39;access_control&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="p">[</span>
            <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/internal&#39;</span><span class="p">,</span>
            <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;IS_AUTHENTICATED_ANONYMOUSLY&#39;</span><span class="p">,</span>
            <span class="c1">// the &#39;ips&#39; option supports IP addresses and subnet masks</span>
            <span class="s1">&#39;ips&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="s1">&#39;::1&#39;</span><span class="p">],</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/internal&#39;</span><span class="p">,</span>
            <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_NO_ACCESS&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>
</td></tr></table></div>
</p></li>
</ul>
</div>
<p>Here is how it works when the path is <code class="docutils literal notranslate"><span class="pre">/internal/something</span></code> coming from
the external IP address <code class="docutils literal notranslate"><span class="pre">10.0.0.1</span></code>:</p>
<ul class="simple">
<li><p>The first access control rule is ignored as the <code class="docutils literal notranslate"><span class="pre">path</span></code> matches but the
IP address does not match either of the IPs listed;</p></li>
<li><p>The second access control rule is enabled (the only restriction being the
<code class="docutils literal notranslate"><span class="pre">path</span></code>) and so it matches. If you make sure that no users ever have
<code class="docutils literal notranslate"><span class="pre">ROLE_NO_ACCESS</span></code>, then access is denied (<code class="docutils literal notranslate"><span class="pre">ROLE_NO_ACCESS</span></code> can be anything
that does not match an existing role, it only serves as a trick to always
deny access).</p></li>
</ul>
<p>But if the same request comes from <code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code> or <code class="docutils literal notranslate"><span class="pre">::1</span></code> (the IPv6 loopback
address):</p>
<ul class="simple">
<li><p>Now, the first access control rule is enabled as both the <code class="docutils literal notranslate"><span class="pre">path</span></code> and the
<code class="docutils literal notranslate"><span class="pre">ip</span></code> match: access is allowed as the user always has the
<code class="docutils literal notranslate"><span class="pre">IS_AUTHENTICATED_ANONYMOUSLY</span></code> role.</p></li>
<li><p>The second access rule is not examined as the first rule matched.</p></li>
</ul>
<div class="section" id="securing-by-an-expression">
<span id="security-allow-if"></span><h3>Securing by an Expression</h3>
<p>Once an <code class="docutils literal notranslate"><span class="pre">access_control</span></code> entry is matched, you can deny access via the
<code class="docutils literal notranslate"><span class="pre">roles</span></code> key or use more complex logic with an expression in the <code class="docutils literal notranslate"><span class="pre">allow_if</span></code>
key:</p>
<div class="configuration-block">
<ul class="simple">
<li><p><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l l-Scalar l-Scalar-Plain">access_control</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span>
            <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">^/_internal/secure</span>
            <span class="c1"># the &#39;role&#39; and &#39;allow-if&#39; options work like an OR expression, so</span>
            <span class="c1"># access is granted if the expression is TRUE or the user has ROLE_ADMIN</span>
            <span class="l l-Scalar l-Scalar-Plain">roles</span><span class="p p-Indicator">:</span> <span class="s">&#39;ROLE_ADMIN&#39;</span>
            <span class="l l-Scalar l-Scalar-Plain">allow_if</span><span class="p p-Indicator">:</span> <span class="s">&quot;&#39;127.0.0.1&#39;</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">request.getClientIp()</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">request.headers.has(&#39;X-Secure-Access&#39;)&quot;</span>
</pre></div>
</td></tr></table></div>
</p></li>
<li><p><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>
        <span class="c">&lt;!-- the &#39;role&#39; and &#39;allow-if&#39; options work like an OR expression, so</span>
<span class="c">             access is granted if the expression is TRUE or the user has ROLE_ADMIN --&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/_internal/secure&quot;</span>
            <span class="na">role=</span><span class="s">&quot;ROLE_ADMIN&quot;</span>
            <span class="na">allow-if=</span><span class="s">&quot;&#39;127.0.0.1&#39; == request.getClientIp() or request.headers.has(&#39;X-Secure-Access&#39;)&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div>
</p></li>
<li><p><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="c1">// ...</span>
    <span class="s1">&#39;access_control&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="p">[</span>
            <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/_internal/secure&#39;</span><span class="p">,</span>
            <span class="c1">// the &#39;role&#39; and &#39;allow-if&#39; options work like an OR expression, so</span>
            <span class="c1">// access is granted if the expression is TRUE or the user has ROLE_ADMIN</span>
            <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">,</span>
            <span class="s1">&#39;allow_if&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&quot;127.0.0.1&quot; == request.getClientIp() or request.headers.has(&quot;X-Secure-Access&quot;)&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>
</td></tr></table></div>
</p></li>
</ul>
</div>
<p>In this case, when the user tries to access any URL starting with
<code class="docutils literal notranslate"><span class="pre">/_internal/secure</span></code>, they will only be granted access if the IP address is
<code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code> or a secure header, or if the user has the <code class="docutils literal notranslate"><span class="pre">ROLE_ADMIN</span></code> role.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Internally <code class="docutils literal notranslate"><span class="pre">allow_if</span></code> triggers the built-in
<code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Security/Core/Authorization/Voter/ExpressionVoter.php" title="Symfony\Component\Security\Core\Authorization\Voter\ExpressionVoter"><span class="pre">ExpressionVoter</span></a><span class="link-target"> <span class="pre">[https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Security/Core/Authorization/Voter/ExpressionVoter.php]</span></span></code>
as like it was part of the attributes defined in the <code class="docutils literal notranslate"><span class="pre">roles</span></code> option.</p>
</div>
<p>Inside the expression, you have access to a number of different variables
and functions including <code class="docutils literal notranslate"><span class="pre">request</span></code>, which is the Symfony
<code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/HttpFoundation/Request.php" title="Symfony\Component\HttpFoundation\Request"><span class="pre">Request</span></a><span class="link-target"> <span class="pre">[https://github.com/symfony/symfony/blob/master/src/Symfony/Component/HttpFoundation/Request.php]</span></span></code> object (see
<a class="reference internal" href="../components/http_foundation.xhtml#component-http-foundation-request"><span class="std std-ref">Request</span></a>).</p>
<p>For a list of the other functions and variables, see
<a class="reference internal" href="expressions.xhtml#security-expression-variables"><span class="std std-ref">functions and variables</span></a>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The <code class="docutils literal notranslate"><span class="pre">allow_if</span></code> expressions can also contain custom functions registered
with <a class="reference internal" href="../components/expression_language/extending.xhtml#components-expression-language-provider"><span class="std std-ref">expression providers</span></a>.</p>
</div>
</div>
</div>
<div class="section" id="restrict-to-a-port">
<h2>Restrict to a port</h2>
<p>Add the <code class="docutils literal notranslate"><span class="pre">port</span></code> option to any <code class="docutils literal notranslate"><span class="pre">access_control</span></code> entries to require users to
access those URLs via a specific port. This could be useful for example for
<code class="docutils literal notranslate"><span class="pre">localhost:8080</span></code>.</p>
<div class="configuration-block">
<ul class="simple">
<li><p><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l l-Scalar l-Scalar-Plain">access_control</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="nv">^/cart/checkout</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">IS_AUTHENTICATED_ANONYMOUSLY</span><span class="p p-Indicator">,</span> <span class="nv">port</span><span class="p p-Indicator">:</span> <span class="nv">8080</span> <span class="p p-Indicator">}</span>
</pre></div>
</td></tr></table></div>
</p></li>
<li><p><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/cart/checkout&quot;</span>
            <span class="na">role=</span><span class="s">&quot;IS_AUTHENTICATED_ANONYMOUSLY&quot;</span>
            <span class="na">port=</span><span class="s">&quot;8080&quot;</span>
        <span class="nt">/&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div>
</p></li>
<li><p><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="c1">// ...</span>
    <span class="s1">&#39;access_control&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="p">[</span>
            <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/cart/checkout&#39;</span><span class="p">,</span>
            <span class="s1">&#39;role&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;IS_AUTHENTICATED_ANONYMOUSLY&#39;</span><span class="p">,</span>
            <span class="s1">&#39;port&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;8080&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>
</td></tr></table></div>
</p></li>
</ul>
</div>
</div>
<div class="section" id="forcing-a-channel-http-https">
<h2>Forcing a Channel (http, https)</h2>
<p>You can also require a user to access a URL via SSL; use the
<code class="docutils literal notranslate"><span class="pre">requires_channel</span></code> argument in any <code class="docutils literal notranslate"><span class="pre">access_control</span></code> entries. If this
<code class="docutils literal notranslate"><span class="pre">access_control</span></code> is matched and the request is using the <code class="docutils literal notranslate"><span class="pre">http</span></code> channel,
the user will be redirected to <code class="docutils literal notranslate"><span class="pre">https</span></code>:</p>
<div class="configuration-block">
<ul class="simple">
<li><p><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l l-Scalar l-Scalar-Plain">access_control</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="nv">^/cart/checkout</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">IS_AUTHENTICATED_ANONYMOUSLY</span><span class="p p-Indicator">,</span> <span class="nv">requires_channel</span><span class="p p-Indicator">:</span> <span class="nv">https</span> <span class="p p-Indicator">}</span>
</pre></div>
</td></tr></table></div>
</p></li>
<li><p><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/cart/checkout&quot;</span>
            <span class="na">role=</span><span class="s">&quot;IS_AUTHENTICATED_ANONYMOUSLY&quot;</span>
            <span class="na">requires-channel=</span><span class="s">&quot;https&quot;</span>
        <span class="nt">/&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div>
</p></li>
<li><p><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="c1">// ...</span>
    <span class="s1">&#39;access_control&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="p">[</span>
            <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/cart/checkout&#39;</span><span class="p">,</span>
            <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;IS_AUTHENTICATED_ANONYMOUSLY&#39;</span><span class="p">,</span>
            <span class="s1">&#39;requires_channel&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;https&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>
</td></tr></table></div>
</p></li>
</ul>
</div>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>