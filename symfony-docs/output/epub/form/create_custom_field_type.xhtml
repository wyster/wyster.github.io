<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <title>How to Create a Custom Form Field Type</title>
    <link rel="stylesheet" href="../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/rtd_custom.css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <div class="section" id="how-to-create-a-custom-form-field-type">
<span id="index-0"></span><h1>How to Create a Custom Form Field Type</h1>
<p>Symfony comes with <a class="reference internal" href="../reference/forms/types.xhtml"><span class="doc">tens of form types</span></a> (called
“form fields” in other projects) ready to use in your applications. However,
it’s common to create custom form types to solve specific purposes in your
projects.</p>
<div class="section" id="creating-form-types-based-on-symfony-built-in-types">
<h2>Creating Form Types Based on Symfony Built-in Types</h2>
<p>The easiest way to create a form type is to base it on one of the
<a class="reference internal" href="../reference/forms/types.xhtml"><span class="doc">existing form types</span></a>. Imagine that your project
displays a list of “shipping options” as a <code class="docutils literal notranslate"><span class="pre">&lt;select&gt;</span></code> HTML element. This can
be implemented with a <a class="reference internal" href="../reference/forms/types/choice.xhtml"><span class="doc">ChoiceType</span></a> where the
<code class="docutils literal notranslate"><span class="pre">choices</span></code> option is set to the list of available shipping options.</p>
<p>However, if you use the same form type in several forms, repeating the list of
<code class="docutils literal notranslate"><span class="pre">choices</span></code> every time you use it quickly becomes boring. In this example, a
better solution is to create a custom form type based on <code class="docutils literal notranslate"><span class="pre">ChoiceType</span></code>. The
custom type looks and behaves like a <code class="docutils literal notranslate"><span class="pre">ChoiceType</span></code> but the list of choices is
already populated with the shipping options so you don’t need to define them.</p>
<p>Form types are PHP classes that implement <code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Form/FormTypeInterface.php" title="Symfony\Component\Form\FormTypeInterface"><span class="pre">FormTypeInterface</span></a><span class="link-target"> <span class="pre">[https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Form/FormTypeInterface.php]</span></span></code>,
but you should instead extend from <code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Form/AbstractType.php" title="Symfony\Component\Form\AbstractType"><span class="pre">AbstractType</span></a><span class="link-target"> <span class="pre">[https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Form/AbstractType.php]</span></span></code>,
which already implements that interface and provides some utilities.
By convention they are stored in the <code class="docutils literal notranslate"><span class="pre">src/Form/Type/</span></code> directory:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Form/Type/ShippingType.php</span>
<span class="k">namespace</span> <span class="nx">App\Form\Type</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Form\AbstractType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\ChoiceType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\OptionsResolver\OptionsResolver</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ShippingType</span> <span class="k">extends</span> <span class="nx">AbstractType</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">configureOptions</span><span class="p">(</span><span class="nx">OptionsResolver</span> <span class="nv">$resolver</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$resolver</span><span class="o">-&gt;</span><span class="na">setDefaults</span><span class="p">([</span>
            <span class="s1">&#39;choices&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;Standard Shipping&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;standard&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Expedited Shipping&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;expedited&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Priority Shipping&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;priority&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getParent</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">ChoiceType</span><span class="o">::</span><span class="na">class</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The methods of the <code class="docutils literal notranslate"><span class="pre">FormTypeInterface</span></code> are explained in detail later in
this article. Here, <code class="docutils literal notranslate"><span class="pre">getParent()</span></code> method defines the base type
(<code class="docutils literal notranslate"><span class="pre">ChoiceType</span></code>) and <code class="docutils literal notranslate"><span class="pre">configureOptions()</span></code> overrides some of its options.
The resulting form type is a choice field with predefined choices.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The PHP class extension mechanism and the Symfony form field extension
mechanism are not the same. The parent type returned in <code class="docutils literal notranslate"><span class="pre">getParent()</span></code> is
what Symfony uses to build and manage the field type. Making the PHP class
extend from <code class="docutils literal notranslate"><span class="pre">AbstractType</span></code> is only a convenient way of implementing the
required <code class="docutils literal notranslate"><span class="pre">FormTypeInterface</span></code>.</p>
</div>
<p>Now you can add this form type when <a class="reference internal" href="../forms.xhtml"><span class="doc">creating Symfony forms</span></a>:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Form/Type/OrderType.php</span>
<span class="k">namespace</span> <span class="nx">App\Form\Type</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Form\Type\ShippingType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\AbstractType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\FormBuilderInterface</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">OrderType</span> <span class="k">extends</span> <span class="nx">AbstractType</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">buildForm</span><span class="p">(</span><span class="nx">FormBuilderInterface</span> <span class="nv">$builder</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$builder</span>
            <span class="c1">// ...</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;shipping&#39;</span><span class="p">,</span> <span class="nx">ShippingType</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
        <span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>That’s all. The <code class="docutils literal notranslate"><span class="pre">shipping</span></code> form field will be rendered correctly in any
template because it reuses the templating logic defined by its parent type
<code class="docutils literal notranslate"><span class="pre">ChoiceType</span></code>. If you prefer, you can also define a template for your custom
types, as explained later in this article.</p>
</div>
<div class="section" id="creating-form-types-created-from-scratch">
<h2>Creating Form Types Created From Scratch</h2>
<p>Some form types are so specific to your projects that they cannot be based on
any <a class="reference internal" href="../reference/forms/types.xhtml"><span class="doc">existing form types</span></a> because they are too
different. Consider an application that wants to reuse in different forms the
following set of fields as the “postal address”:</p>
<object data="../_images/form/form-custom-type-postal-address.svg" type="image/svg+xml"></object><p>As explained above, form types are PHP classes that implement
<code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Form/FormTypeInterface.php" title="Symfony\Component\Form\FormTypeInterface"><span class="pre">FormTypeInterface</span></a><span class="link-target"> <span class="pre">[https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Form/FormTypeInterface.php]</span></span></code>, although it’s more
convenient to extend instead from <code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Form/AbstractType.php" title="Symfony\Component\Form\AbstractType"><span class="pre">AbstractType</span></a><span class="link-target"> <span class="pre">[https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Form/AbstractType.php]</span></span></code>:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Form/Type/PostalAddressType.php</span>
<span class="k">namespace</span> <span class="nx">App\Form\Type</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Form\AbstractType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\FormType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\OptionsResolver\OptionsResolver</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PostalAddressType</span> <span class="k">extends</span> <span class="nx">AbstractType</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When a form type doesn’t extend from another specific type, there’s no need to
implement the <code class="docutils literal notranslate"><span class="pre">getParent()</span></code> method (Symfony will make the type extend from the
generic <code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Form/Extension/Core/Type/FormType.php" title="Symfony\Component\Form\Extension\Core\Type\FormType"><span class="pre">FormType</span></a><span class="link-target"> <span class="pre">[https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Form/Extension/Core/Type/FormType.php]</span></span></code>,
which is the parent of all the other types).</p>
<p>These are the most important methods that a form type class can define:</p>
<dl id="form-type-methods-explanation">
<dt><code class="docutils literal notranslate"><span class="pre">buildForm()</span></code></dt>
<dd><p>It adds and configures other types into this type. It’s the same method used
when <a class="reference internal" href="../forms.xhtml#creating-forms-in-classes"><span class="std std-ref">creating Symfony form classes</span></a>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">buildView()</span></code></dt>
<dd><p>It sets any extra variables you’ll need when rendering the field in a template.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">configureOptions()</span></code></dt>
<dd><p>It defines the options configurable when using the form type, which are also
the options that can be used in <code class="docutils literal notranslate"><span class="pre">buildForm()</span></code> and <code class="docutils literal notranslate"><span class="pre">buildView()</span></code>
methods. Options are inherited from parent types and parent type
extensions, but you can create any custom option you need.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">finishView()</span></code></dt>
<dd><p>When creating a form type that consists of many fields, this method allows
to modify the “view” of any of those fields. For any other use case, it’s
recommended to use instead the <code class="docutils literal notranslate"><span class="pre">buildView()</span></code> method.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">getParent()</span></code></dt>
<dd><p>If your custom type is based on another type (i.e. they share some
functionality) add this method to return the fully-qualified class name
of that original type. Do not use PHP inheritance for this.
Symfony will call all the form type methods (<code class="docutils literal notranslate"><span class="pre">buildForm()</span></code>,
<code class="docutils literal notranslate"><span class="pre">buildView()</span></code>, etc.) of the parent type and it will call all its type
extensions before calling the ones defined in your custom type.</p>
<p>By default, the <code class="docutils literal notranslate"><span class="pre">AbstractType</span></code> class returns the generic
<code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Form/Extension/Core/Type/FormType.php" title="Symfony\Component\Form\Extension\Core\Type\FormType"><span class="pre">FormType</span></a><span class="link-target"> <span class="pre">[https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Form/Extension/Core/Type/FormType.php]</span></span></code>
type, which is the root parent for all form types in the Form component.</p>
</dd>
</dl>
<div class="section" id="defining-the-form-type">
<h3>Defining the Form Type</h3>
<p>Start by adding the <code class="docutils literal notranslate"><span class="pre">buildForm()</span></code> method to configure all the types included
in the postal address. For the moment, all fields are of type <code class="docutils literal notranslate"><span class="pre">TextType</span></code>:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Form/Type/PostalAddressType.php</span>
<span class="k">namespace</span> <span class="nx">App\Form\Type</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Form\AbstractType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\TextType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\FormBuilderInterface</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PostalAddressType</span> <span class="k">extends</span> <span class="nx">AbstractType</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">buildForm</span><span class="p">(</span><span class="nx">FormBuilderInterface</span> <span class="nv">$builder</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$builder</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;addressLine1&#39;</span><span class="p">,</span> <span class="nx">TextType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;help&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Street address, P.O. box, company name&#39;</span><span class="p">,</span>
            <span class="p">])</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;addressLine2&#39;</span><span class="p">,</span> <span class="nx">TextType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;help&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Apartment, suite, unit, building, floor&#39;</span><span class="p">,</span>
            <span class="p">])</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="nx">TextType</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="nx">TextType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;label&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;State&#39;</span><span class="p">,</span>
            <span class="p">])</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;zipCode&#39;</span><span class="p">,</span> <span class="nx">TextType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;label&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ZIP Code&#39;</span><span class="p">,</span>
            <span class="p">])</span>
        <span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Run the following command to verify that the form type was successfully
registered in the application:</p>
<div class="highlight-terminal notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> php bin/console debug:form
</pre></div>
</td></tr></table></div>
</div>
<p>This form type is ready to use it inside other forms and all its fields will be
correctly rendered in any template:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Form/Type/OrderType.php</span>
<span class="k">namespace</span> <span class="nx">App\Form\Type</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Form\Type\PostalAddressType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\AbstractType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\FormBuilderInterface</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">OrderType</span> <span class="k">extends</span> <span class="nx">AbstractType</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">buildForm</span><span class="p">(</span><span class="nx">FormBuilderInterface</span> <span class="nv">$builder</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$builder</span>
            <span class="c1">// ...</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;address&#39;</span><span class="p">,</span> <span class="nx">PostalAddressType</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
        <span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>However, the real power of custom form types is achieved with custom form
options (to make them flexible) and with custom templates (to make them look
better).</p>
</div>
<div class="section" id="adding-configuration-options-for-the-form-type">
<span id="form-type-config-options"></span><h3>Adding Configuration Options for the Form Type</h3>
<p>Imagine that your project requires to make the <code class="docutils literal notranslate"><span class="pre">PostalAddressType</span></code>
configurable in two ways:</p>
<ul class="simple">
<li><p>In addition to “address line 1” and “address line 2”, some addresses should be
allowed to display an “address line 3” to store extended address information;</p></li>
<li><p>Instead of displaying a free text input, some addresses should be able to
restrict the possible states to a given list.</p></li>
</ul>
<p>This is solved with “form type options”, which allow to configure the behavior
of the form types. The options are defined in the <code class="docutils literal notranslate"><span class="pre">configureOptions()</span></code> method
and you can use all the <a class="reference internal" href="../components/options_resolver.xhtml"><span class="doc">OptionsResolver component features</span></a>
to define, validate and process their values:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Form/Type/PostalAddressType.php</span>
<span class="k">namespace</span> <span class="nx">App\Form\Type</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Form\AbstractType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\TextType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\OptionsResolver\Options</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\OptionsResolver\OptionsResolver</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PostalAddressType</span> <span class="k">extends</span> <span class="nx">AbstractType</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">configureOptions</span><span class="p">(</span><span class="nx">OptionsResolver</span> <span class="nv">$resolver</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// this defines the available options and their default values when</span>
        <span class="c1">// they are not configured explicitly when using the form type</span>
        <span class="nv">$resolver</span><span class="o">-&gt;</span><span class="na">setDefaults</span><span class="p">([</span>
            <span class="s1">&#39;allowed_states&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
            <span class="s1">&#39;is_extended_address&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
        <span class="p">]);</span>

        <span class="c1">// optionally you can also restrict the options type or types (to get</span>
        <span class="c1">// automatic type validation and useful error messages for end users)</span>
        <span class="nv">$resolver</span><span class="o">-&gt;</span><span class="na">setAllowedTypes</span><span class="p">(</span><span class="s1">&#39;allowed_states&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;null&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;array&#39;</span><span class="p">]);</span>
        <span class="nv">$resolver</span><span class="o">-&gt;</span><span class="na">setAllowedTypes</span><span class="p">(</span><span class="s1">&#39;is_extended_address&#39;</span><span class="p">,</span> <span class="s1">&#39;bool&#39;</span><span class="p">);</span>

        <span class="c1">// optionally you can transform the given values for the options to</span>
        <span class="c1">// simplify the further processing of those options</span>
        <span class="nv">$resolver</span><span class="o">-&gt;</span><span class="na">setNormalizer</span><span class="p">(</span><span class="s1">&#39;allowed_states&#39;</span><span class="p">,</span> <span class="k">static</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Options</span> <span class="nv">$options</span><span class="p">,</span> <span class="nv">$states</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="o">===</span> <span class="nv">$states</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nv">$states</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$states</span><span class="p">))</span> <span class="p">{</span>
                <span class="nv">$states</span> <span class="o">=</span> <span class="p">(</span><span class="k">array</span><span class="p">)</span> <span class="nv">$states</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nb">array_combine</span><span class="p">(</span><span class="nb">array_values</span><span class="p">(</span><span class="nv">$states</span><span class="p">),</span> <span class="nb">array_values</span><span class="p">(</span><span class="nv">$states</span><span class="p">));</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now you can configure these options when using the form type:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Form/Type/OrderType.php</span>
<span class="k">namespace</span> <span class="nx">App\Form\Type</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="k">class</span> <span class="nc">OrderType</span> <span class="k">extends</span> <span class="nx">AbstractType</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">buildForm</span><span class="p">(</span><span class="nx">FormBuilderInterface</span> <span class="nv">$builder</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$builder</span>
            <span class="c1">// ...</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;address&#39;</span><span class="p">,</span> <span class="nx">PostalAddressType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;is_extended_address&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
                <span class="s1">&#39;allowed_states&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;CA&#39;</span><span class="p">,</span> <span class="s1">&#39;FL&#39;</span><span class="p">,</span> <span class="s1">&#39;TX&#39;</span><span class="p">],</span>
                <span class="c1">// in this example, this config would also be valid:</span>
                <span class="c1">// &#39;allowed_states&#39; =&gt; &#39;CA&#39;,</span>
            <span class="p">])</span>
        <span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The last step is to use these options when building the form:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Form/Type/PostalAddressType.php</span>
<span class="k">namespace</span> <span class="nx">App\Form\Type</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="k">class</span> <span class="nc">PostalAddressType</span> <span class="k">extends</span> <span class="nx">AbstractType</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">buildForm</span><span class="p">(</span><span class="nx">FormBuilderInterface</span> <span class="nv">$builder</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">true</span> <span class="o">===</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;is_extended_address&#39;</span><span class="p">])</span> <span class="p">{</span>
            <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;addressLine3&#39;</span><span class="p">,</span> <span class="nx">TextType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;help&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Extended address info&#39;</span><span class="p">,</span>
            <span class="p">]);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="o">!==</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;allowed_states&#39;</span><span class="p">])</span> <span class="p">{</span>
            <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="nx">ChoiceType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;choices&#39;</span> <span class="o">=&gt;</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;allowed_states&#39;</span><span class="p">],</span>
            <span class="p">]);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="nx">TextType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;label&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;State/Province/Region&#39;</span><span class="p">,</span>
            <span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-the-form-type-template">
<h3>Creating the Form Type Template</h3>
<p>By default, custom form types will be rendered using the
<a class="reference internal" href="form_themes.xhtml"><span class="doc">form themes</span></a> configured in the application. However,
for some types you may prefer to create a custom template in order to customize
how they look or their HTML structure.</p>
<p>First, create a new Twig template anywhere in the application to store the
fragments used to render the types:</p>
<div class="highlight-twig notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">{# templates/form/custom_types.html.twig #}</span><span class="x"></span>

<span class="c">{# ... here you will add the Twig code ... #}</span><span class="x"></span>
</pre></div>
</td></tr></table></div>
<p>Then, update the <a class="reference internal" href="../reference/twig_reference.xhtml#reference-twig-tag-form-theme"><span class="std std-ref">form_themes option</span></a> to
add this new template at the beginning of the list (the first one overrides the
rest of files):</p>
<div class="configuration-block">
<ul class="simple">
<li><p><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/twig.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">twig</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">form_themes</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&#39;form/custom_types.html.twig&#39;</span>
        <span class="p p-Indicator">-</span> <span class="s">&#39;...&#39;</span>
</pre></div>
</td></tr></table></div>
</p></li>
<li><p><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/twig.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:twig=</span><span class="s">&quot;http://symfony.com/schema/dic/twig&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd</span>
<span class="s">        http://symfony.com/schema/dic/twig</span>
<span class="s">        https://symfony.com/schema/dic/twig/twig-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;twig:config&gt;</span>
        <span class="nt">&lt;twig:form-theme&gt;</span>form/custom_types.html.twig<span class="nt">&lt;/twig:form-theme&gt;</span>
        <span class="nt">&lt;twig:form-theme&gt;</span>...<span class="nt">&lt;/twig:form-theme&gt;</span>
    <span class="nt">&lt;/twig:config&gt;</span>
<span class="nt">&lt;/container&gt;</span>
</pre></div>
</td></tr></table></div>
</p></li>
<li><p><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/twig.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;twig&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;form_themes&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;form/custom_types.html.twig&#39;</span><span class="p">,</span>
        <span class="s1">&#39;...&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>
</td></tr></table></div>
</p></li>
</ul>
</div>
<p>The last step is to create the actual Twig template that will render the type.
The template contents depend on which HTML, CSS and JavaScript frameworks and
libraries are used in your application:</p>
<div class="highlight-html+twig notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">{# templates/form/custom_types.html.twig #}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">postal_address_row</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">child</span> <span class="k">in</span> <span class="nv">form.children</span><span class="o">|</span><span class="nf">filter</span><span class="o">(</span><span class="nv">child</span> <span class="o">=&gt;</span> <span class="k">not</span> <span class="nv">child.rendered</span><span class="o">)</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
            <span class="cp">{{</span> <span class="nv">form_label</span><span class="o">(</span><span class="nv">child</span><span class="o">)</span> <span class="cp">}}</span>
            <span class="cp">{{</span> <span class="nv">form_widget</span><span class="o">(</span><span class="nv">child</span><span class="o">)</span> <span class="cp">}}</span>
            <span class="cp">{{</span> <span class="nv">form_help</span><span class="o">(</span><span class="nv">child</span><span class="o">)</span> <span class="cp">}}</span>
            <span class="cp">{{</span> <span class="nv">form_errors</span><span class="o">(</span><span class="nv">child</span><span class="o">)</span> <span class="cp">}}</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Symfony 4.2 deprecated calling <code class="docutils literal notranslate"><span class="pre">FormRenderer::searchAndRenderBlock</span></code> for
fields that have already been rendered. That’s why the previous example
includes the <code class="docutils literal notranslate"><span class="pre">...</span> <span class="pre">if</span> <span class="pre">not</span> <span class="pre">child.rendered</span></code> statement.</p>
</div>
<p>The first part of the Twig block name (e.g. <code class="docutils literal notranslate"><span class="pre">postal_address</span></code>) comes from the
class name (<code class="docutils literal notranslate"><span class="pre">PostalAddressType</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">postal_address</span></code>). This can be controlled
by overriding the <code class="docutils literal notranslate"><span class="pre">getBlockPrefix()</span></code> method in <code class="docutils literal notranslate"><span class="pre">PostalAddressType</span></code>. The
second part of the Twig block name (e.g. <code class="docutils literal notranslate"><span class="pre">_row</span></code>) defines which form type part
is being rendered (row, widget, help, errors, etc.)</p>
<p>The article about form themes explains the
<a class="reference internal" href="form_themes.xhtml#form-fragment-naming"><span class="std std-ref">form fragment naming rules</span></a> in detail. The
following diagram shows some of the Twig block names defined in this example:</p>
<object data="../_images/form/form-custom-type-postal-address-fragment-names.svg" type="image/svg+xml"></object><div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>When the name of your form class matches any of the built-in field types,
your form might not be rendered correctly. A form type named
<code class="docutils literal notranslate"><span class="pre">App\Form\PasswordType</span></code> will have the same block name as the built-in
<code class="docutils literal notranslate"><span class="pre">PasswordType</span></code> and won’t be rendered correctly. Override the
<code class="docutils literal notranslate"><span class="pre">getBlockPrefix()</span></code> method to return a unique block prefix (e.g.
<code class="docutils literal notranslate"><span class="pre">app_password</span></code>) to avoid collisions.</p>
</div>
</div>
<div class="section" id="passing-variables-to-the-form-type-template">
<h3>Passing Variables to the Form Type Template</h3>
<p>Symfony passes a series of variables to the template used to render the form
type. You can also pass your own variables, which can be based on the options
defined by the form or be completely independent:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Form/Type/PostalAddressType.php</span>
<span class="k">namespace</span> <span class="nx">App\Form\Type</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Doctrine\ORM\EntityManagerInterface</span><span class="p">;</span>
<span class="c1">// ...</span>

<span class="k">class</span> <span class="nc">PostalAddressType</span> <span class="k">extends</span> <span class="nx">AbstractType</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$entityManager</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">EntityManagerInterface</span> <span class="nv">$entityManager</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">entityManager</span> <span class="o">=</span> <span class="nv">$entityManager</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">buildView</span><span class="p">(</span><span class="nx">FormView</span> <span class="nv">$view</span><span class="p">,</span> <span class="nx">FormInterface</span> <span class="nv">$form</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// pass the form type option directly to the template</span>
        <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">vars</span><span class="p">[</span><span class="s1">&#39;isExtendedAddress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;is_extended_address&#39;</span><span class="p">];</span>

        <span class="c1">// make a database query to find possible notifications related to postal addresses (e.g. to</span>
        <span class="c1">// display dynamic messages such as &#39;Delivery to XX and YY states will be added next week!&#39;)</span>
        <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">vars</span><span class="p">[</span><span class="s1">&#39;notification&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">entityManager</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you’re using the <a class="reference internal" href="../service_container.xhtml#service-container-services-load-example"><span class="std std-ref">default services.yaml configuration</span></a>,
this example will already work! Otherwise, <a class="reference internal" href="../service_container.xhtml#service-container-creating-service"><span class="std std-ref">create a service</span></a>
for this form class and <a class="reference internal" href="../service_container/tags.xhtml"><span class="doc">tag it</span></a> with <code class="docutils literal notranslate"><span class="pre">form.type</span></code>.</p>
<p>The variables added in <code class="docutils literal notranslate"><span class="pre">buildView()</span></code> are available in the form type template
as any other regular Twig variable:</p>
<div class="highlight-html+twig notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">{# templates/form/custom_types.html.twig #}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">postal_address_row</span> <span class="cp">%}</span>
    <span class="c">{# ... #}</span>

    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">isExtendedAddress</span> <span class="cp">%}</span>
        <span class="c">{# ... #}</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">notification</span> <span class="k">is</span> <span class="k">not</span> <span class="nf">empty</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-primary&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;alert&quot;</span><span class="p">&gt;</span>
            <span class="cp">{{</span> <span class="nv">notification</span> <span class="cp">}}</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>