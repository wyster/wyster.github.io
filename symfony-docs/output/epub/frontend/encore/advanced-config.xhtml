<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <title>Advanced Webpack Config</title>
    <link rel="stylesheet" href="../../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/rtd_custom.css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <div class="section" id="advanced-webpack-config">
<h1>Advanced Webpack Config</h1>
<p>Summarized, Encore generates the Webpack configuration that’s used in your
<code class="docutils literal notranslate"><span class="pre">webpack.config.js</span></code> file. Encore doesn’t support adding all of Webpack’s
<a class="reference external" href="https://webpack.js.org/configuration/">configuration options</a><span class="link-target"> [https://webpack.js.org/configuration/]</span>, because many can be added on your own.</p>
<p>For example, suppose you need to resolve automatically a new extension.
To do that, modify the config after fetching it from Encore:</p>
<div class="highlight-javascript notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// webpack.config.js</span>

<span class="kd">var</span> <span class="nx">Encore</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@symfony/webpack-encore&#39;</span><span class="p">);</span>

<span class="c1">// ... all Encore config here</span>

<span class="c1">// fetch the config, then modify it!</span>
<span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">Encore</span><span class="p">.</span><span class="nx">getWebpackConfig</span><span class="p">();</span>

<span class="c1">// add an extension</span>
<span class="nx">config</span><span class="p">.</span><span class="nx">resolve</span><span class="p">.</span><span class="nx">extensions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">);</span>

<span class="c1">// export the final config</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">config</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>But be careful not to accidentally override any config from Encore:</p>
<div class="highlight-javascript notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// webpack.config.js</span>
<span class="c1">// ...</span>

<span class="c1">// GOOD - this modifies the config.resolve.extensions array</span>
<span class="nx">config</span><span class="p">.</span><span class="nx">resolve</span><span class="p">.</span><span class="nx">extensions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">);</span>

<span class="c1">// BAD - this replaces any extensions added by Encore</span>
<span class="c1">// config.resolve.extensions = [&#39;json&#39;];</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="configuring-watching-options-and-polling">
<h2>Configuring Watching Options and Polling</h2>
<p>Encore provides the method <code class="docutils literal notranslate"><span class="pre">configureWatchOptions()</span></code> to configure
<a class="reference external" href="https://webpack.js.org/configuration/watch/#watchoptions">Watching Options</a><span class="link-target"> [https://webpack.js.org/configuration/watch/#watchoptions]</span> when running <code class="docutils literal notranslate"><span class="pre">encore</span> <span class="pre">dev</span> <span class="pre">--watch</span></code> or <code class="docutils literal notranslate"><span class="pre">encore</span> <span class="pre">dev-server</span></code>:</p>
<div class="highlight-javascript notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nx">Encore</span><span class="p">.</span><span class="nx">configureWatchOptions</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">watchOptions</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// enable polling and check for changes every 250ms</span>
    <span class="c1">// polling is useful when running Encore inside a Virtual Machine</span>
    <span class="nx">watchOptions</span><span class="p">.</span><span class="nx">poll</span> <span class="o">=</span> <span class="mi">250</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="defining-multiple-webpack-configurations">
<h2>Defining Multiple Webpack Configurations</h2>
<p>Webpack supports passing an <a class="reference external" href="https://webpack.js.org/configuration/configuration-types/#exporting-multiple-configurations">array of configurations</a><span class="link-target"> [https://webpack.js.org/configuration/configuration-types/#exporting-multiple-configurations]</span>, which are processed in
parallel. Webpack Encore includes a <code class="docutils literal notranslate"><span class="pre">reset()</span></code> object allowing to reset the
state of the current configuration to build a new one:</p>
<div class="highlight-javascript notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// define the first configuration</span>
<span class="nx">Encore</span>
    <span class="p">.</span><span class="nx">setOutputPath</span><span class="p">(</span><span class="s1">&#39;public/build/first_build/&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">setPublicPath</span><span class="p">(</span><span class="s1">&#39;/build/first_build&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">addEntry</span><span class="p">(</span><span class="s1">&#39;app&#39;</span><span class="p">,</span> <span class="s1">&#39;./assets/app.js&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">addStyleEntry</span><span class="p">(</span><span class="s1">&#39;global&#39;</span><span class="p">,</span> <span class="s1">&#39;./assets/styles/global.scss&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">enableSassLoader</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">autoProvidejQuery</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">enableSourceMaps</span><span class="p">(</span><span class="o">!</span><span class="nx">Encore</span><span class="p">.</span><span class="nx">isProduction</span><span class="p">())</span>
<span class="p">;</span>

<span class="c1">// build the first configuration</span>
<span class="kr">const</span> <span class="nx">firstConfig</span> <span class="o">=</span> <span class="nx">Encore</span><span class="p">.</span><span class="nx">getWebpackConfig</span><span class="p">();</span>

<span class="c1">// Set a unique name for the config (needed later!)</span>
<span class="nx">firstConfig</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;firstConfig&#39;</span><span class="p">;</span>

<span class="c1">// reset Encore to build the second config</span>
<span class="nx">Encore</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span>

<span class="c1">// define the second configuration</span>
<span class="nx">Encore</span>
    <span class="p">.</span><span class="nx">setOutputPath</span><span class="p">(</span><span class="s1">&#39;public/build/second_build/&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">setPublicPath</span><span class="p">(</span><span class="s1">&#39;/build/second_build&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">addEntry</span><span class="p">(</span><span class="s1">&#39;mobile&#39;</span><span class="p">,</span> <span class="s1">&#39;./assets/mobile.js&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">addStyleEntry</span><span class="p">(</span><span class="s1">&#39;mobile&#39;</span><span class="p">,</span> <span class="s1">&#39;./assets/styles/mobile.less&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">enableLessLoader</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">enableSourceMaps</span><span class="p">(</span><span class="o">!</span><span class="nx">Encore</span><span class="p">.</span><span class="nx">isProduction</span><span class="p">())</span>
<span class="p">;</span>

<span class="c1">// build the second configuration</span>
<span class="kr">const</span> <span class="nx">secondConfig</span> <span class="o">=</span> <span class="nx">Encore</span><span class="p">.</span><span class="nx">getWebpackConfig</span><span class="p">();</span>

<span class="c1">// Set a unique name for the config (needed later!)</span>
<span class="nx">secondConfig</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;secondConfig&#39;</span><span class="p">;</span>

<span class="c1">// export the final configuration as an array of multiple configurations</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">[</span><span class="nx">firstConfig</span><span class="p">,</span> <span class="nx">secondConfig</span><span class="p">];</span>
</pre></div>
</td></tr></table></div>
<p>When running Encore, both configurations will be built in parallel. If you
prefer to build configs separately, pass the <code class="docutils literal notranslate"><span class="pre">--config-name</span></code> option:</p>
<div class="highlight-terminal notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> yarn encore dev --config-name firstConfig
</pre></div>
</td></tr></table></div>
<p>Next, define the output directories of each build:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/webpack_encore.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">webpack_encore</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">output_path</span><span class="p p-Indicator">:</span> <span class="s">&#39;%kernel.project_dir%/public/default_build&#39;</span>
    <span class="l l-Scalar l-Scalar-Plain">builds</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">firstConfig</span><span class="p p-Indicator">:</span> <span class="s">&#39;%kernel.project_dir%/public/first_build&#39;</span>
        <span class="l l-Scalar l-Scalar-Plain">secondConfig</span><span class="p p-Indicator">:</span> <span class="s">&#39;%kernel.project_dir%/public/second_build&#39;</span>
</pre></div>
</td></tr></table></div>
<p>Finally, use the third optional parameter of the <code class="docutils literal notranslate"><span class="pre">encore_entry_*_tags()</span></code>
functions to specify which build to use:</p>
<div class="highlight-twig notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">{# Using the entrypoints.json file located in ./public/first_build #}</span><span class="x"></span>
<span class="cp">{{</span> <span class="nv">encore_entry_script_tags</span><span class="o">(</span><span class="s1">&#39;app&#39;</span><span class="o">,</span> <span class="kp">null</span><span class="o">,</span> <span class="s1">&#39;firstConfig&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{{</span> <span class="nv">encore_entry_link_tags</span><span class="o">(</span><span class="s1">&#39;global&#39;</span><span class="o">,</span> <span class="kp">null</span><span class="o">,</span> <span class="s1">&#39;firstConfig&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>

<span class="c">{# Using the entrypoints.json file located in ./public/second_build #}</span><span class="x"></span>
<span class="cp">{{</span> <span class="nv">encore_entry_script_tags</span><span class="o">(</span><span class="s1">&#39;mobile&#39;</span><span class="o">,</span> <span class="kp">null</span><span class="o">,</span> <span class="s1">&#39;secondConfig&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{{</span> <span class="nv">encore_entry_link_tags</span><span class="o">(</span><span class="s1">&#39;mobile&#39;</span><span class="o">,</span> <span class="kp">null</span><span class="o">,</span> <span class="s1">&#39;secondConfig&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="generating-a-webpack-configuration-object-without-using-the-command-line-interface">
<h2>Generating a Webpack Configuration Object without using the Command-Line Interface</h2>
<p>Ordinarily you would use your <code class="docutils literal notranslate"><span class="pre">webpack.config.js</span></code> file by calling Encore
from the command-line interface. But sometimes, having access to the generated
Webpack configuration can be required by tools that don’t use Encore (for
instance a test-runner such as <a class="reference external" href="https://karma-runner.github.io">Karma</a><span class="link-target"> [https://karma-runner.github.io]</span>).</p>
<p>The problem is that if you try generating that Webpack configuration object
without using the <code class="docutils literal notranslate"><span class="pre">encore</span></code> command you will encounter the following error:</p>
<div class="highlight-text notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>Error: Encore.setOutputPath() cannot be called yet because the runtime environment doesn&#39;t appear to be configured. Make sure you&#39;re using the encore executable or call Encore.configureRuntimeEnvironment() first if you&#39;re purposely not calling Encore directly.
</pre></div>
</td></tr></table></div>
<p>The reason behind that message is that Encore needs to know a few things before
being able to create a configuration object, the most important one being what
the target environment is.</p>
<p>To solve this issue you can use <code class="docutils literal notranslate"><span class="pre">configureRuntimeEnvironment</span></code>. This method
must be called from a JavaScript file <strong>before</strong> requiring <code class="docutils literal notranslate"><span class="pre">webpack.config.js</span></code>.</p>
<p>For instance:</p>
<div class="highlight-javascript notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">Encore</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@symfony/webpack-encore&#39;</span><span class="p">);</span>

<span class="c1">// Set the runtime environment</span>
<span class="nx">Encore</span><span class="p">.</span><span class="nx">configureRuntimeEnvironment</span><span class="p">(</span><span class="s1">&#39;dev&#39;</span><span class="p">);</span>

<span class="c1">// Retrieve the Webpack configuration object</span>
<span class="kr">const</span> <span class="nx">webpackConfig</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./webpack.config&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>If needed, you can also pass to that method all the options that you would
normally use from the command-line interface:</p>
<div class="highlight-javascript notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nx">Encore</span><span class="p">.</span><span class="nx">configureRuntimeEnvironment</span><span class="p">(</span><span class="s1">&#39;dev-server&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="c1">// Same options you would use with the</span>
    <span class="c1">// CLI utility, with their name in camelCase.</span>
    <span class="nx">https</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">keepPublicPath</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">});</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="having-the-full-control-on-loaders-rules">
<h2>Having the full control on Loaders Rules</h2>
<p>The method <code class="docutils literal notranslate"><span class="pre">configureLoaderRule()</span></code> provides a clean way to configure Webpack loaders rules (<code class="docutils literal notranslate"><span class="pre">module.rules</span></code>, see <a class="reference external" href="https://webpack.js.org/concepts/loaders/#configuration">Configuration</a><span class="link-target"> [https://webpack.js.org/concepts/loaders/#configuration]</span>).</p>
<p>This is a low-level method. All your modifications will be applied just before pushing the loaders rules to Webpack.
It means that you can override the default configuration provided by Encore, which may break things. Be careful when using it.</p>
<p>One use might be to configure the <code class="docutils literal notranslate"><span class="pre">eslint-loader</span></code> to lint Vue files too.
The following code is equivalent:</p>
<div class="highlight-javascript notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Manually</span>
<span class="kr">const</span> <span class="nx">webpackConfig</span> <span class="o">=</span> <span class="nx">Encore</span><span class="p">.</span><span class="nx">getWebpackConfig</span><span class="p">();</span>

<span class="kr">const</span> <span class="nx">eslintLoader</span> <span class="o">=</span> <span class="nx">webpackConfig</span><span class="p">.</span><span class="nx">module</span><span class="p">.</span><span class="nx">rules</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">rule</span> <span class="p">=&gt;</span> <span class="nx">rule</span><span class="p">.</span><span class="nx">loader</span> <span class="o">===</span> <span class="s1">&#39;eslint-loader&#39;</span><span class="p">);</span>
<span class="nx">eslintLoader</span><span class="p">.</span><span class="nx">test</span> <span class="o">=</span> <span class="sr">/\.(jsx?|vue)$/</span><span class="p">;</span>

<span class="k">return</span> <span class="nx">webpackConfig</span><span class="p">;</span>

<span class="c1">// Using Encore.configureLoaderRule()</span>
<span class="nx">Encore</span><span class="p">.</span><span class="nx">configureLoaderRule</span><span class="p">(</span><span class="s1">&#39;eslint&#39;</span><span class="p">,</span> <span class="nx">loaderRule</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">loaderRule</span><span class="p">.</span><span class="nx">test</span> <span class="o">=</span> <span class="sr">/\.(jsx?|vue)$/</span>
<span class="p">});</span>

<span class="k">return</span> <span class="nx">Encore</span><span class="p">.</span><span class="nx">getWebpackConfig</span><span class="p">();</span>
</pre></div>
</td></tr></table></div>
<dl class="simple">
<dt>The following loaders are configurable with <code class="docutils literal notranslate"><span class="pre">configureLoaderRule()</span></code>:</dt>
<dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">javascript</span></code> (alias <code class="docutils literal notranslate"><span class="pre">js</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">css</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">images</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fonts</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sass</span></code> (alias <code class="docutils literal notranslate"><span class="pre">scss</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">less</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stylus</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vue</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">eslint</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">typescript</span></code> (alias <code class="docutils literal notranslate"><span class="pre">ts</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">handlebars</span></code></p></li>
</ul>
</dd>
</dl>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>