<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <title>Using Encore in a Virtual Machine</title>
    <link rel="stylesheet" href="../../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/rtd_custom.css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <div class="section" id="using-encore-in-a-virtual-machine">
<h1>Using Encore in a Virtual Machine</h1>
<p>Encore is compatible with virtual machines such as <a class="reference external" href="https://www.virtualbox.org/">VirtualBox</a><span class="link-target"> [https://www.virtualbox.org/]</span> and <a class="reference external" href="https://www.vmware.com">VMWare</a><span class="link-target"> [https://www.vmware.com]</span>
but you may need to make some changes to your configuration to make it work.</p>
<div class="section" id="file-watching-issues">
<h2>File Watching Issues</h2>
<p>When using a virtual machine, your project root directory is shared with the
virtual machine using <a class="reference external" href="https://en.wikipedia.org/wiki/Network_File_System">NFS</a><span class="link-target"> [https://en.wikipedia.org/wiki/Network_File_System]</span>. This introduces issues with files watching, so
you must enable the <a class="reference external" href="https://webpack.js.org/configuration/watch/#watchoptionspoll">polling</a><span class="link-target"> [https://webpack.js.org/configuration/watch/#watchoptionspoll]</span> option to make it work:</p>
<div class="highlight-javascript notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// webpack.config.js</span>

<span class="c1">// ...</span>

<span class="c1">// will be applied for `encore dev --watch` and `encore dev-server` commands</span>
<span class="nx">Encore</span><span class="p">.</span><span class="nx">configureWatchOptions</span><span class="p">(</span><span class="nx">watchOptions</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">watchOptions</span><span class="p">.</span><span class="nx">poll</span> <span class="o">=</span> <span class="mi">250</span><span class="p">;</span> <span class="c1">// check for changes every 250 milliseconds</span>
<span class="p">});</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="development-server-issues">
<h2>Development Server Issues</h2>
<div class="section" id="configure-the-public-path">
<h3>Configure the Public Path</h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can skip this section if your application is running on
<code class="docutils literal notranslate"><span class="pre">http://localhost</span></code> instead a custom local domain-name like
<code class="docutils literal notranslate"><span class="pre">http://app.vm</span></code>.</p>
</div>
<p>When running the development server, you will probably see the following errors
in the web console:</p>
<div class="highlight-text notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>GET http://localhost:8080/build/vendors~app.css net::ERR_CONNECTION_REFUSED
GET http://localhost:8080/build/runtime.js net::ERR_CONNECTION_REFUSED
...
</pre></div>
</td></tr></table></div>
<p>If your Symfony application is running on a custom domain (e.g.
<code class="docutils literal notranslate"><span class="pre">http://app.vm</span></code>), you must configure the public path explicitly in your
<code class="docutils literal notranslate"><span class="pre">package.json</span></code>:</p>
<div class="highlight-diff notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span>{
    ...
    &quot;scripts&quot;: {
<span class="gd">-        &quot;dev-server&quot;: &quot;encore dev-server&quot;,</span>
<span class="gi">+        &quot;dev-server&quot;: &quot;encore dev-server --public http://app.vm:8080&quot;,</span>
        ...
    }
}
</pre></div>
</td></tr></table></div>
<p>After restarting Encore and reloading your web page, you will probably see
different issues in the web console:</p>
<div class="highlight-text notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>GET http://app.vm:8080/build/vendors~app.css net::ERR_CONNECTION_REFUSED
GET http://app.vm:8080/build/runtime.js net::ERR_CONNECTION_REFUSED
</pre></div>
</td></tr></table></div>
<p>You still need to make other configuration changes, as explained in the
following sections.</p>
</div>
<div class="section" id="allow-external-access">
<h3>Allow External Access</h3>
<p>Add the <code class="docutils literal notranslate"><span class="pre">--host</span> <span class="pre">0.0.0.0</span></code> argument to the <code class="docutils literal notranslate"><span class="pre">dev-server</span></code> configuration in your
<code class="docutils literal notranslate"><span class="pre">package.json</span></code> file to make the development server accept all incoming
connections:</p>
<div class="highlight-diff notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span>{
    ...
    &quot;scripts&quot;: {
<span class="gd">-        &quot;dev-server&quot;: &quot;encore dev-server --public http://app.vm:8080&quot;,</span>
<span class="gi">+        &quot;dev-server&quot;: &quot;encore dev-server --public http://app.vm:8080 --host 0.0.0.0&quot;,</span>
        ...
    }
}
</pre></div>
</td></tr></table></div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Make sure to run the development server inside your virtual machine only;
otherwise other computers can have access to it.</p>
</div>
</div>
<div class="section" id="fix-invalid-host-header-issue">
<h3>Fix “Invalid Host header” Issue</h3>
<p>Webpack will respond <code class="docutils literal notranslate"><span class="pre">Invalid</span> <span class="pre">Host</span> <span class="pre">header</span></code> when trying to access files from
the dev-server. To fix this, add the argument <code class="docutils literal notranslate"><span class="pre">--disable-host-check</span></code>:</p>
<div class="highlight-diff notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span>{
    ...
    &quot;scripts&quot;: {
<span class="gd">-        &quot;dev-server&quot;: &quot;encore dev-server --public http://app.vm:8080 --host 0.0.0.0&quot;,</span>
<span class="gi">+        &quot;dev-server&quot;: &quot;encore dev-server --public http://app.vm:8080 --host 0.0.0.0 --disable-host-check&quot;,</span>
        ...
    }
}
</pre></div>
</td></tr></table></div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Beware that <a class="reference external" href="https://webpack.js.org/configuration/dev-server/#devserverdisablehostcheck">it’s not recommended to disable host checking</a><span class="link-target"> [https://webpack.js.org/configuration/dev-server/#devserverdisablehostcheck]</span> in general, but
here it’s required to solve the issue when using Encore in a virtual machine.</p>
</div>
</div>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>