<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <title>Couchbase Cache Adapter</title>
    <link rel="stylesheet" href="../../../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/rtd_custom.css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <div class="section" id="couchbase-cache-adapter">
<span id="couchbase-adapter"></span><span id="index-0"></span><h1>Couchbase Cache Adapter</h1>
<div class="versionadded">
<p><span class="versionmodified">New in version 5.1: </span>The CouchbaseBucketAdapter was introduced in Symfony 5.1.</p>
</div>
<p>This adapter stores the values in-memory using one (or more) <a class="reference external" href="https://couchbase.com/">Couchbase server</a><span class="link-target"> [https://couchbase.com/]</span>
instances. Unlike the <a class="reference internal" href="apcu_adapter.xhtml#apcu-adapter"><span class="std std-ref">APCu adapter</span></a>, and similarly to the
<a class="reference internal" href="memcached_adapter.xhtml#memcached-adapter"><span class="std std-ref">Memcached adapter</span></a>, it is not limited to the current server’s
shared memory; you can store contents independent of your PHP environment.
The ability to utilize a cluster of servers to provide redundancy and/or fail-over
is also available.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p><strong>Requirements:</strong> The <a class="reference external" href="https://docs.couchbase.com/sdk-api/couchbase-php-client-2.6.0/files/couchbase.html">Couchbase PHP extension</a><span class="link-target"> [https://docs.couchbase.com/sdk-api/couchbase-php-client-2.6.0/files/couchbase.html]</span> as well as a <a class="reference external" href="https://couchbase.com/">Couchbase server</a><span class="link-target"> [https://couchbase.com/]</span>
must be installed, active, and running to use this adapter. Version <code class="docutils literal notranslate"><span class="pre">2.6</span></code> or
greater of the <a class="reference external" href="https://docs.couchbase.com/sdk-api/couchbase-php-client-2.6.0/files/couchbase.html">Couchbase PHP extension</a><span class="link-target"> [https://docs.couchbase.com/sdk-api/couchbase-php-client-2.6.0/files/couchbase.html]</span> is required for this adapter.</p>
</div>
<p>This adapter expects a <a class="reference external" href="https://docs.couchbase.com/sdk-api/couchbase-php-client-2.6.0/classes/Couchbase.Bucket.html">Couchbase Bucket</a><span class="link-target"> [https://docs.couchbase.com/sdk-api/couchbase-php-client-2.6.0/classes/Couchbase.Bucket.html]</span> instance to be passed as the first
parameter. A namespace and default cache lifetime can optionally be passed as
the second and third parameters:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\Cache\Adapter\CouchbaseBucketAdapter</span><span class="p">;</span>

<span class="nv">$cache</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CouchbaseBucketAdapter</span><span class="p">(</span>
    <span class="c1">// the client object that sets options and adds the server instance(s)</span>
    <span class="nx">\CouchbaseBucket</span> <span class="nv">$client</span><span class="p">,</span>

    <span class="c1">// the name of bucket</span>
    <span class="nx">string</span> <span class="nv">$bucket</span><span class="p">,</span>

    <span class="c1">// a string prefixed to the keys of the items stored in this cache</span>
    <span class="nv">$namespace</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>

    <span class="c1">// the default lifetime (in seconds) for cache items that do not define their</span>
    <span class="c1">// own lifetime, with a value 0 causing items to be stored indefinitely</span>
    <span class="nv">$defaultLifetime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="section" id="configure-the-connection">
<h2>Configure the Connection</h2>
<p>The <code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Cache/Adapter/CouchbaseBucketAdapter.php" title="Symfony\Component\Cache\Adapter\CouchbaseBucketAdapter::createConnection()"><span class="pre">createConnection()</span></a><span class="link-target"> <span class="pre">[https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Cache/Adapter/CouchbaseBucketAdapter.php]</span></span></code>
helper method allows creating and configuring a <a class="reference external" href="https://docs.couchbase.com/sdk-api/couchbase-php-client-2.6.0/classes/Couchbase.Bucket.html">Couchbase Bucket</a><span class="link-target"> [https://docs.couchbase.com/sdk-api/couchbase-php-client-2.6.0/classes/Couchbase.Bucket.html]</span> class instance using a
<a class="reference external" href="https://en.wikipedia.org/wiki/Data_source_name">Data Source Name (DSN)</a><span class="link-target"> [https://en.wikipedia.org/wiki/Data_source_name]</span> or an array of DSNs:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\Cache\Adapter\CouchbaseBucketAdapter</span><span class="p">;</span>

<span class="c1">// pass a single DSN string to register a single server with the client</span>
<span class="nv">$client</span> <span class="o">=</span> <span class="nx">CouchbaseBucketAdapter</span><span class="o">::</span><span class="na">createConnection</span><span class="p">(</span>
    <span class="s1">&#39;couchbase://localhost&#39;</span>
    <span class="c1">// the DSN can include config options (pass them as a query string):</span>
    <span class="c1">// &#39;couchbase://localhost:11210?operationTimeout=10&#39;</span>
    <span class="c1">// &#39;couchbase://localhost:11210?operationTimeout=10&amp;configTimout=20&#39;</span>
<span class="p">);</span>

<span class="c1">// pass an array of DSN strings to register multiple servers with the client</span>
<span class="nv">$client</span> <span class="o">=</span> <span class="nx">CouchbaseBucketAdapter</span><span class="o">::</span><span class="na">createConnection</span><span class="p">([</span>
    <span class="s1">&#39;couchbase://10.0.0.100&#39;</span><span class="p">,</span>
    <span class="s1">&#39;couchbase://10.0.0.101&#39;</span><span class="p">,</span>
    <span class="s1">&#39;couchbase://10.0.0.102&#39;</span><span class="p">,</span>
    <span class="c1">// etc...</span>
<span class="p">]);</span>

<span class="c1">// a single DSN can define multiple servers using the following syntax:</span>
<span class="c1">// host[hostname-or-IP:port] (where port is optional). Sockets must include a trailing &#39;:&#39;</span>
<span class="nv">$client</span> <span class="o">=</span> <span class="nx">CouchbaseBucketAdapter</span><span class="o">::</span><span class="na">createConnection</span><span class="p">(</span>
    <span class="s1">&#39;couchbase:?host[localhost]&amp;host[localhost:12345]&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="configure-the-options">
<h2>Configure the Options</h2>
<p>The <code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Cache/Adapter/CouchbaseBucketAdapter.php" title="Symfony\Component\Cache\Adapter\CouchbaseBucketAdapter::createConnection()"><span class="pre">createConnection()</span></a><span class="link-target"> <span class="pre">[https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Cache/Adapter/CouchbaseBucketAdapter.php]</span></span></code>
helper method also accepts an array of options as its second argument. The
expected format is an associative array of <code class="docutils literal notranslate"><span class="pre">key</span> <span class="pre">=&gt;</span> <span class="pre">value</span></code> pairs representing
option names and their respective values:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\Cache\Adapter\CouchbaseBucketAdapter</span><span class="p">;</span>

<span class="nv">$client</span> <span class="o">=</span> <span class="nx">CouchbaseBucketAdapter</span><span class="o">::</span><span class="na">createConnection</span><span class="p">(</span>
    <span class="c1">// a DSN string or an array of DSN strings</span>
    <span class="p">[],</span>

    <span class="c1">// associative array of configuration options</span>
    <span class="p">[</span>
        <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;xxxxxx&#39;</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yyyyyy&#39;</span><span class="p">,</span>
        <span class="s1">&#39;configTimeout&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;100&#39;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="section" id="available-options">
<h3>Available Options</h3>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">username</span></code> (type: <code class="docutils literal notranslate"><span class="pre">string</span></code>)</dt>
<dd><p>Username for connection <code class="docutils literal notranslate"><span class="pre">CouchbaseCluster</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">password</span></code> (type: <code class="docutils literal notranslate"><span class="pre">string</span></code>)</dt>
<dd><p>Password of connection <code class="docutils literal notranslate"><span class="pre">CouchbaseCluster</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">operationTimeout</span></code> (type: <code class="docutils literal notranslate"><span class="pre">int</span></code>, default: <code class="docutils literal notranslate"><span class="pre">2500000</span></code>)</dt>
<dd><p>The operation timeout (in microseconds) is the maximum amount of time the library will
wait for an operation to receive a response before invoking its callback with a failure status.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">configTimeout</span></code> (type: <code class="docutils literal notranslate"><span class="pre">int</span></code>, default: <code class="docutils literal notranslate"><span class="pre">5000000</span></code>)</dt>
<dd><p>How long (in microseconds) the client will wait to obtain the initial configuration.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">configNodeTimeout</span></code> (type: <code class="docutils literal notranslate"><span class="pre">int</span></code>, default: <code class="docutils literal notranslate"><span class="pre">2000000</span></code>)</dt>
<dd><p>Per-node configuration timeout (in microseconds).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">viewTimeout</span></code> (type: <code class="docutils literal notranslate"><span class="pre">int</span></code>, default: <code class="docutils literal notranslate"><span class="pre">75000000</span></code>)</dt>
<dd><p>The I/O timeout (in microseconds) for HTTP requests to Couchbase Views API.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">httpTimeout</span></code> (type: <code class="docutils literal notranslate"><span class="pre">int</span></code>, default: <code class="docutils literal notranslate"><span class="pre">75000000</span></code>)</dt>
<dd><p>The I/O timeout (in microseconds) for HTTP queries (management API).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">configDelay</span></code> (type: <code class="docutils literal notranslate"><span class="pre">int</span></code>, default: <code class="docutils literal notranslate"><span class="pre">10000</span></code>)</dt>
<dd><p>Config refresh throttling
Modify the amount of time (in microseconds) before the configuration error threshold will forcefully be set to its maximum number forcing a configuration refresh.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">htconfigIdleTimeout</span></code> (type: <code class="docutils literal notranslate"><span class="pre">int</span></code>, default: <code class="docutils literal notranslate"><span class="pre">4294967295</span></code>)</dt>
<dd><p>Idling/Persistence for HTTP bootstrap (in microseconds).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">durabilityInterval</span></code> (type: <code class="docutils literal notranslate"><span class="pre">int</span></code>, default: <code class="docutils literal notranslate"><span class="pre">100000</span></code>)</dt>
<dd><p>The time (in microseconds) the client will wait between repeated probes to a given server.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">durabilityTimeout</span></code> (type: <code class="docutils literal notranslate"><span class="pre">int</span></code>, default: <code class="docutils literal notranslate"><span class="pre">5000000</span></code>)</dt>
<dd><p>The time (in microseconds) the client will spend sending repeated probes to a given key’s vBucket masters and replicas before they are deemed not to have satisfied the durability requirements.</p>
</dd>
</dl>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Reference the <a class="reference external" href="https://docs.couchbase.com/sdk-api/couchbase-php-client-2.6.0/classes/Couchbase.Bucket.html">Couchbase Bucket</a><span class="link-target"> [https://docs.couchbase.com/sdk-api/couchbase-php-client-2.6.0/classes/Couchbase.Bucket.html]</span> extension’s <a class="reference external" href="https://docs.couchbase.com/sdk-api/couchbase-php-client-2.6.0/classes/Couchbase.Bucket.html">predefined constants</a><span class="link-target"> [https://docs.couchbase.com/sdk-api/couchbase-php-client-2.6.0/classes/Couchbase.Bucket.html]</span> documentation
for additional information about the available options.</p>
</div>
</div>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>