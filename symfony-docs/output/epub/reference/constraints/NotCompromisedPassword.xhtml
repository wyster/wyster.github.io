<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <title>NotCompromisedPassword</title>
    <link rel="stylesheet" href="../../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/rtd_custom.css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <div class="section" id="notcompromisedpassword">
<h1>NotCompromisedPassword</h1>
<div class="versionadded">
<p><span class="versionmodified">New in version 4.3: </span>The <code class="docutils literal notranslate"><span class="pre">NotCompromisedPassword</span></code> constraint was introduced in Symfony 4.3.</p>
</div>
<p>Validates that the given password has not been compromised by checking that it is
not included in any of the public data breaches tracked by <a class="reference external" href="https://haveibeenpwned.com/">haveibeenpwned.com</a><span class="link-target"> [https://haveibeenpwned.com/]</span>.</p>
<table class="docutils">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Applies to</p></td>
<td><p><a class="reference internal" href="../../validation.xhtml#validation-property-target"><span class="std std-ref">property or method</span></a></p></td>
</tr>
<tr class="row-even"><td><p>Options</p></td>
<td><ul class="simple">
<li><p><a class="reference internal" href="#groups">groups</a></p></li>
<li><p><a class="reference internal" href="#message">message</a></p></li>
<li><p><a class="reference internal" href="#payload">payload</a></p></li>
<li><p><a class="reference internal" href="#skiponerror">skipOnError</a></p></li>
<li><p><a class="reference internal" href="#threshold">threshold</a></p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>Class</p></td>
<td><p><code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Validator/Constraints/NotCompromisedPassword.php" title="Symfony\Component\Validator\Constraints\NotCompromisedPassword"><span class="pre">NotCompromisedPassword</span></a><span class="link-target"> <span class="pre">[https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Validator/Constraints/NotCompromisedPassword.php]</span></span></code></p></td>
</tr>
<tr class="row-even"><td><p>Validator</p></td>
<td><p><code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Validator/Constraints/NotCompromisedPasswordValidator.php" title="Symfony\Component\Validator\Constraints\NotCompromisedPasswordValidator"><span class="pre">NotCompromisedPasswordValidator</span></a><span class="link-target"> <span class="pre">[https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Validator/Constraints/NotCompromisedPasswordValidator.php]</span></span></code></p></td>
</tr>
</tbody>
</table>
<div class="section" id="basic-usage">
<h2>Basic Usage</h2>
<p>The following constraint ensures that the <code class="docutils literal notranslate"><span class="pre">rawPassword</span></code> property of the
<code class="docutils literal notranslate"><span class="pre">User</span></code> class doesn’t store a compromised password:</p>
<div class="configuration-block">
<ul class="simple">
<li><p><em>Annotations</em><div class="highlight-php-annotations notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/Entity/User.php</span>
<span class="k">namespace</span> <span class="nx">App\Entity</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraints</span> <span class="k">as</span> <span class="nx">Assert</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @Assert\NotCompromisedPassword</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$rawPassword</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</p></li>
<li><p><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/validator/validation.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">App\Entity\User</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">rawPassword</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">NotCompromisedPassword</span>
</pre></div>
</td></tr></table></div>
</p></li>
<li><p><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/validator/validation.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;constraint-mapping</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/constraint-mapping&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/constraint-mapping https://symfony.com/schema/dic/constraint-mapping/constraint-mapping-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;class</span> <span class="na">name=</span><span class="s">&quot;App\Entity\User&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;rawPassword&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;constraint</span> <span class="na">name=</span><span class="s">&quot;NotCompromisedPassword&quot;</span><span class="nt">&gt;&lt;/constraint&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/class&gt;</span>
<span class="nt">&lt;/constraint-mapping&gt;</span>
</pre></div>
</td></tr></table></div>
</p></li>
<li><p><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/Entity/User.php</span>
<span class="k">namespace</span> <span class="nx">App\Entity</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraints</span> <span class="k">as</span> <span class="nx">Assert</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Mapping\ClassMetadata</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">loadValidatorMetadata</span><span class="p">(</span><span class="nx">ClassMetadata</span> <span class="nv">$metadata</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$metadata</span><span class="o">-&gt;</span><span class="na">addPropertyConstraint</span><span class="p">(</span><span class="s1">&#39;rawPassword&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Assert\NotCompromisedPassword</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</p></li>
</ul>
</div>
<p>In order to make the password validation, this constraint doesn’t send the raw
password value to the <code class="docutils literal notranslate"><span class="pre">haveibeenpwned.com</span></code> API. Instead, it follows a secure
process known as <a class="reference external" href="https://blog.cloudflare.com/validating-leaked-passwords-with-k-anonymity/">k-anonymity password validation</a><span class="link-target"> [https://blog.cloudflare.com/validating-leaked-passwords-with-k-anonymity/]</span>.</p>
<p>In practice, the raw password is hashed using SHA-1 and only the first bytes of
the hash are sent. Then, the <code class="docutils literal notranslate"><span class="pre">haveibeenpwned.com</span></code> API compares those bytes
with the SHA-1 hashes of all leaked passwords and returns the list of hashes
that start with those same bytes. That’s how the constraint can check if the
password has been compromised without fully disclosing it.</p>
<p>For example, if the password is <code class="docutils literal notranslate"><span class="pre">test</span></code>, the entire SHA-1 hash is
<code class="docutils literal notranslate"><span class="pre">a94a8fe5ccb19ba61c4c0873d391e987982fbbd3</span></code> but the validator only sends
<code class="docutils literal notranslate"><span class="pre">a94a8</span></code> to the <code class="docutils literal notranslate"><span class="pre">haveibeenpwned.com</span></code> API.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>When using this constraint inside a Symfony application, define the
<a class="reference internal" href="../configuration/framework.xhtml#reference-validation-not-compromised-password"><span class="std std-ref">not_compromised_password</span></a>
option to avoid making HTTP requests in the <code class="docutils literal notranslate"><span class="pre">dev</span></code> and <code class="docutils literal notranslate"><span class="pre">test</span></code> environments.</p>
</div>
</div>
<div class="section" id="available-options">
<h2>Available Options</h2>
<div class="section" id="groups">
<h3><code class="docutils literal notranslate"><span class="pre">groups</span></code></h3>
<p><strong>type</strong>: <code class="docutils literal notranslate"><span class="pre">array</span></code> | <code class="docutils literal notranslate"><span class="pre">string</span></code></p>
<p>It defines the validation group or groups this constraint belongs to. Read more
about <a class="reference internal" href="../../validation/groups.xhtml"><span class="doc">validation groups</span></a>.</p>
</div>
<div class="section" id="message">
<h3>message</h3>
<p><strong>type</strong>: <code class="docutils literal notranslate"><span class="pre">string</span></code> <strong>default</strong>: <code class="docutils literal notranslate"><span class="pre">This</span> <span class="pre">password</span> <span class="pre">has</span> <span class="pre">been</span> <span class="pre">leaked</span> <span class="pre">in</span> <span class="pre">a</span> <span class="pre">data</span> <span class="pre">breach,</span> <span class="pre">it</span> <span class="pre">must</span> <span class="pre">not</span> <span class="pre">be</span> <span class="pre">used.</span> <span class="pre">Please</span> <span class="pre">use</span> <span class="pre">another</span> <span class="pre">password.</span></code></p>
<p>The default message supplied when the password has been compromised.</p>
</div>
<div class="section" id="payload">
<h3><code class="docutils literal notranslate"><span class="pre">payload</span></code></h3>
<p><strong>type</strong>: <code class="docutils literal notranslate"><span class="pre">mixed</span></code> <strong>default</strong>: <code class="docutils literal notranslate"><span class="pre">null</span></code></p>
<p>This option can be used to attach arbitrary domain-specific data to a constraint.
The configured payload is not used by the Validator component, but its processing
is completely up to you.</p>
<p>For example, you may want to use
<a class="reference internal" href="../../validation/severity.xhtml"><span class="doc">several error levels</span></a> to present failed
constraints differently in the front-end depending on the severity of the
error.</p>
</div>
<div class="section" id="skiponerror">
<h3>skipOnError</h3>
<p><strong>type</strong>: <code class="docutils literal notranslate"><span class="pre">boolean</span></code> <strong>default</strong>: <code class="docutils literal notranslate"><span class="pre">false</span></code></p>
<p>When the HTTP request made to the <code class="docutils literal notranslate"><span class="pre">haveibeenpwned.com</span></code> API fails for any
reason, an exception is thrown (no validation error is displayed). Set this
option to <code class="docutils literal notranslate"><span class="pre">true</span></code> to not throw the exception and consider the password valid.</p>
</div>
<div class="section" id="threshold">
<h3>threshold</h3>
<p><strong>type</strong>: <code class="docutils literal notranslate"><span class="pre">integer</span></code> <strong>default</strong>: <code class="docutils literal notranslate"><span class="pre">1</span></code></p>
<p>This value defines the number of times a password should have been leaked
publicly to consider it compromised. Think carefully before setting this option
to a higher value because it could decrease the security of your application.</p>
</div>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>