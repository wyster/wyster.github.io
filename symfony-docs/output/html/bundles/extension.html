

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>How to Load Service Configuration inside a Bundle &mdash; Symfony Framework Documentation  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/rtd_custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to Simplify Configuration of Multiple Bundles" href="prepend_extension.html" />
    <link rel="prev" title="How to Create Friendly Configuration for a Bundle" href="configuration.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #f0f0f0" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/symfony-logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                4.4}
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../quick_tour/index.html">The Quick Tour</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../best_practices.html">The Symfony Framework Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bundles.html">The Bundle System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cache.html">Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console.html">Console Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doctrine.html">Databases and the Doctrine ORM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">How to Deploy a Symfony Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../email.html">Swift Mailer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../event_dispatcher.html">Events and Event Listeners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../forms.html">Forms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../frontend.html">Managing CSS and JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../http_cache.html">HTTP Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../http_client.html">HTTP Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lock.html">Dealing with Concurrency with Locks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mailer.html">Sending Emails with Mailer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mercure.html">Pushing Data to Clients Using the Mercure Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../messenger.html">Messenger: Sync &amp; Queued Message Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration.html">Migrating an Existing Application to Symfony</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profiler.html">Profiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../routing.html">Routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session.html">Sessions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup.html">Installing &amp; Setting up the Symfony Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../serializer.html">How to Use the Serializer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../service_container.html">Service Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../translation.html">Translations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../validation.html">Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../web_link.html">Asset Preloading and Resource Hints with HTTP/2 and WebLink</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow.html">Workflow</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../components/index.html">The Components</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../components/using_components.html">How to Install and Use the Symfony Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/asset.html">The Asset Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/browser_kit.html">The BrowserKit Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/cache.html">The Cache Component</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../components/config.html">The Config Component</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../components/config.html#installation">Installation</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../components/config.html#learn-more">Learn More</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../components/config/caching.html">Caching based on Resources</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/config/definition.html">Defining and Processing Configuration Values</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/config/resources.html">Loading Resources</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html">How to Create Friendly Configuration for a Bundle</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">How to Load Service Configuration inside a Bundle</a></li>
<li class="toctree-l4"><a class="reference internal" href="prepend_extension.html">How to Simplify Configuration of Multiple Bundles</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/console.html">The Console Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/contracts.html">The Contracts Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/css_selector.html">The CssSelector Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/dependency_injection.html">The DependencyInjection Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/dom_crawler.html">The DomCrawler Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/event_dispatcher.html">The EventDispatcher Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/expression_language.html">The ExpressionLanguage Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/filesystem.html">The Filesystem Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/finder.html">The Finder Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/form.html">The Form Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/http_foundation.html">The HttpFoundation Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/http_kernel.html">The HttpKernel Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/inflector.html">The Inflector Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/intl.html">The Intl Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/ldap.html">The Ldap Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/lock.html">The Lock Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/messenger.html">The Messenger Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/mime.html">The Mime Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/options_resolver.html">The OptionsResolver Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/phpunit_bridge.html">The PHPUnit Bridge</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/process.html">The Process Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/property_access.html">The PropertyAccess Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/property_info.html">The PropertyInfo Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/psr7.html">The PSR-7 Bridge</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/security.html">The Security Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/serializer.html">The Serializer Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/validator.html">The Validator Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/var_dumper.html">The VarDumper Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/var_exporter.html">The VarExporter Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/workflow.html">The Workflow Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/yaml.html">The Yaml Component</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference Documents</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../create_framework/index.html">Create your own PHP Framework</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Symfony Framework Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../components/index.html">The Components</a> &raquo;</li>
        
          <li><a href="../components/config.html">The Config Component</a> &raquo;</li>
        
      <li>How to Load Service Configuration inside a Bundle</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/bundles/extension.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="how-to-load-service-configuration-inside-a-bundle">
<span id="index-0"></span><h1>How to Load Service Configuration inside a Bundle<a class="headerlink" href="#how-to-load-service-configuration-inside-a-bundle" title="Permalink to this headline">¶</a></h1>
<p>Services created by bundles are not defined in the main <code class="docutils literal notranslate"><span class="pre">config/services.yaml</span></code>
file used by the application but in the bundles themselves. This article
explains how to create and load service files using the bundle directory
structure.</p>
<div class="section" id="creating-an-extension-class">
<h2>Creating an Extension Class<a class="headerlink" href="#creating-an-extension-class" title="Permalink to this headline">¶</a></h2>
<p>In order to load service configuration, you have to create a Dependency
Injection (DI) Extension for your bundle. By default, the Extension class must
follow these conventions (but later you’ll learn how to skip them if needed):</p>
<ul class="simple">
<li>It has to live in the <code class="docutils literal notranslate"><span class="pre">DependencyInjection</span></code> namespace of the bundle;</li>
<li>It has to implement the <code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/DependencyInjection/Extension/ExtensionInterface.php" title="Symfony\Component\DependencyInjection\Extension\ExtensionInterface"><span class="pre">ExtensionInterface</span></a></code>,
which is usually achieved by extending the
<code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/DependencyInjection/Extension/Extension.php" title="Symfony\Component\DependencyInjection\Extension\Extension"><span class="pre">Extension</span></a></code> class;</li>
<li>The name is equal to the bundle name with the <code class="docutils literal notranslate"><span class="pre">Bundle</span></code> suffix replaced by
<code class="docutils literal notranslate"><span class="pre">Extension</span></code> (e.g. the Extension class of the AcmeBundle would be called
<code class="docutils literal notranslate"><span class="pre">AcmeExtension</span></code> and the one for AcmeHelloBundle would be called
<code class="docutils literal notranslate"><span class="pre">AcmeHelloExtension</span></code>).</li>
</ul>
<p>This is how the extension of an AcmeHelloBundle should look like:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Acme/HelloBundle/DependencyInjection/AcmeHelloExtension.php</span>
<span class="k">namespace</span> <span class="nx">Acme\HelloBundle\DependencyInjection</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\DependencyInjection\ContainerBuilder</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\DependencyInjection\Extension\Extension</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AcmeHelloExtension</span> <span class="k">extends</span> <span class="nx">Extension</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">load</span><span class="p">(</span><span class="k">array</span> <span class="nv">$configs</span><span class="p">,</span> <span class="nx">ContainerBuilder</span> <span class="nv">$container</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ... you&#39;ll load the files here later</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="manually-registering-an-extension-class">
<h3>Manually Registering an Extension Class<a class="headerlink" href="#manually-registering-an-extension-class" title="Permalink to this headline">¶</a></h3>
<p>When not following the conventions, you will have to manually register your
extension. To do this, you should override the
<code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/HttpKernel/Bundle/Bundle.php" title="Symfony\Component\HttpKernel\Bundle\Bundle::build()"><span class="pre">Bundle::getContainerExtension()</span></a></code>
method to return the instance of the extension:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// ...</span>
<span class="k">use</span> <span class="nx">Acme\HelloBundle\DependencyInjection\UnconventionalExtensionClass</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AcmeHelloBundle</span> <span class="k">extends</span> <span class="nx">Bundle</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getContainerExtension</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">UnconventionalExtensionClass</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In addition, when the new Extension class name doesn’t follow the naming
conventions, you must also override the
<code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/DependencyInjection/Extension/Extension.php" title="Symfony\Component\DependencyInjection\Extension\Extension::getAlias()"><span class="pre">Extension::getAlias()</span></a></code>
method to return the correct DI alias. The DI alias is the name used to refer to
the bundle in the container (e.g. in the <code class="docutils literal notranslate"><span class="pre">config/packages/</span></code> files). By
default, this is done by removing the <code class="docutils literal notranslate"><span class="pre">Extension</span></code> suffix and converting the
class name to underscores (e.g. <code class="docutils literal notranslate"><span class="pre">AcmeHelloExtension</span></code>’s DI alias is
<code class="docutils literal notranslate"><span class="pre">acme_hello</span></code>).</p>
</div>
</div>
<div class="section" id="using-the-load-method">
<h2>Using the <code class="docutils literal notranslate"><span class="pre">load()</span></code> Method<a class="headerlink" href="#using-the-load-method" title="Permalink to this headline">¶</a></h2>
<p>In the <code class="docutils literal notranslate"><span class="pre">load()</span></code> method, all services and parameters related to this extension
will be loaded. This method doesn’t get the actual container instance, but a
copy. This container only has the parameters from the actual container. After
loading the services and parameters, the copy will be merged into the actual
container, to ensure all services and parameters are also added to the actual
container.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">load()</span></code> method, you can use PHP code to register service definitions,
but it is more common if you put these definitions in a configuration file
(using the YAML, XML or PHP format).</p>
<p>For instance, assume you have a file called <code class="docutils literal notranslate"><span class="pre">services.xml</span></code> in the
<code class="docutils literal notranslate"><span class="pre">Resources/config/</span></code> directory of your bundle, your <code class="docutils literal notranslate"><span class="pre">load()</span></code> method looks like:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\Config\FileLocator</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\DependencyInjection\Loader\XmlFileLoader</span><span class="p">;</span>

<span class="c1">// ...</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">load</span><span class="p">(</span><span class="k">array</span> <span class="nv">$configs</span><span class="p">,</span> <span class="nx">ContainerBuilder</span> <span class="nv">$container</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XmlFileLoader</span><span class="p">(</span>
        <span class="nv">$container</span><span class="p">,</span>
        <span class="k">new</span> <span class="nx">FileLocator</span><span class="p">(</span><span class="no">__DIR__</span><span class="o">.</span><span class="s1">&#39;/../Resources/config&#39;</span><span class="p">)</span>
    <span class="p">);</span>
    <span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">load</span><span class="p">(</span><span class="s1">&#39;services.xml&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The other available loaders are <code class="docutils literal notranslate"><span class="pre">YamlFileLoader</span></code> and <code class="docutils literal notranslate"><span class="pre">PhpFileLoader</span></code>.</p>
<div class="section" id="using-configuration-to-change-the-services">
<h3>Using Configuration to Change the Services<a class="headerlink" href="#using-configuration-to-change-the-services" title="Permalink to this headline">¶</a></h3>
<p>The Extension is also the class that handles the configuration for that
particular bundle (e.g. the configuration in <code class="docutils literal notranslate"><span class="pre">config/packages/&lt;bundle_alias&gt;.yaml</span></code>).
To read more about it, see the “<a class="reference internal" href="configuration.html"><span class="doc">How to Create Friendly Configuration for a Bundle</span></a>” article.</p>
</div>
</div>
<div class="section" id="adding-classes-to-compile">
<h2>Adding Classes to Compile<a class="headerlink" href="#adding-classes-to-compile" title="Permalink to this headline">¶</a></h2>
<p>Bundles can hint Symfony about which of their classes contain annotations so
they are compiled when generating the application cache to improve the overall
performance. Define the list of annotated classes to compile in the
<code class="docutils literal notranslate"><span class="pre">addAnnotatedClassesToCompile()</span></code> method:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">load</span><span class="p">(</span><span class="k">array</span> <span class="nv">$configs</span><span class="p">,</span> <span class="nx">ContainerBuilder</span> <span class="nv">$container</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addAnnotatedClassesToCompile</span><span class="p">([</span>
        <span class="c1">// you can define the fully qualified class names...</span>
        <span class="s1">&#39;App\\Controller\\DefaultController&#39;</span><span class="p">,</span>
        <span class="c1">// ... but glob patterns are also supported:</span>
        <span class="s1">&#39;**Bundle\\Controller\\&#39;</span><span class="p">,</span>

        <span class="c1">// ...</span>
    <span class="p">]);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If some class extends from other classes, all its parents are automatically
included in the list of classes to compile.</p>
</div>
<p>Patterns are transformed into the actual class namespaces using the classmap
generated by Composer. Therefore, before using these patterns, you must generate
the full classmap executing the <code class="docutils literal notranslate"><span class="pre">dump-autoload</span></code> command of Composer.</p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">This technique can’t be used when the classes to compile use the <code class="docutils literal notranslate"><span class="pre">__DIR__</span></code>
or <code class="docutils literal notranslate"><span class="pre">__FILE__</span></code> constants, because their values will change when loading
these classes from the <code class="docutils literal notranslate"><span class="pre">classes.php</span></code> file.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2004-2020 Fabien Potencier

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>