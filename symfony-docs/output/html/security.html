

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Security &mdash; Symfony Framework Documentation  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/rtd_custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Using the new Authenticator-based Security" href="security/experimental_authenticators.html" />
    <link rel="prev" title="Rate Limiter" href="rate_limiter.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #f0f0f0" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/symfony-logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                5.x}
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="quick_tour/index.html">The Quick Tour</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started/index.html">Getting Started</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="best_practices.html">The Symfony Framework Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="bundles.html">The Bundle System</a></li>
<li class="toctree-l1"><a class="reference internal" href="cache.html">Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="console.html">Console Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="doctrine.html">Databases and the Doctrine ORM</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html">How to Deploy a Symfony Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="email.html">Swift Mailer</a></li>
<li class="toctree-l1"><a class="reference internal" href="event_dispatcher.html">Events and Event Listeners</a></li>
<li class="toctree-l1"><a class="reference internal" href="forms.html">Forms</a></li>
<li class="toctree-l1"><a class="reference internal" href="frontend.html">Managing CSS and JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="http_cache.html">HTTP Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="http_client.html">HTTP Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="lock.html">Dealing with Concurrency with Locks</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="mailer.html">Sending Emails with Mailer</a></li>
<li class="toctree-l1"><a class="reference internal" href="mercure.html">Pushing Data to Clients Using the Mercure Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="messenger.html">Messenger: Sync &amp; Queued Message Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="migration.html">Migrating an Existing Application to Symfony</a></li>
<li class="toctree-l1"><a class="reference internal" href="notifier.html">Creating and Sending Notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="profiler.html">Profiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="rate_limiter.html">Rate Limiter</a></li>
<li class="toctree-l1"><a class="reference internal" href="routing.html">Routing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Security</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">1) Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-create-your-user-class">2a) Create your User Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="#b-the-user-provider">2b) The “User Provider”</a></li>
<li class="toctree-l2"><a class="reference internal" href="#c-encoding-passwords">2c) Encoding Passwords</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-authentication-firewalls">3a) Authentication &amp; Firewalls</a></li>
<li class="toctree-l2"><a class="reference internal" href="#b-authenticating-your-users">3b) Authenticating your Users</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#guard-authenticators">Guard Authenticators</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#denying-access-roles-and-other-authorization">4) Denying Access, Roles and other Authorization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#roles">Roles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#add-code-to-deny-access">Add Code to Deny Access</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#securing-url-patterns-access-control">Securing URL patterns (access_control)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#securing-controllers-and-other-code">Securing Controllers and other Code</a></li>
<li class="toctree-l4"><a class="reference internal" href="#access-control-in-templates">Access Control in Templates</a></li>
<li class="toctree-l4"><a class="reference internal" href="#securing-other-services">Securing other Services</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#setting-individual-user-permissions">Setting Individual User Permissions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#checking-to-see-if-a-user-is-logged-in-is-authenticated-fully">Checking to see if a User is Logged In (IS_AUTHENTICATED_FULLY)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-fetching-the-user-object">5a) Fetching the User Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="#b-fetching-the-user-from-a-service">5b) Fetching the User from a Service</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fetch-the-user-in-a-template">Fetch the User in a Template</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#logging-out">Logging Out</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#customizing-logout">Customizing Logout</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#hierarchical-roles">Hierarchical Roles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#frequently-asked-questions">Frequently Asked Questions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#learn-more">Learn More</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#authentication-identifying-logging-in-the-user">Authentication (Identifying/Logging in the User)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="security/experimental_authenticators.html">Using the new Authenticator-based Security</a></li>
<li class="toctree-l4"><a class="reference internal" href="security/form_login_setup.html">How to Build a Login Form</a></li>
<li class="toctree-l4"><a class="reference internal" href="security/reset_password.html">How to Add a Reset Password Feature</a></li>
<li class="toctree-l4"><a class="reference internal" href="security/json_login_setup.html">How to Build a JSON Authentication Endpoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="security/guard_authentication.html">Custom Authentication System with Guard (API Token Example)</a></li>
<li class="toctree-l4"><a class="reference internal" href="security/password_migration.html">How to Migrate a Password Hash</a></li>
<li class="toctree-l4"><a class="reference internal" href="security/auth_providers.html">Built-in Authentication Providers</a></li>
<li class="toctree-l4"><a class="reference internal" href="security/user_provider.html">Security User Providers</a></li>
<li class="toctree-l4"><a class="reference internal" href="security/ldap.html">Authenticating against an LDAP server</a></li>
<li class="toctree-l4"><a class="reference internal" href="security/remember_me.html">How to Add “Remember Me” Login Functionality</a></li>
<li class="toctree-l4"><a class="reference internal" href="security/impersonating_user.html">How to Impersonate a User</a></li>
<li class="toctree-l4"><a class="reference internal" href="security/user_checkers.html">How to Create and Enable Custom User Checkers</a></li>
<li class="toctree-l4"><a class="reference internal" href="security/named_encoders.html">How to Use A Different Password Encoder Algorithm Per User</a></li>
<li class="toctree-l4"><a class="reference internal" href="security/multiple_guard_authenticators.html">How to Use Multiple Guard Authenticators</a></li>
<li class="toctree-l4"><a class="reference internal" href="security/firewall_restriction.html">How to Restrict Firewalls to a Request</a></li>
<li class="toctree-l4"><a class="reference internal" href="security/csrf.html">How to Implement CSRF Protection</a></li>
<li class="toctree-l4"><a class="reference internal" href="security/custom_authentication_provider.html">How to Create a custom Authentication Provider</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#authorization-denying-access">Authorization (Denying Access)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="security/voters.html">How to Use Voters to Check User Permissions</a></li>
<li class="toctree-l4"><a class="reference internal" href="security/securing_services.html">How to Secure any Service or Method in your Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="security/access_control.html">How Does the Security access_control Work?</a></li>
<li class="toctree-l4"><a class="reference internal" href="security/access_denied_handler.html">How to Customize Access Denied Responses</a></li>
<li class="toctree-l4"><a class="reference internal" href="security/acl.html">How to Use Access Control Lists (ACLs)</a></li>
<li class="toctree-l4"><a class="reference internal" href="security/force_https.html">How to Force HTTPS or HTTP for different URLs</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="session.html">Sessions</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Installing &amp; Setting up the Symfony Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="serializer.html">How to Use the Serializer</a></li>
<li class="toctree-l1"><a class="reference internal" href="service_container.html">Service Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="translation.html">Translations</a></li>
<li class="toctree-l1"><a class="reference internal" href="validation.html">Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="web_link.html">Asset Preloading and Resource Hints with HTTP/2 and WebLink</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow.html">Workflow</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="components/index.html">The Components</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="reference/index.html">Reference Documents</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing/index.html">Contributing</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="create_framework/index.html">Create your own PHP Framework</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Symfony Framework Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Security</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/security.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="security">
<span id="index-0"></span><h1>Security<a class="headerlink" href="#security" title="Permalink to this headline">¶</a></h1>
<div class="screencast admonition">
<p class="first admonition-title">Screencast</p>
<p class="last">Do you prefer video tutorials? Check out the <a class="reference external" href="https://symfonycasts.com/screencast/symfony-security">Symfony Security screencast series</a>.</p>
</div>
<p>Symfony’s security system is incredibly powerful, but it can also be confusing
to set up. Don’t worry! In this article, you’ll learn how to set up your app’s
security system step-by-step:</p>
<ol class="arabic simple">
<li><a class="reference internal" href="#security-installation"><span class="std std-ref">Installing security support</span></a>;</li>
<li><a class="reference internal" href="#create-user-class"><span class="std std-ref">Create your User Class</span></a>;</li>
<li><a class="reference internal" href="#security-yaml-firewalls"><span class="std std-ref">Authentication &amp; Firewalls</span></a>;</li>
<li><a class="reference internal" href="#security-authorization"><span class="std std-ref">Denying access to your app (authorization)</span></a>;</li>
<li><a class="reference internal" href="#retrieving-the-user-object"><span class="std std-ref">Fetching the current User object</span></a>.</li>
</ol>
<p>A few other important topics are discussed after.</p>
<div class="section" id="installation">
<span id="security-installation"></span><h2>1) Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>In applications using <a class="reference internal" href="setup.html#symfony-flex"><span class="std std-ref">Symfony Flex</span></a>, run this command to
install the security feature before using it:</p>
<div class="highlight-terminal notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> composer require symfony/security-bundle
</pre></div>
</td></tr></table></div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>A <a class="reference internal" href="security/experimental_authenticators.html"><span class="doc">new experimental Security</span></a>
was introduced in Symfony 5.1, which will eventually replace security in
Symfony 6.0. This system is almost fully backwards compatible with the
current Symfony security, add this line to your security configuration to start
using it:</p>
<div class="last configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">enable_authenticator_manager</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="c1"># ...</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd</span>
<span class="s">        http://symfony.com/schema/dic/security</span>
<span class="s">        https://symfony.com/schema/dic/security/security-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config</span> <span class="na">enable-authenticator-manager=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;enable_authenticator_manager&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
    <span class="c1">// ...</span>
<span class="p">]);</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
</div>
</div>
<div class="section" id="a-create-your-user-class">
<span id="create-user-class"></span><span id="initial-security-yaml-setup-authentication"></span><span id="initial-security-yml-setup-authentication"></span><h2>2a) Create your User Class<a class="headerlink" href="#a-create-your-user-class" title="Permalink to this headline">¶</a></h2>
<p>No matter <em>how</em> you will authenticate (e.g. login form or API tokens) or <em>where</em>
your user data will be stored (database, single sign-on), the next step is always the same:
create a “User” class. The easiest way is to use the <a class="reference external" href="https://symfony.com/doc/current/bundles/SymfonyMakerBundle/index.html">MakerBundle</a>.</p>
<p>Let’s assume that you want to store your user data in the database with Doctrine:</p>
<div class="highlight-terminal notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> php bin/console make:user

<span class="go">The name of the security user class (e.g. User) [User]:</span>
<span class="gp">&gt;</span> User

<span class="go">Do you want to store user data in the database (via Doctrine)? (yes/no) [yes]:</span>
<span class="gp">&gt;</span> yes

<span class="go">Enter a property name that will be the unique &quot;display&quot; name for the user (e.g.</span>
<span class="go">email, username, uuid [email]</span>
<span class="gp">&gt;</span> email

<span class="go">Does this app need to hash/check user passwords? (yes/no) [yes]:</span>
<span class="gp">&gt;</span> yes

<span class="go">created: src/Entity/User.php</span>
<span class="go">created: src/Repository/UserRepository.php</span>
<span class="go">updated: src/Entity/User.php</span>
<span class="go">updated: config/packages/security.yaml</span>
</pre></div>
</td></tr></table></div>
<p>That’s it! The command asks several questions so that it can generate exactly what
you need. The most important is the <code class="docutils literal notranslate"><span class="pre">User.php</span></code> file itself. The <em>only</em> rule about
your <code class="docutils literal notranslate"><span class="pre">User</span></code> class is that it <em>must</em> implement <code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Security/Core/User/UserInterface.php" title="Symfony\Component\Security\Core\User\UserInterface"><span class="pre">UserInterface</span></a></code>.
Feel free to add <em>any</em> other fields or logic you need. If your <code class="docutils literal notranslate"><span class="pre">User</span></code> class is
an entity (like in this example), you can use the <a class="reference internal" href="doctrine.html#doctrine-add-more-fields"><span class="std std-ref">make:entity command</span></a>
to add more fields. Also, make sure to make and run a migration for the new entity:</p>
<div class="highlight-terminal notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> php bin/console make:migration
<span class="gp">$</span> php bin/console doctrine:migrations:migrate
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="b-the-user-provider">
<span id="where-do-users-come-from-user-providers"></span><span id="security-user-providers"></span><h2>2b) The “User Provider”<a class="headerlink" href="#b-the-user-provider" title="Permalink to this headline">¶</a></h2>
<p>In addition to your <code class="docutils literal notranslate"><span class="pre">User</span></code> class, you also need a “User provider”: a class that
helps with a few things, like reloading the User data from the session and some
optional features, like <a class="reference internal" href="security/remember_me.html"><span class="doc">remember me</span></a> and
<a class="reference internal" href="security/impersonating_user.html"><span class="doc">impersonation</span></a>.</p>
<p>Fortunately, the <code class="docutils literal notranslate"><span class="pre">make:user</span></code> command already configured one for you in your
<code class="docutils literal notranslate"><span class="pre">security.yaml</span></code> file under the <code class="docutils literal notranslate"><span class="pre">providers</span></code> key:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">providers</span><span class="p p-Indicator">:</span>
        <span class="c1"># used to reload user from session &amp; other features (e.g. switch_user)</span>
        <span class="l l-Scalar l-Scalar-Plain">app_user_provider</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">entity</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">class</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">App\Entity\User</span>
                <span class="l l-Scalar l-Scalar-Plain">property</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">email</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- used to reload user from session &amp; other features (e.g. switch-user) --&gt;</span>
        <span class="nt">&lt;provider</span> <span class="na">name=</span><span class="s">&quot;app_user_provider&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;entity</span> <span class="na">class=</span><span class="s">&quot;App\Entity\User&quot;</span> <span class="na">property=</span><span class="s">&quot;email&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/provider&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="k">use</span> <span class="nx">App\Entity\User</span><span class="p">;</span>

<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="c1">// ...</span>

    <span class="s1">&#39;providers&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="c1">// used to reload user from session &amp; other features (e.g. switch_user)</span>
        <span class="s1">&#39;app_user_provider&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;entity&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;class&#39;</span> <span class="o">=&gt;</span> <span class="nx">User</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
                <span class="s1">&#39;property&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;email&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
<p>If your <code class="docutils literal notranslate"><span class="pre">User</span></code> class is an entity, you don’t need to do anything else. But if
your class is <em>not</em> an entity, then <code class="docutils literal notranslate"><span class="pre">make:user</span></code> will also have generated a
<code class="docutils literal notranslate"><span class="pre">UserProvider</span></code> class that you need to finish. Learn more about user providers
here: <a class="reference internal" href="security/user_provider.html"><span class="doc">User Providers</span></a>.</p>
</div>
<div class="section" id="c-encoding-passwords">
<span id="encoding-the-user-s-password"></span><span id="security-encoding-user-password"></span><h2>2c) Encoding Passwords<a class="headerlink" href="#c-encoding-passwords" title="Permalink to this headline">¶</a></h2>
<p>Not all applications have “users” that need passwords. <em>If</em> your users have passwords,
you can control how those passwords are encoded in <code class="docutils literal notranslate"><span class="pre">security.yaml</span></code>. The <code class="docutils literal notranslate"><span class="pre">make:user</span></code>
command will pre-configure this for you:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">encoders</span><span class="p p-Indicator">:</span>
        <span class="c1"># use your user class name here</span>
        <span class="l l-Scalar l-Scalar-Plain">App\Entity\User</span><span class="p p-Indicator">:</span>
            <span class="c1"># Use native password encoder</span>
            <span class="c1"># This value auto-selects the best possible hashing algorithm</span>
            <span class="c1"># (i.e. Sodium when available).</span>
            <span class="l l-Scalar l-Scalar-Plain">algorithm</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">auto</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd</span>
<span class="s">        http://symfony.com/schema/dic/security</span>
<span class="s">        https://symfony.com/schema/dic/security/security-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>

        <span class="nt">&lt;encoder</span> <span class="na">class=</span><span class="s">&quot;App\Entity\User&quot;</span>
            <span class="na">algorithm=</span><span class="s">&quot;auto&quot;</span>
            <span class="na">cost=</span><span class="s">&quot;12&quot;</span><span class="nt">/&gt;</span>

        <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="k">use</span> <span class="nx">App\Entity\User</span><span class="p">;</span>

<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="c1">// ...</span>

    <span class="s1">&#39;encoders&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="nx">User</span><span class="o">::</span><span class="na">class</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;algorithm&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cost&#39;</span> <span class="o">=&gt;</span> <span class="mi">12</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">],</span>

    <span class="c1">// ...</span>
<span class="p">]);</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
<p>Now that Symfony knows <em>how</em> you want to encode the passwords, you can use the
<code class="docutils literal notranslate"><span class="pre">UserPasswordEncoderInterface</span></code> service to do this before saving your users to
the database.</p>
<p id="user-data-fixture">For example, by using <a class="reference internal" href="testing/database.html#doctrine-fixtures"><span class="std std-ref">DoctrineFixturesBundle</span></a>, you can
create dummy database users:</p>
<div class="highlight-terminal notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> php bin/console make:fixtures

<span class="go">The class name of the fixtures to create (e.g. AppFixtures):</span>
<span class="gp">&gt;</span> UserFixtures
</pre></div>
</td></tr></table></div>
<p>Use this service to encode the passwords:</p>
<div class="highlight-diff notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span>// src/DataFixtures/UserFixtures.php

<span class="gi">+ use Symfony\Component\Security\Core\Encoder\UserPasswordEncoderInterface;</span>
// ...

class UserFixtures extends Fixture
{
<span class="gi">+     private $passwordEncoder;</span>

<span class="gi">+     public function __construct(UserPasswordEncoderInterface $passwordEncoder)</span>
<span class="gi">+     {</span>
<span class="gi">+         $this-&gt;passwordEncoder = $passwordEncoder;</span>
<span class="gi">+     }</span>

    public function load(ObjectManager $manager)
    {
        $user = new User();
        // ...

<span class="gi">+         $user-&gt;setPassword($this-&gt;passwordEncoder-&gt;encodePassword(</span>
<span class="gi">+             $user,</span>
<span class="gi">+             &#39;the_new_password&#39;</span>
<span class="gi">+         ));</span>

        // ...
    }
}
</pre></div>
</td></tr></table></div>
<p>You can manually encode a password by running:</p>
<div class="highlight-terminal notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> php bin/console security:encode-password
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="a-authentication-firewalls">
<span id="firewalls-authentication"></span><span id="security-firewalls"></span><span id="security-yaml-firewalls"></span><h2>3a) Authentication &amp; Firewalls<a class="headerlink" href="#a-authentication-firewalls" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 5.1: </span>The <code class="docutils literal notranslate"><span class="pre">lazy:</span> <span class="pre">true</span></code> option was introduced in Symfony 5.1. Prior to version 5.1,
it was enabled using <code class="docutils literal notranslate"><span class="pre">anonymous:</span> <span class="pre">lazy</span></code></p>
</div>
<p>The security system is configured in <code class="docutils literal notranslate"><span class="pre">config/packages/security.yaml</span></code>. The <em>most</em>
important section is <code class="docutils literal notranslate"><span class="pre">firewalls</span></code>:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">firewalls</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">dev</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">pattern</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">^/(_(profiler|wdt)|css|images|js)/</span>
            <span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
        <span class="l l-Scalar l-Scalar-Plain">main</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">anonymous</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
            <span class="l l-Scalar l-Scalar-Plain">lazy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd</span>
<span class="s">        http://symfony.com/schema/dic/security</span>
<span class="s">        https://symfony.com/schema/dic/security/security-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="nt">&lt;firewall</span> <span class="na">name=</span><span class="s">&quot;dev&quot;</span>
            <span class="na">pattern=</span><span class="s">&quot;^/(_(profiler|wdt)|css|images|js)/&quot;</span>
            <span class="na">security=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;firewall</span> <span class="na">name=</span><span class="s">&quot;main&quot;</span>
            <span class="na">anonymous=</span><span class="s">&quot;true&quot;</span>
            <span class="na">lazy=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/firewall&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;firewalls&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;dev&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;pattern&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/(_(profiler|wdt)|css|images|js)/&#39;</span><span class="p">,</span>
            <span class="s1">&#39;security&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s1">&#39;main&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;anonymous&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
            <span class="s1">&#39;lazy&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
<p>A “firewall” is your authentication system: the configuration below it defines
<em>how</em> your users will be able to authenticate (e.g. login form, API token, etc).</p>
<p>Only one firewall is active on each request: Symfony uses the <code class="docutils literal notranslate"><span class="pre">pattern</span></code> key
to find the first match (you can also <a class="reference internal" href="security/firewall_restriction.html"><span class="doc">match by host or other things</span></a>).
The <code class="docutils literal notranslate"><span class="pre">dev</span></code> firewall is really a fake firewall: it makes sure that you don’t
accidentally block Symfony’s dev tools - which live under URLs like <code class="docutils literal notranslate"><span class="pre">/_profiler</span></code>
and <code class="docutils literal notranslate"><span class="pre">/_wdt</span></code>.</p>
<p>All <em>real</em> URLs are handled by the <code class="docutils literal notranslate"><span class="pre">main</span></code> firewall (no <code class="docutils literal notranslate"><span class="pre">pattern</span></code> key means
it matches <em>all</em> URLs). A firewall can have many modes of authentication,
in other words many ways to ask the question “Who are you?”. Often, the
user is unknown (i.e. not logged in) when they first visit your website. The
<code class="docutils literal notranslate"><span class="pre">anonymous</span></code> mode, if enabled, is used for these requests.</p>
<p>In fact, if you go to the homepage right now, you <em>will</em> have access and you’ll
see that you’re “authenticated” as <code class="docutils literal notranslate"><span class="pre">anon.</span></code>. The firewall verified that it
does not know your identity, and so, you are anonymous:</p>
<img alt="_images/anonymous_wdt.png" class="align-center" src="_images/anonymous_wdt.png" />
<p>It means any request can have an anonymous token to access some resource,
while some actions (i.e. some pages or buttons) can still require specific
privileges. A user can then access a form login without being authenticated
as a unique user (otherwise an infinite redirection loop would happen
asking the user to authenticate while trying to doing so).</p>
<p>You’ll learn later how to deny access to certain URLs, controllers, or part of
templates.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">lazy</span></code> anonymous mode prevents the session from being started if
there is no need for authorization (i.e. explicit check for a user
privilege). This is important to keep requests cacheable (see
<a class="reference internal" href="http_cache.html"><span class="doc">HTTP Cache</span></a>).</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you do not see the toolbar, install the <a class="reference internal" href="profiler.html"><span class="doc">profiler</span></a> with:</p>
<div class="last highlight-terminal notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> composer require --dev symfony/profiler-pack
</pre></div>
</td></tr></table></div>
</div>
<p>Now that we understand our firewall, the next step is to create a way for your
users to authenticate!</p>
</div>
<div class="section" id="b-authenticating-your-users">
<span id="security-form-login"></span><h2>3b) Authenticating your Users<a class="headerlink" href="#b-authenticating-your-users" title="Permalink to this headline">¶</a></h2>
<p>Authentication in Symfony can feel a bit “magic” at first. That’s because, instead
of building a route &amp; controller to handle login, you’ll activate an
<em>authentication provider</em>: some code that runs automatically <em>before</em> your controller
is called.</p>
<p>Symfony has several <a class="reference internal" href="security/auth_providers.html"><span class="doc">built-in authentication providers</span></a>.
If your use-case matches one of these <em>exactly</em>, great! But, in most cases - including
a login form - <em>we recommend building a Guard Authenticator</em>: a class that allows
you to control <em>every</em> part of the authentication process (see the next section).</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">If your application logs users in via a third-party service such as Google,
Facebook or Twitter (social login), check out the <a class="reference external" href="https://github.com/hwi/HWIOAuthBundle">HWIOAuthBundle</a> community
bundle.</p>
</div>
<div class="section" id="guard-authenticators">
<h3>Guard Authenticators<a class="headerlink" href="#guard-authenticators" title="Permalink to this headline">¶</a></h3>
<p>A Guard authenticator is a class that gives you <em>complete</em> control over your
authentication process. There are many different ways to build an authenticator;
here are a few common use-cases:</p>
<ul class="simple">
<li><a class="reference internal" href="security/form_login_setup.html"><span class="doc">How to Build a Login Form</span></a></li>
<li><a class="reference internal" href="security/guard_authentication.html"><span class="doc">Custom Authentication System with Guard (API Token Example)</span></a> – see this for the most detailed
description of authenticators and how they work</li>
</ul>
</div>
</div>
<div class="section" id="denying-access-roles-and-other-authorization">
<span id="security-authorization"></span><span id="id1"></span><h2>4) Denying Access, Roles and other Authorization<a class="headerlink" href="#denying-access-roles-and-other-authorization" title="Permalink to this headline">¶</a></h2>
<p>Users can now log in to your app using your login form. Great! Now, you need to learn
how to deny access and work with the User object. This is called <strong>authorization</strong>,
and its job is to decide if a user can access some resource (a URL, a model object,
a method call, …).</p>
<p>The process of authorization has two different sides:</p>
<ol class="arabic simple">
<li>The user receives a specific set of roles when logging in (e.g. <code class="docutils literal notranslate"><span class="pre">ROLE_ADMIN</span></code>).</li>
<li>You add code so that a resource (e.g. URL, controller) requires a specific
“attribute” (most commonly a role like <code class="docutils literal notranslate"><span class="pre">ROLE_ADMIN</span></code>) in order to be
accessed.</li>
</ol>
<div class="section" id="roles">
<h3>Roles<a class="headerlink" href="#roles" title="Permalink to this headline">¶</a></h3>
<p>When a user logs in, Symfony calls the <code class="docutils literal notranslate"><span class="pre">getRoles()</span></code> method on your <code class="docutils literal notranslate"><span class="pre">User</span></code>
object to determine which roles this user has. In the <code class="docutils literal notranslate"><span class="pre">User</span></code> class that we
generated earlier, the roles are an array that’s stored in the database, and
every user is <em>always</em> given at least one role: <code class="docutils literal notranslate"><span class="pre">ROLE_USER</span></code>:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Entity/User.php</span>

<span class="c1">// ...</span>
<span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @ORM\Column(type=&quot;json&quot;)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$roles</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="c1">// ...</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getRoles</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="nv">$roles</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">roles</span><span class="p">;</span>
        <span class="c1">// guarantee every user at least has ROLE_USER</span>
        <span class="nv">$roles</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">&#39;ROLE_USER&#39;</span><span class="p">;</span>

        <span class="k">return</span> <span class="nb">array_unique</span><span class="p">(</span><span class="nv">$roles</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is a nice default, but you can do <em>whatever</em> you want to determine which roles
a user should have. Here are a few guidelines:</p>
<ul class="simple">
<li>Every role <strong>must start with</strong> <code class="docutils literal notranslate"><span class="pre">ROLE_</span></code> (otherwise, things won’t work as expected)</li>
<li>Other than the above rule, a role is just a string and you can invent what you
need (e.g. <code class="docutils literal notranslate"><span class="pre">ROLE_PRODUCT_ADMIN</span></code>).</li>
</ul>
<p>You’ll use these roles next to grant access to specific sections of your site.
You can also use a <a class="reference internal" href="#security-role-hierarchy"><span class="std std-ref">role hierarchy</span></a> where having
some roles automatically give you other roles.</p>
</div>
<div class="section" id="add-code-to-deny-access">
<span id="security-role-authorization"></span><h3>Add Code to Deny Access<a class="headerlink" href="#add-code-to-deny-access" title="Permalink to this headline">¶</a></h3>
<p>There are <strong>two</strong> ways to deny access to something:</p>
<ol class="arabic simple">
<li><a class="reference internal" href="#security-authorization-access-control"><span class="std std-ref">access_control in security.yaml</span></a>
allows you to protect URL patterns (e.g. <code class="docutils literal notranslate"><span class="pre">/admin/*</span></code>). Simpler, but less flexible;</li>
<li><a class="reference internal" href="#security-securing-controller"><span class="std std-ref">in your controller (or other code)</span></a>.</li>
</ol>
<div class="section" id="securing-url-patterns-access-control">
<span id="security-authorization-access-control"></span><h4>Securing URL patterns (access_control)<a class="headerlink" href="#securing-url-patterns-access-control" title="Permalink to this headline">¶</a></h4>
<p>The most basic way to secure part of your app is to secure an entire URL pattern
in <code class="docutils literal notranslate"><span class="pre">security.yaml</span></code>. For example, to require <code class="docutils literal notranslate"><span class="pre">ROLE_ADMIN</span></code> for all URLs that
start with <code class="docutils literal notranslate"><span class="pre">/admin</span></code>, you can:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">firewalls</span><span class="p p-Indicator">:</span>
        <span class="c1"># ...</span>
        <span class="l l-Scalar l-Scalar-Plain">main</span><span class="p p-Indicator">:</span>
            <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">access_control</span><span class="p p-Indicator">:</span>
        <span class="c1"># require ROLE_ADMIN for /admin*</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="s">&#39;^/admin&#39;</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">ROLE_ADMIN</span> <span class="p p-Indicator">}</span>

        <span class="c1"># or require ROLE_ADMIN or IS_AUTHENTICATED_FULLY for /admin*</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="s">&#39;^/admin&#39;</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">IS_AUTHENTICATED_FULLY</span><span class="p p-Indicator">,</span> <span class="nv">ROLE_ADMIN</span><span class="p p-Indicator">]</span> <span class="p p-Indicator">}</span>

        <span class="c1"># the &#39;path&#39; value can be any valid regular expression</span>
        <span class="c1"># (this one will match URLs like /api/post/7298 and /api/comment/528491)</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="nv">^/api/(post|comment)/\d+$</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">ROLE_USER</span> <span class="p p-Indicator">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd</span>
<span class="s">        http://symfony.com/schema/dic/security</span>
<span class="s">        https://symfony.com/schema/dic/security/security-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>

        <span class="nt">&lt;firewall</span> <span class="na">name=</span><span class="s">&quot;main&quot;</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- ... --&gt;</span>
        <span class="nt">&lt;/firewall&gt;</span>

        <span class="c">&lt;!-- require ROLE_ADMIN for /admin* --&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/admin&quot;</span> <span class="na">role=</span><span class="s">&quot;ROLE_ADMIN&quot;</span><span class="nt">/&gt;</span>

        <span class="c">&lt;!-- require ROLE_ADMIN or IS_AUTHENTICATED_FULLY for /admin* --&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/admin&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;role&gt;</span>ROLE_ADMIN<span class="nt">&lt;/role&gt;</span>
            <span class="nt">&lt;role&gt;</span>IS_AUTHENTICATED_FULLY<span class="nt">&lt;/role&gt;</span>
        <span class="nt">&lt;/rule&gt;</span>

        <span class="c">&lt;!-- the &#39;path&#39; value can be any valid regular expression</span>
<span class="c">             (this one will match URLs like /api/post/7298 and /api/comment/528491) --&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/api/(post|comment)/\d+$&quot;</span> <span class="na">role=</span><span class="s">&quot;ROLE_USER&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="c1">// ...</span>

    <span class="s1">&#39;firewalls&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="c1">// ...</span>
        <span class="s1">&#39;main&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="c1">// ...</span>
        <span class="p">],</span>
    <span class="p">],</span>
    <span class="s1">&#39;access_control&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="c1">// require ROLE_ADMIN for /admin*</span>
        <span class="p">[</span><span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/admin&#39;</span><span class="p">,</span> <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">],</span>

        <span class="c1">// require ROLE_ADMIN or IS_AUTHENTICATED_FULLY for /admin*</span>
        <span class="p">[</span><span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/admin&#39;</span><span class="p">,</span> <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_AUTHENTICATED_FULLY&#39;</span><span class="p">]],</span>

        <span class="c1">// the &#39;path&#39; value can be any valid regular expression</span>
        <span class="c1">// (this one will match URLs like /api/post/7298 and /api/comment/528491)</span>
        <span class="p">[</span><span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/api/(post|comment)/\d+$&#39;</span><span class="p">,</span> <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_USER&#39;</span><span class="p">],</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
<p>You can define as many URL patterns as you need - each is a regular expression.
<strong>BUT</strong>, only <strong>one</strong> will be matched per request: Symfony starts at the top of
the list and stops when it finds the first match:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">access_control</span><span class="p p-Indicator">:</span>
        <span class="c1"># matches /admin/users/*</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="s">&#39;^/admin/users&#39;</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">ROLE_SUPER_ADMIN</span> <span class="p p-Indicator">}</span>

        <span class="c1"># matches /admin/* except for anything matching the above rule</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="s">&#39;^/admin&#39;</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">ROLE_ADMIN</span> <span class="p p-Indicator">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd</span>
<span class="s">        http://symfony.com/schema/dic/security</span>
<span class="s">        https://symfony.com/schema/dic/security/security-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>

        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/admin/users&quot;</span> <span class="na">role=</span><span class="s">&quot;ROLE_SUPER_ADMIN&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/admin&quot;</span> <span class="na">role=</span><span class="s">&quot;ROLE_ADMIN&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="c1">// ...</span>

    <span class="s1">&#39;access_control&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/admin/users&#39;</span><span class="p">,</span> <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_SUPER_ADMIN&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/admin&#39;</span><span class="p">,</span> <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">],</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
<p>Prepending the path with <code class="docutils literal notranslate"><span class="pre">^</span></code> means that only URLs <em>beginning</em> with the
pattern are matched. For example, a path of <code class="docutils literal notranslate"><span class="pre">/admin</span></code> (without the <code class="docutils literal notranslate"><span class="pre">^</span></code>)
would match <code class="docutils literal notranslate"><span class="pre">/admin/foo</span></code> but would also match URLs like <code class="docutils literal notranslate"><span class="pre">/foo/admin</span></code>.</p>
<p>Each <code class="docutils literal notranslate"><span class="pre">access_control</span></code> can also match on IP address, hostname and HTTP methods.
It can also be used to redirect a user to the <code class="docutils literal notranslate"><span class="pre">https</span></code> version of a URL pattern.
See <a class="reference internal" href="security/access_control.html"><span class="doc">How Does the Security access_control Work?</span></a>.</p>
</div>
<div class="section" id="securing-controllers-and-other-code">
<span id="security-securing-controller"></span><h4>Securing Controllers and other Code<a class="headerlink" href="#securing-controllers-and-other-code" title="Permalink to this headline">¶</a></h4>
<p>You can deny access from inside a controller:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Controller/AdminController.php</span>
<span class="c1">// ...</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">adminDashboard</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">denyAccessUnlessGranted</span><span class="p">(</span><span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">);</span>

    <span class="c1">// or add an optional message - seen by developers</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">denyAccessUnlessGranted</span><span class="p">(</span><span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="s1">&#39;User tried to access a page without having ROLE_ADMIN&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>That’s it! If access is not granted, a special
<code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Security/Core/Exception/AccessDeniedException.php" title="Symfony\Component\Security\Core\Exception\AccessDeniedException"><span class="pre">AccessDeniedException</span></a></code>
is thrown and no more code in your controller is called. Then, one of two things
will happen:</p>
<ol class="arabic simple">
<li>If the user isn’t logged in yet, they will be asked to log in (e.g. redirected
to the login page).</li>
<li>If the user <em>is</em> logged in, but does <em>not</em> have the <code class="docutils literal notranslate"><span class="pre">ROLE_ADMIN</span></code> role, they’ll
be shown the 403 access denied page (which you can
<a class="reference internal" href="controller/error_pages.html#controller-error-pages-by-status-code"><span class="std std-ref">customize</span></a>).</li>
</ol>
<p id="security-securing-controller-annotations">Thanks to the SensioFrameworkExtraBundle, you can also secure your controller
using annotations:</p>
<div class="highlight-diff notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span>// src/Controller/AdminController.php
// ...

<span class="gi">+ use Sensio\Bundle\FrameworkExtraBundle\Configuration\IsGranted;</span>

<span class="gi">+ /**</span>
<span class="gi">+  * Require ROLE_ADMIN for *every* controller method in this class.</span>
<span class="gi">+  *</span>
<span class="gi">+  * @IsGranted(&quot;ROLE_ADMIN&quot;)</span>
<span class="gi">+  */</span>
class AdminController extends AbstractController
{
<span class="gi">+     /**</span>
<span class="gi">+      * Require ROLE_ADMIN for only this controller method.</span>
<span class="gi">+      *</span>
<span class="gi">+      * @IsGranted(&quot;ROLE_ADMIN&quot;)</span>
<span class="gi">+      */</span>
    public function adminDashboard()
    {
        // ...
    }
}
</pre></div>
</td></tr></table></div>
<p>For more information, see the <a class="reference external" href="https://symfony.com/doc/current/bundles/SensioFrameworkExtraBundle/index.html">FrameworkExtraBundle documentation</a>.</p>
</div>
<div class="section" id="access-control-in-templates">
<span id="security-template"></span><h4>Access Control in Templates<a class="headerlink" href="#access-control-in-templates" title="Permalink to this headline">¶</a></h4>
<p>If you want to check if the current user has a certain role, you can use
the built-in <code class="docutils literal notranslate"><span class="pre">is_granted()</span></code> helper function in any Twig template:</p>
<div class="highlight-html+twig notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">is_granted</span><span class="o">(</span><span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="o">)</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;...&quot;</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="securing-other-services">
<h4>Securing other Services<a class="headerlink" href="#securing-other-services" title="Permalink to this headline">¶</a></h4>
<p>See <a class="reference internal" href="security/securing_services.html"><span class="doc">How to Secure any Service or Method in your Application</span></a>.</p>
</div>
</div>
<div class="section" id="setting-individual-user-permissions">
<h3>Setting Individual User Permissions<a class="headerlink" href="#setting-individual-user-permissions" title="Permalink to this headline">¶</a></h3>
<p>Most applications require more specific access rules. For instance, a user
should be able to only edit their <em>own</em> comments on a blog. Voters allow you
to write <em>whatever</em> business logic you need to determine access. Using
these voters is similar to the role-based access checks implemented in the
previous chapters. Read <a class="reference internal" href="security/voters.html"><span class="doc">How to Use Voters to Check User Permissions</span></a> to learn how to implement
your own voter.</p>
</div>
<div class="section" id="checking-to-see-if-a-user-is-logged-in-is-authenticated-fully">
<h3>Checking to see if a User is Logged In (IS_AUTHENTICATED_FULLY)<a class="headerlink" href="#checking-to-see-if-a-user-is-logged-in-is-authenticated-fully" title="Permalink to this headline">¶</a></h3>
<p>If you <em>only</em> want to check if a user is logged in (you don’t care about roles),
you have two options. First, if you’ve given <em>every</em> user <code class="docutils literal notranslate"><span class="pre">ROLE_USER</span></code>, you can
check for that role. Otherwise, you can use a special “attribute” in place of a
role:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// ...</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">adminDashboard</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">denyAccessUnlessGranted</span><span class="p">(</span><span class="s1">&#39;IS_AUTHENTICATED_FULLY&#39;</span><span class="p">);</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can use <code class="docutils literal notranslate"><span class="pre">IS_AUTHENTICATED_FULLY</span></code> anywhere roles are used: like
<code class="docutils literal notranslate"><span class="pre">access_control</span></code> or in Twig.</p>
<p><code class="docutils literal notranslate"><span class="pre">IS_AUTHENTICATED_FULLY</span></code> isn’t a role, but it kind of acts like one, and every
user that has logged in will have this. Actually, there are some special attributes
like this:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">IS_AUTHENTICATED_REMEMBERED</span></code>: <em>All</em> logged in users have this, even
if they are logged in because of a “remember me cookie”. Even if you don’t
use the <a class="reference internal" href="security/remember_me.html"><span class="doc">remember me functionality</span></a>,
you can use this to check if the user is logged in.</li>
<li><code class="docutils literal notranslate"><span class="pre">IS_AUTHENTICATED_FULLY</span></code>: This is similar to <code class="docutils literal notranslate"><span class="pre">IS_AUTHENTICATED_REMEMBERED</span></code>,
but stronger. Users who are logged in only because of a “remember me cookie”
will have <code class="docutils literal notranslate"><span class="pre">IS_AUTHENTICATED_REMEMBERED</span></code> but will not have <code class="docutils literal notranslate"><span class="pre">IS_AUTHENTICATED_FULLY</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">IS_AUTHENTICATED_ANONYMOUSLY</span></code>: <em>All</em> users (even anonymous ones) have
this - this is useful when <em>whitelisting</em> URLs to guarantee access - some
details are in <a class="reference internal" href="security/access_control.html"><span class="doc">How Does the Security access_control Work?</span></a>.</li>
<li><code class="docutils literal notranslate"><span class="pre">IS_ANONYMOUS</span></code>: <em>Only</em> anonymous users are matched by this attribute.</li>
<li><code class="docutils literal notranslate"><span class="pre">IS_REMEMBERED</span></code>: <em>Only</em> users authenticated using the
<a class="reference internal" href="security/remember_me.html"><span class="doc">remember me functionality</span></a>, (i.e. a
remember-me cookie).</li>
<li><code class="docutils literal notranslate"><span class="pre">IS_IMPERSONATOR</span></code>: When the current user is
<a class="reference internal" href="security/impersonating_user.html"><span class="doc">impersonating</span></a> another user in this
session, this attribute will match.</li>
</ul>
<div class="versionadded">
<p><span class="versionmodified">New in version 5.1: </span>The <code class="docutils literal notranslate"><span class="pre">IS_ANONYMOUS</span></code>, <code class="docutils literal notranslate"><span class="pre">IS_REMEMBERED</span></code> and <code class="docutils literal notranslate"><span class="pre">IS_IMPERSONATOR</span></code>
attributes were introduced in Symfony 5.1.</p>
</div>
</div>
</div>
<div class="section" id="a-fetching-the-user-object">
<span id="retrieving-the-user-object"></span><h2>5a) Fetching the User Object<a class="headerlink" href="#a-fetching-the-user-object" title="Permalink to this headline">¶</a></h2>
<p>After authentication, the <code class="docutils literal notranslate"><span class="pre">User</span></code> object of the current user can be accessed
via the <code class="docutils literal notranslate"><span class="pre">getUser()</span></code> shortcut:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// usually you&#39;ll want to make sure the user is authenticated first</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">denyAccessUnlessGranted</span><span class="p">(</span><span class="s1">&#39;IS_AUTHENTICATED_FULLY&#39;</span><span class="p">);</span>

    <span class="c1">// returns your User object, or null if the user is not authenticated</span>
    <span class="c1">// use inline documentation to tell your editor your exact User class</span>
    <span class="sd">/** @var \App\Entity\User $user */</span>
    <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>

    <span class="c1">// Call whatever methods you&#39;ve added to your User class</span>
    <span class="c1">// For example, if you added a getFirstName() method, you can use that.</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;Well hi there &#39;</span><span class="o">.</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getFirstName</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="b-fetching-the-user-from-a-service">
<h2>5b) Fetching the User from a Service<a class="headerlink" href="#b-fetching-the-user-from-a-service" title="Permalink to this headline">¶</a></h2>
<p>If you need to get the logged in user from a service, use the
<code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Security/Core/Security.php" title="Symfony\Component\Security\Core\Security"><span class="pre">Security</span></a></code> service:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/Service/ExampleService.php</span>
<span class="c1">// ...</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Security\Core\Security</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExampleService</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$security</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Security</span> <span class="nv">$security</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Avoid calling getUser() in the constructor: auth may not</span>
        <span class="c1">// be complete yet. Instead, store the entire Security object.</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">security</span> <span class="o">=</span> <span class="nv">$security</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">someMethod</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// returns User object or null if not authenticated</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">security</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="fetch-the-user-in-a-template">
<h3>Fetch the User in a Template<a class="headerlink" href="#fetch-the-user-in-a-template" title="Permalink to this headline">¶</a></h3>
<p>In a Twig Template the user object is available via the <code class="docutils literal notranslate"><span class="pre">app.user</span></code> variable
thanks to the <a class="reference internal" href="templates.html#twig-app-variable"><span class="std std-ref">Twig global app variable</span></a>:</p>
<div class="highlight-html+twig notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">is_granted</span><span class="o">(</span><span class="s1">&#39;IS_AUTHENTICATED_FULLY&#39;</span><span class="o">)</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Email: <span class="cp">{{</span> <span class="nv">app.user.email</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="logging-out">
<span id="security-logging-out"></span><h2>Logging Out<a class="headerlink" href="#logging-out" title="Permalink to this headline">¶</a></h2>
<p>To enable logging out, activate the  <code class="docutils literal notranslate"><span class="pre">logout</span></code> config parameter under your firewall:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">firewalls</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">main</span><span class="p p-Indicator">:</span>
            <span class="c1"># ...</span>
            <span class="l l-Scalar l-Scalar-Plain">logout</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span>   <span class="l l-Scalar l-Scalar-Plain">app_logout</span>

                <span class="c1"># where to redirect after logout</span>
                <span class="c1"># target: app_any_route</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd</span>
<span class="s">        http://symfony.com/schema/dic/security</span>
<span class="s">        https://symfony.com/schema/dic/security/security-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>

        <span class="nt">&lt;firewall</span> <span class="na">name=</span><span class="s">&quot;secured_area&quot;</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- ... --&gt;</span>
            <span class="nt">&lt;logout</span> <span class="na">path=</span><span class="s">&quot;app_logout&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/firewall&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="c1">// ...</span>

    <span class="s1">&#39;firewalls&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;secured_area&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="c1">// ...</span>
            <span class="s1">&#39;logout&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;app_logout&#39;</span><span class="p">],</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
<p>Next, you’ll need to create a route for this URL (but not a controller):</p>
<div class="configuration-block">
<ul class="simple">
<li><em>Annotations</em><div class="highlight-php-annotations notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/Controller/SecurityController.php</span>
<span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SecurityController</span> <span class="k">extends</span> <span class="nx">AbstractController</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @Route(&quot;/logout&quot;, name=&quot;app_logout&quot;, methods={&quot;GET&quot;})</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">logout</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// controller can be blank: it will never be executed!</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">\Exception</span><span class="p">(</span><span class="s1">&#39;Don\&#39;t forget to activate logout in security.yaml&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/routes.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">app_logout</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/logout</span>
    <span class="l l-Scalar l-Scalar-Plain">methods</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">GET</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/routes.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;routes</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/routing&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/routing</span>
<span class="s">        https://symfony.com/schema/routing/routing-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;route</span> <span class="na">id=</span><span class="s">&quot;app_logout&quot;</span> <span class="na">path=</span><span class="s">&quot;/logout&quot;</span> <span class="na">methods=</span><span class="s">&quot;GET&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/routes&gt;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/routes.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Loader\Configurator\RoutingConfigurator</span><span class="p">;</span>

<span class="k">return</span> <span class="k">function</span> <span class="p">(</span><span class="nx">RoutingConfigurator</span> <span class="nv">$routes</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;app_logout&#39;</span><span class="p">,</span> <span class="s1">&#39;/logout&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">methods</span><span class="p">([</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
    <span class="p">;</span>
<span class="p">};</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
<p>And that’s it! By sending a user to the <code class="docutils literal notranslate"><span class="pre">app_logout</span></code> route (i.e. to <code class="docutils literal notranslate"><span class="pre">/logout</span></code>)
Symfony will un-authenticate the current user and redirect them.</p>
<div class="section" id="customizing-logout">
<h3>Customizing Logout<a class="headerlink" href="#customizing-logout" title="Permalink to this headline">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified">New in version 5.1: </span>The <code class="docutils literal notranslate"><span class="pre">LogoutEvent</span></code> was introduced in Symfony 5.1. Prior to this
version, you had to use a
<a class="reference internal" href="reference/configuration/security.html#reference-security-logout-success-handler"><span class="std std-ref">logout success handler</span></a>
to customize the logout.</p>
</div>
<p>In some cases you need to execute extra logic upon logout (e.g. invalidate
some tokens) or want to customize what happens after a logout. During
logout, a <code class="docutils literal notranslate"><a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Security/Http/Event/LogoutEvent.php" title="Symfony\Component\Security\Http\Event\LogoutEvent"><span class="pre">LogoutEvent</span></a></code>
is dispatched. Register an <a class="reference internal" href="event_dispatcher.html"><span class="doc">event listener or subscriber</span></a>
to execute custom logic. The following information is available in the
event class:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">getToken()</span></code></dt>
<dd>Returns the security token of the session that is about to be logged
out.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">getRequest()</span></code></dt>
<dd>Returns the current request.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">getResponse()</span></code></dt>
<dd>Returns a response, if it is already set by a custom listener. Use
<code class="docutils literal notranslate"><span class="pre">setResponse()</span></code> to configure a custom logout response.</dd>
</dl>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Every Security firewall has its own event dispatcher
(<code class="docutils literal notranslate"><span class="pre">security.event_dispatcher.FIREWALLNAME</span></code>). The logout event is
dispatched on both the global and firewall dispatcher. You can register
on the firewall dispatcher if you want your listener to only be
executed for a specific firewall. For instance, if you have an <code class="docutils literal notranslate"><span class="pre">api</span></code>
and <code class="docutils literal notranslate"><span class="pre">main</span></code> firewall, use this configuration to register only on the
logout event in the <code class="docutils literal notranslate"><span class="pre">main</span></code> firewall:</p>
<div class="last configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/services.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">services</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">App\EventListener\CustomLogoutSubscriber</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">tags</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">kernel.event_subscriber</span>
              <span class="l l-Scalar l-Scalar-Plain">dispatcher</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">security.event_dispatcher.main</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/services.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;services&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>

        <span class="nt">&lt;service</span> <span class="na">id=</span><span class="s">&quot;App\EventListener\CustomLogoutSubscriber&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;tag</span> <span class="na">name=</span><span class="s">&quot;kernel.event_subscriber&quot;</span>
                 <span class="na">dispacher=</span><span class="s">&quot;security.event_dispatcher.main&quot;</span>
             <span class="nt">/&gt;</span>
        <span class="nt">&lt;/service&gt;</span>
    <span class="nt">&lt;/services&gt;</span>
<span class="nt">&lt;/container&gt;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/services.php</span>
<span class="k">namespace</span> <span class="nx">Symfony\Component\DependencyInjection\Loader\Configurator</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\EventListener\CustomLogoutListener</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\EventListener\CustomLogoutSubscriber</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Security\Http\Event\LogoutEvent</span><span class="p">;</span>

<span class="k">return</span> <span class="k">function</span><span class="p">(</span><span class="nx">ContainerConfigurator</span> <span class="nv">$configurator</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$services</span> <span class="o">=</span> <span class="nv">$configurator</span><span class="o">-&gt;</span><span class="na">services</span><span class="p">();</span>

    <span class="nv">$services</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="nx">CustomLogoutSubscriber</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">tag</span><span class="p">(</span><span class="s1">&#39;kernel.event_subscriber&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;dispatcher&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;security.event_dispatcher.main&#39;</span><span class="p">,</span>
        <span class="p">]);</span>
<span class="p">};</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="section" id="hierarchical-roles">
<span id="security-role-hierarchy"></span><h2>Hierarchical Roles<a class="headerlink" href="#hierarchical-roles" title="Permalink to this headline">¶</a></h2>
<p>Instead of giving many roles to each user, you can define role inheritance
rules by creating a role hierarchy:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">role_hierarchy</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">ROLE_ADMIN</span><span class="p p-Indicator">:</span>       <span class="l l-Scalar l-Scalar-Plain">ROLE_USER</span>
        <span class="l l-Scalar l-Scalar-Plain">ROLE_SUPER_ADMIN</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">ROLE_ADMIN</span><span class="p p-Indicator">,</span> <span class="nv">ROLE_ALLOWED_TO_SWITCH</span><span class="p p-Indicator">]</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>XML</em><div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        https://symfony.com/schema/dic/services/services-1.0.xsd</span>
<span class="s">        http://symfony.com/schema/dic/security</span>
<span class="s">        https://symfony.com/schema/dic/security/security-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>

        <span class="nt">&lt;role</span> <span class="na">id=</span><span class="s">&quot;ROLE_ADMIN&quot;</span><span class="nt">&gt;</span>ROLE_USER<span class="nt">&lt;/role&gt;</span>
        <span class="nt">&lt;role</span> <span class="na">id=</span><span class="s">&quot;ROLE_SUPER_ADMIN&quot;</span><span class="nt">&gt;</span>ROLE_ADMIN, ROLE_ALLOWED_TO_SWITCH<span class="nt">&lt;/role&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><em>PHP</em><div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="c1">// ...</span>

    <span class="s1">&#39;role_hierarchy&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;ROLE_ADMIN&#39;</span>       <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_USER&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ROLE_SUPER_ADMIN&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ROLE_ALLOWED_TO_SWITCH&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
<p>Users with the <code class="docutils literal notranslate"><span class="pre">ROLE_ADMIN</span></code> role will also have the
<code class="docutils literal notranslate"><span class="pre">ROLE_USER</span></code> role. And users with <code class="docutils literal notranslate"><span class="pre">ROLE_SUPER_ADMIN</span></code>, will automatically have
<code class="docutils literal notranslate"><span class="pre">ROLE_ADMIN</span></code>, <code class="docutils literal notranslate"><span class="pre">ROLE_ALLOWED_TO_SWITCH</span></code> and <code class="docutils literal notranslate"><span class="pre">ROLE_USER</span></code> (inherited from <code class="docutils literal notranslate"><span class="pre">ROLE_ADMIN</span></code>).</p>
<p>For role hierarchy to work, do not try to call <code class="docutils literal notranslate"><span class="pre">$user-&gt;getRoles()</span></code> manually.
For example, in a controller extending from the <a class="reference internal" href="controller.html#the-base-controller-class-services"><span class="std std-ref">base controller</span></a>:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// BAD - $user-&gt;getRoles() will not know about the role hierarchy</span>
<span class="nv">$hasAccess</span> <span class="o">=</span> <span class="nb">in_array</span><span class="p">(</span><span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">,</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getRoles</span><span class="p">());</span>

<span class="c1">// GOOD - use of the normal security methods</span>
<span class="nv">$hasAccess</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span><span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">);</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">denyAccessUnlessGranted</span><span class="p">(</span><span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">role_hierarchy</span></code> values are static - you can’t, for example, store the
role hierarchy in a database. If you need that, create a custom
<a class="reference internal" href="security/voters.html"><span class="doc">security voter</span></a> that looks for the user roles
in the database.</p>
</div>
</div>
<div class="section" id="frequently-asked-questions">
<h2>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt><strong>Can I have Multiple Firewalls?</strong></dt>
<dd>Yes! But it’s usually not necessary. Each firewall is like a separate security
system. And so, unless you have <em>very</em> different authentication needs, one
firewall usually works well. With <a class="reference internal" href="security/guard_authentication.html"><span class="doc">Guard authentication</span></a>,
you can create various, diverse ways of allowing authentication (e.g. form login,
API key authentication and LDAP) all under the same firewall.</dd>
<dt><strong>Can I Share Authentication Between Firewalls?</strong></dt>
<dd>Yes, but only with some configuration. If you’re using multiple firewalls and
you authenticate against one firewall, you will <em>not</em> be authenticated against
any other firewalls automatically. Different firewalls are like different security
systems. To do this you have to explicitly specify the same
<a class="reference internal" href="reference/configuration/security.html#reference-security-firewall-context"><span class="std std-ref">Firewall Context</span></a> for different firewalls. But usually
for most applications, having one main firewall is enough.</dd>
<dt><strong>Security doesn’t seem to work on my Error Pages</strong></dt>
<dd>As routing is done <em>before</em> security, 404 error pages are not covered by
any firewall. This means you can’t check for security or even access the
user object on these pages. See <a class="reference internal" href="controller/error_pages.html"><span class="doc">How to Customize Error Pages</span></a>
for more details.</dd>
<dt><strong>My Authentication Doesn’t Seem to Work: No Errors, but I’m Never Logged In</strong></dt>
<dd>Sometimes authentication may be successful, but after redirecting, you’re
logged out immediately due to a problem loading the <code class="docutils literal notranslate"><span class="pre">User</span></code> from the session.
To see if this is an issue, check your log file (<code class="docutils literal notranslate"><span class="pre">var/log/dev.log</span></code>) for
the log message:</dd>
<dt><strong>Cannot refresh token because user has changed</strong></dt>
<dd>If you see this, there are two possible causes. First, there may be a problem
loading your User from the session. See <a class="reference internal" href="security/user_provider.html#user-session-refresh"><span class="std std-ref">Understanding how Users are Refreshed from the Session</span></a>. Second,
if certain user information was changed in the database since the last page
refresh, Symfony will purposely log out the user for security reasons.</dd>
</dl>
</div>
<div class="section" id="learn-more">
<h2>Learn More<a class="headerlink" href="#learn-more" title="Permalink to this headline">¶</a></h2>
<div class="section" id="authentication-identifying-logging-in-the-user">
<h3>Authentication (Identifying/Logging in the User)<a class="headerlink" href="#authentication-identifying-logging-in-the-user" title="Permalink to this headline">¶</a></h3>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="security/experimental_authenticators.html">Using the new Authenticator-based Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="security/form_login_setup.html">How to Build a Login Form</a></li>
<li class="toctree-l1"><a class="reference internal" href="security/reset_password.html">How to Add a Reset Password Feature</a></li>
<li class="toctree-l1"><a class="reference internal" href="security/json_login_setup.html">How to Build a JSON Authentication Endpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="security/guard_authentication.html">Custom Authentication System with Guard (API Token Example)</a></li>
<li class="toctree-l1"><a class="reference internal" href="security/password_migration.html">How to Migrate a Password Hash</a></li>
<li class="toctree-l1"><a class="reference internal" href="security/auth_providers.html">Built-in Authentication Providers</a></li>
<li class="toctree-l1"><a class="reference internal" href="security/user_provider.html">Security User Providers</a></li>
<li class="toctree-l1"><a class="reference internal" href="security/ldap.html">Authenticating against an LDAP server</a></li>
<li class="toctree-l1"><a class="reference internal" href="security/remember_me.html">How to Add “Remember Me” Login Functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="security/impersonating_user.html">How to Impersonate a User</a></li>
<li class="toctree-l1"><a class="reference internal" href="security/user_checkers.html">How to Create and Enable Custom User Checkers</a></li>
<li class="toctree-l1"><a class="reference internal" href="security/named_encoders.html">How to Use A Different Password Encoder Algorithm Per User</a></li>
<li class="toctree-l1"><a class="reference internal" href="security/multiple_guard_authenticators.html">How to Use Multiple Guard Authenticators</a></li>
<li class="toctree-l1"><a class="reference internal" href="security/firewall_restriction.html">How to Restrict Firewalls to a Request</a></li>
<li class="toctree-l1"><a class="reference internal" href="security/csrf.html">How to Implement CSRF Protection</a></li>
<li class="toctree-l1"><a class="reference internal" href="security/custom_authentication_provider.html">How to Create a custom Authentication Provider</a></li>
</ul>
</div>
</div>
<div class="section" id="authorization-denying-access">
<h3>Authorization (Denying Access)<a class="headerlink" href="#authorization-denying-access" title="Permalink to this headline">¶</a></h3>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="security/voters.html">How to Use Voters to Check User Permissions</a></li>
<li class="toctree-l1"><a class="reference internal" href="security/securing_services.html">How to Secure any Service or Method in your Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="security/access_control.html">How Does the Security access_control Work?</a></li>
<li class="toctree-l1"><a class="reference internal" href="security/access_denied_handler.html">How to Customize Access Denied Responses</a></li>
<li class="toctree-l1"><a class="reference internal" href="security/acl.html">How to Use Access Control Lists (ACLs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="security/force_https.html">How to Force HTTPS or HTTP for different URLs</a></li>
</ul>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2004-2020 Fabien Potencier

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>